
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
 <title>Plotting a Map of New York City Using Only Taxi Location Data | minimaxir | Max Woolf's Blog</title>



  
  
  
  
   
 <meta name="twitter:card" content="summary">
<meta name="twitter:site" content="@minimaxir">
<meta name="twitter:creator" content="@minimaxir">

  <meta name="twitter:title" content="Plotting a Map of New York City Using Only Taxi Location Data">


  <meta name="twitter:url" content="http://minimaxir.com/2015/08/nyc-map/">


  <meta name="twitter:description" content="In theory, plotting a million little points in close proximity should simulate the lines of the streets of New York City.">


  <meta name="twitter:image:src" content="http://minimaxir.com/img/nyc_thumb.png">

 
 <meta content="minimaxir | Max Woolf's Blog" property="og:site_name">

  <meta content="Plotting a Map of New York City Using Only Taxi Location Data" property="og:title">


  <meta content="article" property="og:type">


  <meta content="In theory, plotting a million little points in close proximity should simulate the lines of the streets of New York City." property="og:description">


  <meta content="http://minimaxir.com/2015/08/nyc-map/" property="og:url">



  <meta content="http://minimaxir.com/img/nyc_thumb.png" property="og:image">


  
  <meta content="data" property="article:section">
  


  

 
 
  <meta property="og:locale"    content="en_us" />
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://minimaxir.com/2015/08/nyc-map/">
  <link href="/favicon.png" rel="icon">
  <link href="/css/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/css/minimaxir.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/css/font-awesome.min.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href='http://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,400italic,700' rel='stylesheet' type='text/css'>
  <link href="/rss.xml" rel="alternate" title="minimaxir | Max Woolf's Blog" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  
  <script>
   $(document).ready(function() {
 
  // Facebook
	$( ".social.facebook" ).children().each(function(index,value) {
	var facebook_button = $(this);
	var url = facebook_button.attr("data");

  jQuery.getJSON("http://graph.facebook.com/?id="+url, function(data) {
  if (typeof data.shares != 'undefined') facebook_button.html("<i class=\"fa fa-facebook\"></i><span class=\"count hidden-xs\"> " + data.shares + "</span>");
  else if (typeof data.likes != 'undefined') facebook_button.html("<i class=\"fa fa-facebook\"></i><span class=\"count hidden-xs\"> " + data.likes + "</span>");
  else facebook_button.html("<i class=\"fa fa-facebook\"></i><span class=\"count hidden-xs\"> " + " 0</span>");
  });
  });
 
 // Twitter
	$( ".social.twitter" ).children().each(function(index,value) {
	var twitter_button = $(this);
	var url = twitter_button.attr("data");

  jQuery.getJSON("http://cdn.api.twitter.com/1/urls/count.json?url="+url+"&callback=?", function(data) {
  twitter_button.html("<i class=\"fa fa-twitter\"></i><span class=\"count hidden-xs\"> " + data.count + "</span>");
  });
  });
  
  // LinkedIn
	$( ".social.linkedin" ).children().each(function(index,value) {
	var linkedin_button = $(this);
	var url = linkedin_button.attr("data");

  jQuery.getJSON("http://www.linkedin.com/countserv/count/share?url="+url+"&format=jsonp&callback=?", function(data) {
  linkedin_button.html("<i class=\"fa fa-linkedin\"></i><span class=\"count hidden-xs\"> " + data.count + "</span>");
  });
  });
  });
  </script>

</head>
  <body>
    <!--<a href="/" class="home-icon">
      <img src="/images/home.png"/>
    </a>-->
	
	<a href="/" class="home-icon">
		<i class="fa fa-home"></i>
	</a>

    <article role="article" class="full-single-article">
  <div class="container">
    <div class="row">
      <div class="col-md-8 col-md-offset-2">
        <h1>Plotting a Map of New York City Using Only Taxi Location Data</h1>
        <div class="meta">
          written <time datetime="2015-08-07T08:00:00-07:00" pubdate data-updated="true"></time>
          in
<span class="categories">
  
    
          <a href="/data/">data</a></span>
     
  
</span>
        </div>
		<div class="row sharing index">
  
		  <span class="social facebook col-xs-4"><a href="http://www.facebook.com/share.php?u=http://minimaxir.com/2015/08/nyc-map/"  onclick="javascript:window.open(this.href,
  '', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=350,width=600');return false;" data="http://minimaxir.com/2015/08/nyc-map/"><i class="fa fa-facebook"></i><span class="count hidden-xs"> -</span></a></span>
  
		<span class="social twitter col-xs-4"><a href="http://twitter.com/home/?status=Plotting a Map of New York City Using Only Taxi Location Data - http://minimaxir.com/2015/08/nyc-map/ - via @minimaxir"  onclick="javascript:window.open(this.href,
  '', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=350,width=600');return false;" data=http://minimaxir.com/2015/08/nyc-map/><i class="fa fa-twitter"></i><span class="count hidden-xs"> -</span></a> </span>

  <span  class="social linkedin col-xs-4"><a href="http://www.linkedin.com/shareArticle?mini=true&title=&url=http://minimaxir.com/2015/08/nyc-map/"  onclick="javascript:window.open(this.href,
  '', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=450,width=600');return false;" data=http://minimaxir.com/2015/08/nyc-map/><i class="fa fa-linkedin"></i><span class="count hidden-xs"> -</span></a> </span>
   
			</div>
		
        <p>Recently, the New York City Taxi and Limousine Commission <a href="http://www.nyc.gov/html/tlc/html/about/trip_record_data.shtml">released a dataset</a> of all Yellow Taxi and Green Taxi trips in 2014, and year-to-date in 2015, which follows the <a href="http://chriswhong.com/open-data/foil_nyc_taxi/">2013 data set</a> which was obtained to a FOIL request for the data last year. The dataset contains fun statistics, such as the location where the taxi picked up and dropped off its fare, the speed the taxi is moving, and the total fare at the end of the ride.</p>

<p>In the <a href="https://news.ycombinator.com/item?id=10003118">Hacker News thread</a> announcing the data set release, user eck posted an interesting, minimalistic visualization of the taxi location data:</p>

<p><img src="/img/nyc-map/ov6K6mt.jpg"  ></p>

<p>eck made the visualization using a &ldquo;few hundred lines of C++&rdquo;. That seemed overkill to me. So I tried to reverse-engineer his visualization using my favorite plotting tool, <a href="http://ggplot2.org/">ggplot2</a>. In theory, plotting a million little points in close proximity should simulate the lines of the streets of New York City.</p>

<p>The dataset is large (2 GB per month of data), although not &ldquo;big data&rdquo; large. It would take an afternoon to set up a local database, and I wanted to make pretty visualizations <em>immediately</em>.</p>

<p>Google BigQuery Developer Advocate Felipe Hoffa <a href="https://www.reddit.com/r/bigquery/comments/3fo9ao/nyc_taxi_trips_now_officially_shared_by_the_nyc/">created a BigQuery interface</a> for the data. BigQuery allows easy and fast access to the entire dataset for rapid processing. In my case, I need to compress the data set by truncating the latitude and longitude of the GPS coordinates to 4 digits; this allows <a href="http://gis.stackexchange.com/a/8674">precision to 11 meters</a> on the coordinates, which is sufficient for estimating. Running this BigQuery query:</p>

<pre><code>SELECT ROUND(pickup_latitude, 4) as lat,
ROUND(pickup_longitude, 4) as long,
COUNT(*) as num_pickups
FROM [nyc-tlc:yellow.trips_2014]
GROUP BY lat, long
</code></pre>

<p>Gives me data for about 1 Million GPS coordinates; more than enough to make a full map. This also has the benefit of fitting into memory, which is necessary for use with ggplot2.</p>

<p>My first attempt, where I plot 1 million very small white points on a black map bounded to the latitude/longitude coordinates of NYC, turned out pretty well, and with less than 10 lines of code.</p>

<p><img src="/img/nyc-map/nyc_old.png"  ></p>

<p>On Reddit, my submission of the <a href="https://www.reddit.com/r/dataisbeautiful/comments/3fvg8i/map_of_new_york_city_plotted_using_locations_of/">data visualization</a> received about 3,500 points, and a large amount of social media buzz on Facebook and Twitter. There were a few comments however; why were there random points in the Hudson River? Why are highways indicated as taxi pickup spots? Why does the map say &ldquo;2015&rdquo; when your query says &ldquo;2014&rdquo;? (guilty on the last one; the map was made using the 2014 dataset by accident!)</p>

<p>At the least, the streets of <a href="https://en.wikipedia.org/wiki/Manhattan">Manhattan</a> were not discernable at all, unlike eck&rsquo;s diagram. As a result, I made a few refinements to remove some logical outliers with impossible vehicle speeds, removed noisy points which were completely isolated, <em>used the correct 2015 data set</em>, and also added a color weighting to the data, where the most-taxi-dense areas will appear colored (scaling logarithmically) to differentate those areas from less taxi-prone areas.</p>

<p><img src="/img/nyc-map/nyc_yellow_pickup.png"  ></p>

<p>The map, while less bright, became more precise. The streets in Manhattan are now visible, and the purple color shows how <a href="https://en.wikipedia.org/wiki/Times_Square">Times Square</a> and the <a href="https://en.wikipedia.org/wiki/Financial_District,_Manhattan">Financial District</a> in particular are popular taxi pickup spots in Manhattan. <a href="https://en.wikipedia.org/wiki/LaGuardia_Airport">LaGuardia Airport</a> and <a href="https://en.wikipedia.org/wiki/John_F._Kennedy_International_Airport">John F. Kennedy International Airport</a> appear purple as well.</p>

<p>However, this map only looks at places where people picked up Taxis. Could there be a difference when plotting Taxi dropoffs instead?</p>

<p>I reran the query and visualization scripts on the dropoff location data instead, and as it turns out, there is a significant difference!</p>

<p><img src="/img/nyc-map/nyc_yellow_dropoff.png"  ></p>

<p>While Taxi pickups were isolated more in residential areas, taxi dropoffs can happen anywhere in the Tristate area. Additionally, the map more closely matches eck&rsquo;s original visualization.</p>

<p>Setting up ggplot2 in this way will also allow me to perform other fun analyses in the future. For example, since we know where taxis drop off, we can determine the average speed for the trip for each significant location in NYC geography. Would the average trip speed be higher for trips that drop off at an airport due to the highway? Conversely, would the average speed be lower in Manhattan? How would fares be affected? Those are questions for another blog post. :)</p>

<p>Although, I still have no guesses why the highways are highlighted in <em>both</em> maps.</p>

<hr />

<p><em>You can download a <a href="https://dl.dropboxusercontent.com/u/2017402/nyc_yellow_pickup.pdf">PDF of my purple pickup map</a> (4.14 MB) and a <a href="https://dl.dropboxusercontent.com/u/2017402/nyc_yellow_dropoff.pdf">PDF of my blue dropoff map</a> (7.68 MB) sans text, both of which are resolution-independent and sutable for making physical prints.</em></p>

		
		<div class="row sharing index">
  
		  <span class="social facebook col-xs-4"><a href="http://www.facebook.com/share.php?u=http://minimaxir.com/2015/08/nyc-map/"  onclick="javascript:window.open(this.href,
  '', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=350,width=600');return false;" data="http://minimaxir.com/2015/08/nyc-map/"><i class="fa fa-facebook"></i><span class="count hidden-xs"> -</span></a></span>
  
		<span class="social twitter col-xs-4"><a href="http://twitter.com/home/?status=Plotting a Map of New York City Using Only Taxi Location Data - http://minimaxir.com/2015/08/nyc-map/ - via @minimaxir"  onclick="javascript:window.open(this.href,
  '', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=350,width=600');return false;" data=http://minimaxir.com/2015/08/nyc-map/><i class="fa fa-twitter"></i><span class="count hidden-xs"> -</span></a> </span>

  <span  class="social linkedin col-xs-4"><a href="http://www.linkedin.com/shareArticle?mini=true&title=&url=http://minimaxir.com/2015/08/nyc-map/"  onclick="javascript:window.open(this.href,
  '', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=450,width=600');return false;" data=http://minimaxir.com/2015/08/nyc-map/><i class="fa fa-linkedin"></i><span class="count hidden-xs"> -</span></a> </span>
   
			</div>
		
		</div>
    </div>
  </div>
</article>


<div class="home-landing her-row">
      <div class="container">
        <div class="row">
          <div class="col-md-offset-3 col-md-2">
<h4>about me</h4>
<img src="/images/max-prof-pic-200.jpg" alt="Stop mousing over me! :(" class="img-circle img-responsive hidden-xs hidden-sm">
</div>


<div id="about-me" class="col-md-4">
  
  <p>Max Woolf is a Software QA Engineer living and working in the San Francisco Bay Area for over 3 years. He graduated from Carnegie Mellon University in 2012 with a degree in Business Administration, concentrating in Computing and Information Technology.</p>
  
  <p>In his spare time, Max uses <a href="https://www.python.org/">Python</a> to gather data from public APIs and <a href="http://ggplot2.org/">ggplot2</a> to make pretty charts from that data.  Max also comments on technology blogs rather frequently.</p>
  
  <p>You can learn more about Max <a href="http://minimaxir.com/about">here</a>.
</p>
  
  <div class="social-icon-list">
	
    <a title="Facebook" href="https://facebook.com/max.woolf" target="_blank"><i class="fa fa-facebook-square"></i></a>
    
  	
    <a title="Twitter" href="https://twitter.com/minimaxir" target="_blank"><i class="fa fa-twitter-square"></i></a>
    
	
    <a title="LinkedIn" href="https://linkedin.com/in/minimaxir" target="_blank"><i class="fa fa-linkedin-square"></i></a>
    
    
    <a title="GitHub" href="https://github.com/minimaxir" target="_blank"><i class="fa fa-github-square"></i></a>
    
    
    <a title="E-Mail" href="mailto:max@minimaxir.com"><i class="fa fa-envelope-square"></i></a>
    
  </div>
</div>
        </div>
      </div>
    </div>

<div class="container">
    <div class="row">
      <div class="col-md-8 col-md-offset-2">
        <hr class="divider-short"/>
        
        

		</div>
		</div>
		</div>
      
<hr class="divider-short"/>

<div class="archive-link">
  <div class="container">
    <div class="row">
      <div class="col-md-8 col-md-offset-2">
        
          <a class="pull-left" href="/2015/07/facebook-scraper/" title="Previous Post: How to Scrape Data From Facebook Page Posts for Statistical Analysis"><i class="fa fa-angle-double-left"></i>  How to Scrape Data From Facebook Page Posts for Statistical Analysis</a>
        

        
      </div>
    </div>
  </div>
</div>

    <footer id="footer" class="her-row">
  <div class="container">
    <div class="row">
      <div class="col-md-1">
  <a href="/"><h4>Home</h4></a>
</div>
<!--
<div class="col-md-2">
  <div class="social-icon-list">
    
    <a title="Facebook" href="https://facebook.com/max.woolf" target="_blank"><i class="fa fa-facebook-square"></i></a>
    
  	
    <a title="Twitter" href="https://twitter.com/minimaxir" target="_blank"><i class="fa fa-twitter-square"></i></a>
    
	
    <a title="LinkedIn" href="https://linkedin.com/in/minimaxir" target="_blank"><i class="fa fa-linkedin-square"></i></a>
    
    
    <a title="GitHub" href="https://github.com/minimaxir" target="_blank"><i class="fa fa-github-square"></i></a>
    
    
    <a title="E-Mail" href="mailto:max@minimaxir.com"><i class="fa fa-envelope-square"></i></a>
    
  </div>
</div>
-->

<div class="pull-right">
  <h4>Powered by <a href="http://octopress.org/">Octopress</a>. Original theme by <a href="http://AdrianArtiles.com">Adrian Artiles</a>, heavily <a href="https://github.com/minimaxir/MediumFox">modified</a> by Max Woolf</h4>
</div>
    </div>
  </div>
</footer>
  </body>
</html>
