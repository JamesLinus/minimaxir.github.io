<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[minimaxir | Max Woolf's Blog]]></title>
  <link href="http://minimaxir.com/rss.xml" rel="self"/>
  <link href="http://minimaxir.com/"/>
  <updated>2017-06-06T08:27:41-07:00</updated>
  <id>http://minimaxir.com/</id>
  <author>
    <name><![CDATA[Max Woolf]]></name>
    <email><![CDATA[max@minimaxir.com]]></email>
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[Advantages of Using R Notebooks For Data Analysis Instead of Jupyter Notebooks]]></title>
    <link href="http://minimaxir.com/2017/06/r-notebooks/"/>
    <updated>2017-06-06T08:30:00-07:00</updated>
    <id>http://minimaxir.com/2017/06/r-notebooks</id>
    <content type="html"><![CDATA[<p><a href="http://jupyter.org">Jupyter Notebooks</a>, formerly known as <a href="https://ipython.org/notebook.html">IPython Notebooks</a>, are ubiquitous in modern data analysis. The Notebook format allows statistical code and its output to be viewed on any computer in a logical and <em>reproducible</em> manner, avoiding both the confusion caused by unclear code and the inevitable &ldquo;it only works on my system&rdquo; curse.</p>

<p><img src="/img/r-notebooks/jupyterdemo.png" alt=""></p>

<p>In Jupyter Notebooks, each block of Python input code executes in its own cell, and the output of the block appears inline; this allows the user to iterate on the results, both to make the data transformations explicit and to and make sure the results are as expected.</p>

<p><img src="/img/r-notebooks/jupyter.png" alt=""></p>

<p>In addition to code blocks, Jupyter Notebooks support <a href="https://en.wikipedia.org/wiki/Markdown">Markdown</a> cells, allowing for more detailed write-ups with easy formatting. The final Notebook can be exported as a HTML file displayable in a browser, or the raw Notebook file can be shared and <a href="https://github.com/blog/1995-github-jupyter-notebooks-3">rendered</a> on sites like <a href="https://github.com">GitHub</a>. Although Jupyter is a Python application, it can run kernels of <a href="https://irkernel.github.io">non-Python languages</a>, such as <a href="https://www.r-project.org">R</a>.</p>

<p>Over the years, there have a been a few new competitors in the reproducible data analysis field, such as <a href="http://beakernotebook.com/features">Beaker Notebook</a> and, for heavy-duty business problems, <a href="https://zeppelin.apache.org">Apache Zeppelin</a>. However, today we&rsquo;ll look at the relatively new <a href="http://rmarkdown.rstudio.com/r_notebooks.html">R Notebooks</a>, and how they help improve the workflows of common data analysis in ways Jupyter Notebooks can&rsquo;t without third-party extensions.</p>

<h2>About R Notebooks</h2>

<p>R Notebooks are a format maintained by <a href="https://www.rstudio.com">RStudio</a>, which develops and maintains a large number of open source R packages and tools, most notably the free-for-consumer RStudio R IDE. More specifically, R Notebooks are an extension of the earlier <a href="http://rmarkdown.rstudio.com">R Markdown</a> <code>.Rmd</code> format, useful for rendering analyses into HTML/PDFs, or other cool formats like <a href="http://rmarkdown.rstudio.com/tufte_handout_format.html">Tufte handouts</a> or even <a href="https://bookdown.org">books</a>. The default output of an R Notebook file is a <code>.nb.html</code> file, which can be viewed as a webpage on any system. (<a href="https://rpubs.com">RPubs</a> has many examples of R Notebooks, although I recommend using <a href="https://pages.github.com">GitHub Pages</a> to host notebooks publicly).</p>

<p><img src="/img/r-notebooks/RNotebookAnimation.gif" alt=""></p>

<p>Instead of having separate cells for code and text, a R Markdown file is all plain text. The cells are indicated by three backticks and a gray background in RStudio, which makes it easy to enter a code block, easy to identify code blocks at a glance, and easy to execute a notebook block-by-block. Each cell also has a green indicator bar which shows which code is running and which code is queued, line-by-line.</p>

<p>For Notebook files, a HTML webpage is automatically generated whenever the file is saved, which can immediately be viewed in any browser (the generated webpage stores the cell output and any necessary dependencies).</p>

<p><img src="/img/r-notebooks/notebooktest.png" alt=""></p>

<p>R Notebooks can only be created and edited in RStudio, but this is a case where tight vertical integration of open-source software is a good thing. Among many other features, RStudio includes a file manager, a function help, a variable explorer, and a project manager; all of which make analysis much easier and faster as opposed to the browser-only Jupyter.</p>

<p><img src="/img/r-notebooks/rstudio.png" alt=""></p>

<p>I&rsquo;ve made many, many Jupyter Notebooks and R Notebooks <a href="http://minimaxir.com/data-portfolio">over the years</a>, which has given me insight into the strengths and weaknesses of both formats. Here are a few native features of R Notebooks which present an objective advantage over Jupyter Notebooks, particularly those not highlighted in the documentation:</p>

<h2>Version Control</h2>

<p>Version control of files with tools such as <a href="https://en.wikipedia.org/wiki/Git">git</a> is important as it both maintains an explorable database of changes to the code files and also improves collaboration by using a centralized server (e.g. GitHub) where anyone with access to the repository can pull and push changes to the code. In the data science world, large startups such as <a href="https://stripe.com/blog/reproducible-research">Stripe</a> and <a href="https://medium.com/airbnb-engineering/scaling-knowledge-at-airbnb-875d73eff091">Airbnb</a> have seen a lot of success with this approach.</p>

<p>RStudio incidentally has a native git client for tracking and committing changes to a <code>.Rmd</code> file, which is easy since <code>.Rmd</code> files are effectively plain text files where you can see differences between versions at a per-line level. (You may not want to store the changes to the generated <code>.nb.html</code> Notebook since they will be large and redundant to the changes made in the corresponding <code>.Rmd</code>; I recommend adding a <code>*.nb.html</code> rule to a <code>.gitignore</code> file during analysis).</p>

<p><img src="/img/r-notebooks/git.png" alt=""></p>

<p>The <code>.ipynb</code> Jupyter Notebook files are blobs of JSON that also store cell output, which will result in large diffs if you keep them in version control and make any changes which result in different output. This can cause the git database to balloon and makes reading per-line diffs hard if not impossible.</p>

<p>On Hacker News, the version control issues in Jupyter are <a href="https://news.ycombinator.com/item?id=14034341">a common complaint</a>, however a Jupyter developer noted of a possibility of <a href="https://news.ycombinator.com/item?id=14035158">working with RStudio</a> on solving this issue.</p>

<h2>Inline Code Rendering</h2>

<p>A common practice in Jupyter Notebooks is to print common values as a part of a write-up or testing statistical code. In Jupyter Notebooks, if you want to verify the number of rows in a dataset for exploratory data analysis, you have to add an appropriate print statement to the cell to get the number <code>n</code> rows, and then add a Markdown cell to redundantly describe what you just print in the output. </p>

<p>In R Notebooks, you can skip a step by calling such print statements in-line in the Markdown text, which will then be rendered with the Notebook. This also avoids hard-coding such numbers in the Markdown text if you change the data beforehand (e.g. parameter tuning) or if the values are nontrivial to calculate by hand.</p>

<p>For example, these lines of R Markdown from my <a href="http://minimaxir.com/notebooks/first-comment/">Reddit First Comment Notebook</a>:</p>

<p><img src="/img/r-notebooks/inline.png" alt=""></p>

<p>translate into:</p>

<p><img src="/img/r-notebooks/reddit.png" alt=""></p>

<h2>Metadata</h2>

<p>R Notebooks are configured with a <a href="http://yaml.org">YAML</a> header, which can include common attributes such as title, author, date published, and other relevant options. These fields will then be configured correctly in the metadata for HTML/PDF/Handouts output. Here&rsquo;s an example from <a href="http://minimaxir.com/notebooks/amazon-spark/">one of my notebooks</a>:</p>
<div class="highlight"><pre><code class="language-yaml" data-lang="yaml"><span class="nn">---</span>
<span class="l-Scalar-Plain">title</span><span class="p-Indicator">:</span> <span class="s">&quot;Playing</span><span class="nv"> </span><span class="s">with</span><span class="nv"> </span><span class="s">80</span><span class="nv"> </span><span class="s">Million</span><span class="nv"> </span><span class="s">Amazon</span><span class="nv"> </span><span class="s">Product</span><span class="nv"> </span><span class="s">Review</span><span class="nv"> </span><span class="s">Ratings</span><span class="nv"> </span><span class="s">Using</span><span class="nv"> </span><span class="s">Apache</span><span class="nv"> </span><span class="s">Spark&quot;</span>
<span class="l-Scalar-Plain">author</span><span class="p-Indicator">:</span> <span class="s">&quot;Max</span><span class="nv"> </span><span class="s">Woolf</span><span class="nv"> </span><span class="s">(@minimaxir)&quot;</span>
<span class="l-Scalar-Plain">date</span><span class="p-Indicator">:</span> <span class="s">&quot;January</span><span class="nv"> </span><span class="s">2nd,</span><span class="nv"> </span><span class="s">2017&quot;</span>
<span class="l-Scalar-Plain">output</span><span class="p-Indicator">:</span>
  <span class="l-Scalar-Plain">html_notebook</span><span class="p-Indicator">:</span>
    <span class="l-Scalar-Plain">highlight</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">tango</span>
    <span class="l-Scalar-Plain">mathjax</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">null</span>
    <span class="l-Scalar-Plain">number_sections</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">yes</span>
    <span class="l-Scalar-Plain">theme</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">spacelab</span>
    <span class="l-Scalar-Plain">toc</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">yes</span>
    <span class="l-Scalar-Plain">toc_float</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">yes</span>
<span class="nn">---</span>
</code></pre></div>
<p>Said metadata features are <a href="https://github.com/ipython/ipython/issues/6073">often requested but unimplemented</a> in Jupyter.</p>

<h2>Notebook Theming</h2>

<p>As noted in the example metadata above, R Notebooks allow extensive theming. Jupyter Notebooks do <a href="https://github.com/dunovank/jupyter-themes">support themes</a>, but with a third-party Python package, or placing custom CSS in an <a href="https://stackoverflow.com/a/32158550">odd location</a>.</p>

<p>Like Jupyter Notebooks, the front-end of browser-based R Notebooks is based off of the <a href="http://getbootstrap.com">Bootstrap</a> HTML framework. R Notebooks, however, allow you to natively select the style of code syntax highlighting via <code>highlight</code> (similar options as <a href="https://help.farbox.com/pygments.html">pygments</a>) and also the entire Bootstrap theme via <code>theme</code> (with a selection from the excellent <a href="https://bootswatch.com">Bootswatch</a> themes by <a href="https://twitter.com/thomashpark">Thomas Park</a>), giving your Notebook a unique look without adding dependencies.</p>

<h2>Data Tables</h2>

<p>When you print a data frame in a Jupyter Notebook, the output appears as a standard <em>boring</em> HTML table:</p>

<p><img src="/img/r-notebooks/htmltable.png" alt=""></p>

<p>No cell block output is ever truncated. Accidentally printing an entire 100,000+ row table to a Jupyter Notebook is a mistake you only make <em>once</em>.</p>

<p>R Notebook tables are pretty tables with pagination for both rows and columns, and can support large amounts of data if necessary.</p>

<p><img src="/img/r-notebooks/rtable.png" alt=""></p>

<p>The R Notebook output table also includes the data type of the column, which is helpful for debugging unexpected issues where a column has an unintended data type (e.g. a numeric <code>&lt;dbl&gt;</code> column or a datetime <code>&lt;S3: POSIXct&gt;</code> column is parsed as a text-based <code>&lt;chr&gt;</code> column).</p>

<h2>Table of Contents</h2>

<p>A Table of Contents always helps navigating, particularly in a PDF export. Jupyter Notebooks <a href="https://github.com/minrk/ipython_extensions">requires an extension</a> for a ToC, while R Notebooks will natively create one from section headers (controllable via <code>toc</code> and <code>number_sections</code>). An optional <code>toc_float</code> parameter causes the Table of Contents to float on the left in the browser, making it always accessible.</p>

<p><img src="/img/r-notebooks/notebookheader.png" alt=""></p>

<p>In conclusion, R Notebooks haven&rsquo;t received much publicity since the benefits aren&rsquo;t immediately obvious, but for the purpose of reproducible analyses, the breadth of native features allows for excellent utility while avoiding dependency hell. Running R in an R Notebook is a significantly better experience than running R in a Jupyter Notebook. The advantages present in R Notebooks can also provide guidance for feature development in other Notebook software, which improves the data analysis ecosystem as a whole.</p>

<p>However, there&rsquo;s an elephant in the room&hellip;</p>

<h2>What About Python?</h2>

<p>So you might be thinking &ldquo;an R Notebook forces you to use R, but <em>serious</em> data science work is done using Python!&rdquo; Plot twist: you can use Python in an R Notebook!</p>

<p><img src="/img/r-notebooks/python.png" alt=""></p>

<p>Well, sort of. The Python session ends after the cell executes, making it unhelpful for tasks other than <em>ad hoc</em> scripts.</p>

<p>The topic on whether R or Python is better for data analysis is a <a href="https://news.ycombinator.com/item?id=14056098">common</a> <a href="https://news.ycombinator.com/item?id=13239530">religious</a> <a href="https://news.ycombinator.com/item?id=12301996">flamewar</a> topic which is best saved for a separate blog post (tl;dr: I disagree with the paraphrased quote above in that both languages have their advantages and you&rsquo;ll benefit significantly from knowing both ecosystems).</p>

<p>And I wouldn&rsquo;t count R out of &ldquo;serious data science&rdquo;. You can use R <a href="http://spark.rstudio.com">seamlessly</a> with big data tools like <a href="https://spark.apache.org">Apache Spark</a>, and R can <a href="https://rstudio.github.io/keras/">now</a> use <a href="https://keras.io">Keras</a>/<a href="https://www.tensorflow.org">TensorFlow</a> for deep learning with near-API-parity to the Python version. <em>Hmm</em>.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Leaving Apple Inc.]]></title>
    <link href="http://minimaxir.com/2017/05/leaving-apple/"/>
    <updated>2017-05-04T09:30:00-07:00</updated>
    <id>http://minimaxir.com/2017/05/leaving-apple</id>
    <content type="html"><![CDATA[<p>I’ve been working in the San Francisco Bay Area for about 5 years, but I’ve never publicly said where I’ve worked. Well, I was a Software QA Engineer at <a href="https://www.apple.com">Apple Inc.</a>, on the Applications team.</p>

<p>As of last week, I handed in my resignation. While I am thankful for the opportunities I have had at Apple, it is time for me to pursue working in other areas I am passionate about and search for other companies to further my personal growth and technical skills. Resigning from a good job to look for something new might defy conventional wisdom, but the time is right for me to make this bold career move.</p>

<h2>My Apple Story</h2>

<p>I graduated with university honors at <a href="http://www.cmu.edu">Carnegie Mellon University</a>, from the <a href="http://tepper.cmu.edu">Tepper School of Business</a> with a focus on Computing and Information Technology (i.e. data architecture and coding algorithms), and a minor in Statistics.</p>

<p>At the end of my senior year, I received an e-mail from a Software QA Manager at Apple (who followed my <a href="http://techcommntr.tumblr.com">comments</a> at the bottom of <a href="https://techcrunch.com">TechCrunch</a> articles) inviting me for an on-site interview. Following an offer, I moved to the Bay Area to start my first post-undergrad job in Cupertino.</p>

<p>While I can&rsquo;t really talk about what I worked on at Apple, I genuinely enjoyed the work, the product, and team. I had a high impact on the final result and I successfully helped qualify many major software releases. However, after a few years, I realized that my technical skill growth was stalling, so I looked for an an internal transfer to another department, ideally in a data analysis/software engineering role.</p>

<p>Having received no responses internally, I realized I would have to expand my search to outside of Apple.</p>

<h2>My Job Hunt</h2>

<p>I have a strong technical background from my CMU classes, but not having an explicit Computer Science degree has made it difficult to prove aptitude despite my positive annual reviews and proven experience / technical skills at Apple. So I made the decision to blog with a technical focus here at <a href="http://minimaxir.com">minimaxir.com</a>, which gave me an avenue to showcase my programmatic skills and the opportunity to self-learn practical new tools not covered during the school curriculum, such as <a href="https://www.python.org">Python</a>, <a href="http://ggplot2.org">ggplot2</a>, version control with <a href="https://git-scm.com">git</a>, and reproducible analyses via <a href="http://jupyter.org">Jupyter/IPython Notebooks</a>.</p>

<p>This approach has been successful and many readers have liked my my blog posts: often topping <a href="https://www.reddit.com/r/dataisbeautiful/comments/4bwr7o/relationship_between_rotten_tomatoes_tomatometer/">Reddit</a> and <a href="https://news.ycombinator.com/item?id=13429656">Hacker News</a>, driving hundreds of thousands of pageviews. Additionally, a couple of my posts were even cited in larger publications such as the <a href="https://www.washingtonpost.com/news/the-intersect/wp/2016/06/30/facebook-news-feed-and-the-tyranny-of-positive-content/">Washington Post</a> and <a href="https://www.buzzfeed.com/tomphillips/photos-that-prove-game-of-thrones-happened-in-real-life">BuzzFeed</a>.</p>

<p>I also published many open-source technical projects to my <a href="https://github.com/minimaxir">GitHub</a>. My <a href="https://github.com/minimaxir/big-list-of-naughty-strings">Big List of Naughty Strings</a>, a project I made in a couple hours on a weekend inspired by my QA-ing at work, is now at <strong>20,000+ Stars</strong> on GitHub. My <a href="https://github.com/minimaxir/facebook-page-post-scraper">Facebook Page Post Scraper</a>, which does what the name implies, is now at 1,000+ Stars and has been used by many other businesses and journalists.</p>

<p>Developers have long argued that job seekers should have a strong public portfolio, as demonstrated experience can account for the lack of a relevant degree. After years of building up my portfolio, it became apparent that most outside recruiters I talked with never looked at my blog/GitHub, despite a strong emphasis of both on my résumé.</p>

<p>I subsequently rededicated my blog as a pragmatic demonstration of relevant skills in the data analysis job market, focusing more on practical analysis instead of quirky insights and thoughts. In the process, I obtained proficiency in a number of modern tools, including <a href="http://minimaxir.com/2016/08/clickbait-cluster/">interactive data visualizations</a> on the web with <a href="https://plot.ly">Plotly</a>, processing <a href="http://minimaxir.com/2017/01/amazon-spark/">big data</a> with <a href="http://spark.apache.org">Apache Spark</a>, high-performance <a href="http://minimaxir.com/2017/02/predicting-arrests/">machine learning</a> with <a href="https://github.com/dmlc/xgboost">xgboost</a> and <a href="https://github.com/Microsoft/LightGBM">LightGBM</a>, and even <a href="http://minimaxir.com/2017/04/char-embeddings/">deep learning</a> with <a href="https://github.com/fchollet/keras">Keras</a> and <a href="https://github.com/tensorflow/tensorflow">TensorFlow</a>.</p>

<p>I am now actively looking for a <strong>data analyst/software engineering job within San Francisco</strong>. If you are interested or if you know of companies who are looking for qualified people, please send me an email at <strong><a href="mailto:max@minimaxir.com">max@minimaxir.com</a></strong>.</p>

<h2>Next Steps</h2>

<p>So I’ll be using my time over the next couple weeks to openly look for a new job, and to network with others in relevant industries (and be able to interview without taking a day off of work). Things have been improving: my <a href="https://news.ycombinator.com/item?id=14238066">comment</a> in the Hacker News &ldquo;Who wants to be hired?&rdquo; thread generated many leads who really liked my blog/portfolio. If you’d like to meet up in San Francisco and talk about tech and data stuff, just let me know.</p>

<p>I still intend to continue blogging, not as a hobby but in a more purposeful way. I have very ambitious goals and now have more time to execute them at a deeper level. Plans include:</p>

<ul>
<li>Web applications leveraging deep learning models, deployed at scale with <a href="https://www.docker.com">Docker</a>/<a href="https://kubernetes.io">Kubernetes</a>.</li>
<li>Interactive data dashboards accompanying every analytical blog post with <a href="https://shiny.rstudio.com">Shiny</a>.</li>
<li>Code screencasts at 4k resolution on <a href="https://youtube.com/minimaxir">YouTube</a>.</li>
<li>Data analysis live-streaming with augmented functionality on <a href="https://www.twitch.tv/minimaxir">Twitch</a>.</li>
</ul>

<p>I have set up a <strong><a href="https://www.patreon.com/minimaxir">Patreon</a></strong> in order to subsidize my machine learning/deep learning/software/hardware needs for my blog posts. If you have found any of my blog posts useful, a monetary contribution to my Patreon would be appreciated and will be put to good creative use.</p>

<p>If you want to keep up with me and my projects, feel free to follow me on <strong><a href="https://www.facebook.com/max.woolf">Facebook</a></strong> and <strong><a href="https://twitter.com/minimaxir">Twitter</a></strong> too.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Pretrained Character Embeddings for Deep Learning and Automatic Text Generation]]></title>
    <link href="http://minimaxir.com/2017/04/char-embeddings/"/>
    <updated>2017-04-04T06:30:00-07:00</updated>
    <id>http://minimaxir.com/2017/04/char-embeddings</id>
    <content type="html"><![CDATA[<p>Deep learning is the biggest, <a href="http://approximatelycorrect.com/2017/03/28/the-ai-misinformation-epidemic/">often misapplied</a> buzzword nowadays for getting pageviews on blogs. As a result, there have been a lot of shenanigans lately with deep learning thought pieces and how deep learning can solve <em>anything</em> and make childhood sci-fi dreams come true.</p>

<p>I&rsquo;m not a fan of <a href="http://tvtropes.org/pmwiki/pmwiki.php/Main/ClarkesThirdLaw">Clarke&rsquo;s Third Law</a>, so I spent some time checking out deep learning myself. As it turns out, with modern deep learning tools like <a href="https://github.com/fchollet/keras">Keras</a>, a higher-level framework on top of the popular <a href="https://www.tensorflow.org">TensorFlow</a> framework, deep learning is <strong>easy to learn and understand</strong>. Yes, easy. And it <em>definitely</em> does not require a PhD, or even a Computer Science undergraduate degree, to implement models or make decisions based on the output.</p>

<p>However, let&rsquo;s try something more expansive than the stereotypical deep learning tutorials.</p>

<h2>Characters Welcome</h2>

<p>Word embeddings have been a popular machine learning trick nowadays. By using an algorithm such as <a href="https://en.wikipedia.org/wiki/Word2vec">Word2vec</a>, you can obtain a numeric representation of a word, and use those values to create numeric representations of higher-level representations like sentences/paragraphs/documents/etc.</p>

<p><img src="/img/char-embeddings/word-vectors.png" alt=""></p>

<p>However, generating word vectors for datasets can be computationally expensive (see <a href="http://minimaxir.com/2016/08/clickbait-cluster/">my earlier post</a> which uses Apache Spark/Word2vec to create sentence vectors at scale quickly). The academic way to work around this is to use pretrained word embeddings, such as <a href="https://nlp.stanford.edu/projects/glove/">the GloVe vectors</a> collected by researchers at Stanford NLP. However, GloVe vectors are huge; the largest one (840 billion tokens at 300D) is 5.65 GB on disk and may hit issues when loaded into memory on less-powerful computers.</p>

<p>Why not work <em>backwards</em> and calculate <em>character</em> embeddings? Then you could calculate a relatively few amount of vectors which would easily fit into memory, and use those to derive word vectors, which can then be used to derive the sentence/paragraph/document/etc vectors. But training character embeddings traditionally is significantly more computationally expensive since there are 5-6x the amount of tokens, and I don&rsquo;t have access to the supercomputing power of Stanford researchers.</p>

<p>Why not use the <em>existing</em> pretrained word embeddings to extrapolate the corresponding character embeddings within the word? Think &ldquo;<a href="https://en.wikipedia.org/wiki/Bag-of-words_model">bag-of-words</a>,&rdquo; except &ldquo;bag-of-characters.&rdquo; For example, from the embeddings from the word &ldquo;the&rdquo;, we can infer the embeddings for &ldquo;t&rdquo;, &ldquo;h,&rdquo; and &ldquo;e&rdquo; from the parent word, and average the t/h/e vectors from <em>all</em> words/tokens in the dataset corpus. (For this post, I will only look at the 840B/300D dataset since that is the only one with capital letters, which are rather important. If you want to use a dataset with smaller dimensionality, apply <a href="https://en.wikipedia.org/wiki/Principal_component_analysis">PCA</a> on the final results)</p>

<p>I wrote a <a href="https://github.com/minimaxir/char-embeddings/blob/master/create_embeddings.py">simple Python script</a> that takes in the specified pretrained word embeddings and does just that, <a href="https://github.com/minimaxir/char-embeddings/blob/master/glove.840B.300d-char.txt">outputting the character embeddings</a> in the same format. (for simplicity, only ASCII characters are included; the <a href="https://en.wikipedia.org/wiki/Extended_ASCII">extended ASCII characters</a> are  intentionally omitted due to compatibility reasons. Additionally, by construction, space and newline characters are not represented in the derived dataset.)</p>

<p><img src="/img/char-embeddings/char-embeddings.png" alt=""></p>

<p>You may be thinking that I&rsquo;m cheating. So let&rsquo;s set a point-of-reference. Colin Morris <a href="http://colinmorris.github.io/blog/1b-words-char-embeddings">found</a> that when 16D character embeddings from a model used in Google&rsquo;s <a href="https://arxiv.org/abs/1312.3005">One Billion Word Benchmark</a> are projected into a 2D space via t-SNE, patterns emerge: digits are close, lowercase and uppercase letters are often paired, and punctuation marks are loosely paired.</p>

<p><img src="/img/char-embeddings/tsne_embeddings.png" alt=""></p>

<p>Let&rsquo;s do that for my derived character embeddings, but with <a href="https://www.r-project.org">R</a> and <a href="http://docs.ggplot2.org/current/">ggplot2</a>. t-SNE is <a href="http://distill.pub/2016/misread-tsne/">difficult to use</a> for high-dimensional vectors as combinations of parameters can result in wildly different output, so let&rsquo;s try a couple projections. Here&rsquo;s what happens when my pretrained projections are preprojected from 300D to 16D via <a href="http://ufldl.stanford.edu/tutorial/unsupervised/PCAWhitening/">PCA whitening</a>, and setting perplexity (number of optimal neighbors) to 7.</p>

<p><img src="/img/char-embeddings/char-tsne.png" alt=""></p>

<p>The algorithm manages to separate and group lowercase, uppercase, and numerals rather distinctly. Quadrupling the dimensionality of the preprocessing step to 64D and changing perplexity to 2 generates a depiction closer to the Google model projection:</p>

<p><img src="/img/char-embeddings/char-tsne-2.png" alt=""></p>

<p>My pretrained character embeddings trick isn&rsquo;t academic, but it&rsquo;s successfully identifying realistic relationships. There might be something here worthwhile.</p>

<h2>The Coolness of Deep Learning</h2>

<p>Keras, maintained by Google employee <a href="https://twitter.com/fchollet">François Chollet</a>, is so good that it is effectively cheating in the field of machine learning, where even TensorFlow tutorials can be replaced with a single line of code. (which is important for iteration; Keras layers are effectively Lego blocks). A simple read of the <a href="https://github.com/fchollet/keras/tree/master/examples">Keras examples</a> and <a href="https://keras.io/">documentation</a> will let you reverse-engineer most the revolutionary deep learning clickbait thought pieces. Some create entire startups by changing the source dataset of the Keras examples and pitch them to investors none-the-wiser, or make very light wrappers on top the examples for teaching tutorial videos and get thousands of subscribers on YouTube.</p>

<p>I prefer to parse documentation/examples as a proof-of-concept, but never as gospel. Examples are often not the most efficient ways to implement a solution to a problem, just merely a start. In the case of Keras&rsquo;s <a href="https://github.com/fchollet/keras/blob/master/examples/lstm_text_generation.py">text generator example</a>, the initial code was likely modeled after the 2015 blog post <a href="http://karpathy.github.io/2015/05/21/rnn-effectiveness/">The Unreasonable Effectiveness of Recurrent Neural Networks</a> by Andrej Karpathy and the corresponding project <a href="https://github.com/karpathy/char-rnn">char-rnn</a>. There have been many new developments in neural network architecture since 2015 that can improve both speed and performance of the text generation model as a whole.</p>

<h2>What Text to Generate?</h2>

<p>The Keras example uses <a href="https://en.wikipedia.org/wiki/Friedrich_Nietzsche">Nietzsche</a> writings as a data source, which I&rsquo;m not fond of because it&rsquo;s difficult to differentiate bad autogenerated Nietzsche rants from actual Nietzsche rants. What I want to generate is text with <em>rules</em>, with the algorithm being judged by how well it follows an inherent structure. My idea is to create <a href="http://magic.wizards.com/en">Magic: The Gathering</a> cards.</p>

<p><img src="/img/char-embeddings/dragon-whelp.jpg" alt=""></p>

<p>Inspired by the <a href="https://twitter.com/RoboRosewater">@RoboRosewater</a> Twitter account by Reed Milewicz and the <a href="http://www.mtgsalvation.com/forums/creativity/custom-card-creation/612057-generating-magic-cards-using-deep-recurrent-neural">corresponding research</a> and <a href="https://motherboard.vice.com/en_us/article/the-ai-that-learned-magic-the-gathering">articles</a>, I aim to see if it&rsquo;s possible to recreate the structured design creativity for myself.</p>

<p>Even if you are not familiar with Magic and its rules, you can still find the <a href="https://twitter.com/RoboRosewater/status/756198572282949632">card text</a> of RoboRosewater cards hilarious:</p>

<p><img src="/img/char-embeddings/horse.jpeg" alt=""></p>

<p>Occasionally RoboRosewater, using a weaker model, produces amusing <a href="https://twitter.com/RoboRosewater/status/689184317721960448">neural network trainwrecks</a>:</p>

<p><img src="/img/char-embeddings/carl.png" alt=""></p>

<p>More importantly, all Magic cards have an explicit structure; they have a name, mana cost in the upper-right, card type, card text, and usually a power and toughness in the bottom-right.</p>

<p>I wrote <a href="https://github.com/minimaxir/char-embeddings/blob/master/create_magic_text.py">another Python script</a> to parse all Magic card data from <a href="https://mtgjson.com">MTG JSON</a> into an encoding which matches this architecture, where each section transition has its own symbol delimiter, along with other encoding simplicities. For example, here is the card <a href="http://gatherer.wizards.com/Pages/Card/Details.aspx?multiverseid=247314">Dragon Whelp</a> in my encoding:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">[Dragon Whelp@{2}{R}{R}#Creature — Dragon$Flying|{R}: ~ gets +1/+0 until end of turn. If this ability has been activated four or more times this turn, sacrifice ~ at the beginning of the next end step.%2^3]
</code></pre></div>
<p>These card encodings are all combined into one .txt file, which will be fed into the model.</p>

<h2>Building and Training the Model</h2>

<p>The Keras text generation example operates by breaking a given .txt file into 40-character sequences, and the model tries to predict the 41st character by outputting a probability for each possible character (108 in this dataset). For example, if the input based on the above example is <code>[&#39;D&#39;, &#39;r&#39;, &#39;a&#39;, &#39;g&#39;, ..., &#39;D&#39;, &#39;r&#39;, &#39;a&#39;, &#39;g&#39;]</code> (with the latter Drag being part of the creature type), the model will optimize for outputting a probability of 1.0 of <code>o</code>; per the <a href="https://en.wikipedia.org/wiki/Cross_entropy#Cross-entropy_error_function_and_logistic_regression">categorical crossentropy</a> loss function, the model is rewarded for assigning correct guesses with 1.0 probability and incorrect guesses with 0.0 probabilities, penalizing half-guesses and wrong guesses.</p>

<p>Each possible 40-character sequence is collected, however only every other third sequence is kept; this prevents the model from being able to learn card text verbatim, plus it also makes training faster. (for this model, there are about <strong>1 million</strong> sequences for the final training). The example uses only a 128-node <a href="https://en.wikipedia.org/wiki/Long_short-term_memory">long-short-term-memory</a> (LSTM) <a href="https://en.wikipedia.org/wiki/Recurrent_neural_network">recurrent neural network</a> (RNN) layer, popular for incorporating a &ldquo;memory&rdquo; into a neural network model, but the example notes at the beginning it can take awhile to train before generated text is coherent.</p>

<p>There are a few optimizations we can make. Instead of supplying the characters directly to the RNN, we can first encode them using an <a href="https://keras.io/layers/embeddings/">Embedding layer</a> so the model can train character context. We can stack more layers on the RNN by adding a 2-level <a href="https://en.wikipedia.org/wiki/Multilayer_perceptron">multilayer perceptron</a>: a <a href="https://www.reddit.com/r/ProgrammerHumor/comments/5si1f0/machine_learning_approaches/">meme</a>, yes, but it helps, as the network must learn latent representations of the data. Thanks to recent developments such as <a href="https://arxiv.org/abs/1502.03167">batch normalization</a> and <a href="https://en.wikipedia.org/wiki/Rectifier_(neural_networks)">rectified linear activations</a> for these <a href="https://keras.io/layers/core/#dense">Dense layers</a>, they can both be trained without as much computational overhead, and thanks to Keras, both can be added to a layer with a single line of code each. Lastly, we can add an auxiliary output via Keras&rsquo;s <a href="https://keras.io/models/model/">functional API</a> where the network makes a prediction based on only the output from the RNN in addition to the main output, which forces it to work smarter and ends up resulting in a <em>significant</em> improvement in loss for the main path.</p>

<p>The final architecture ends up looking like this:</p>

<p><img src="/img/char-embeddings/model.png" alt=""></p>

<p>And because we added an Embedding layer, we can load the pretrained 300D character embeds I made earlier, giving the model a good start in understanding character relationships.</p>

<p>The goal of the training is to minimize the total loss of the model. (but for evaluating model performance, we only look at the loss of the main output). The model is trained in <strong>epochs</strong>, where the model sees all the input data atleast once. During each epoch, batches of size 128 are loaded into the model and evaluated, calculating a <strong>batch loss</strong> for each; the gradients from the batch are backpropagated into the previous layers to improve them. While training with Keras, the console reports an <strong>epoch loss</strong>, which is the average of all the batch losses so far in the current epoch, allowing the user to see in real time how the model improves, and it&rsquo;s addicting.</p>

<p><img src="/img/char-embeddings/keras-training.gif" alt=""></p>

<p>Keras/TensorFlow works just fine on the CPU, but for models with a RNN, you&rsquo;ll want to consider using a GPU for performance, specifically one by nVidia. Amazon has cloud GPU instances for $0.90/hr (<a href="http://docs.aws.amazon.com/AWSEC2/latest/UserGuide/Stop_Start.html">not prorated</a>), but very recently, Google announced <a href="https://cloud.google.com/compute/docs/gpus/add-gpus">GPU instances</a> of the same caliber for ~$0.75/hr (prorated to the minute), which is what I used to train this model, although Google Compute Engine requires configuring the GPU drivers first. For 20 epochs, it took about 4 hours and 20 minutes to train the model while spending $3.26, which isn&rsquo;t bad as far as deep learning goes.</p>

<h2>Making Magic</h2>

<p>After each epoch, the original Keras text generation example takes a sentence from the input data as a seed and predicts the next character in the sequence according to the model, then uses the last 40 characters generated for the next character, etc. The sampling incorporates a diversity/temperature parameter which allows the model to make suboptimal decisions and select characters with lower natural probabilities, which allows for the romantic &ldquo;creativity&rdquo; popular with neural network text generation.</p>

<p>With the Magic card dataset and my tweaked model architecture, generated text is coherent <a href="https://github.com/minimaxir/char-embeddings/blob/master/output/iter-01-0_9204.txt">after the 1st epoch</a>! After about 20 epochs, training becomes super slow, but the predicted text becomes super interesting. Here are a few fun examples from a <a href="https://github.com/minimaxir/char-embeddings/blob/master/output/text_sample.txt">list of hundreds of generated cards</a>. (Note: the power/toughness values at the end of the card have issues; more on that later).</p>

<p>With low diversity, the neural network generated cards that are oddly biased toward card names which include the letter &ldquo;S&rdquo;. The card text also conforms to the rules of the game very well.</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">[Reality Spider@{3}{G}#Creature — Elf Warrior$Whenever ~ deals combat damage to a player, put a +1/+1 counter on it.%^]
[Dark Soul@{2}{R}#Instant$~ deals 2 damage to each creature without flying.%^]
[Standing Stand@{2}{G}#Creature — Elf Shaman${1}{G}, {T}: Draw a card, then discard a card.%^]
</code></pre></div>
<p>In contrast, cards generated with high diversity hit the uncanny valley of coherence and incoherence in both text and game mechanic abuse, which is what makes them interesting. </p>
<div class="highlight"><pre><code class="language-text" data-lang="text">[Portrenline@{2}{R}#Sorcery$As an additional cost to cast ~, exile ~.%^]
[Clocidian Lorid@{W}{W}{W}#Instant$Regenerate each creature with flying and each player.%^]
[Icomic Convermant@{3}{G}#Sorcery$Search your library for a land card in your graveyard.%1^1]
</code></pre></div>
<p>The best-of-both-worlds cards are generated from diversity parameters between both extremes, and often have funny names.</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">[Seal Charm@{W}{W}#Instant$Exile target creature. Its controller loses 1 life.%^]
[Shambling Assemblaster@{4}{W}#Creature — Human Cleric$When ~ enters the battlefield, destroy target nonblack creature.%1^1]
[Lightning Strength@{3}{R}#Enchantment — Aura$Enchant creature|Enchanted creature gets +3/+3 and has flying, flying, trample, trample, lifelink, protection from black and votile all damage unless you return that card to its owner&#39;s hand.%2^2]
[Skysor of Shadows@{7}{B}{B}{B}#Enchantment$As ~ enters the battlefield, choose one —|• Put a -1/-1 counter on target creature.%2^2]
[Glinding Stadiers@{4}{W}#Creature — Spirit$Protection from no creatures can&#39;t attack.%^]
[Dragon Gault@{3}{G}{U}{U}#Creature — Kraven$~&#39;s power and toughness are 2.%2^2]
</code></pre></div>
<p>All Keras/Python code used in this blog post, along with sample Magic card output and the trained model itself, is available open-source <a href="https://github.com/minimaxir/char-embeddings">in this GitHub repository</a>. The repo additionally contains <a href="https://github.com/minimaxir/char-embeddings/blob/master/text_generator_keras_sample.py">a Python script</a> which lets you generate new cards using the model, too!</p>

<h2>Visualizing Model Performance</h2>

<p>One thing deep learning tutorials rarely mention is <em>how</em> to collect the loss data and visualize the change in loss over time. Thanks to Keras&rsquo;s <a href="https://keras.io/callbacks/">utility functions</a>, I wrote a custom model callback which collects the batch losses and epoch losses and writes them to a CSV file.</p>

<p>Using R and ggplot2, I can plot the batch loss at every 50th batch to visualize how the model converges over time.</p>

<p><img src="/img/char-embeddings/batch-losses.png" alt=""></p>

<p>After 20 epochs, the model loss ends up at about <strong>0.30</strong> which is more-than-low-enough for coherent text. As you can see, there are large diminishing returns after a few epochs, which is the hard part of training deep learning models.</p>

<p>Plotting the epoch loss over the batches makes the trend more clear.</p>

<p><img src="/img/char-embeddings/epoch-losses.png" alt=""></p>

<p>In order to prevent early convergence, we can make the model more complex (i.e. stack more layers unironically), but that has trade-offs, both in training <em>and</em> predictive speed, the latter of which is important if using deep learning in a production application.</p>

<p>Lastly, as with the Google One Billion Words benchmark, we can extract the <a href="https://github.com/minimaxir/char-embeddings/blob/master/output/char-embeddings.txt">trained character embeddings</a> from the model (now augmented with Magic card context!) and plot them again to see what has changed.</p>

<p><img src="/img/char-embeddings/char-tsne-embed.png" alt=""></p>

<p>There are more pairs of uppercase/lowercase characters, although  interestingly there isn&rsquo;t much grouping with the special characters added as section breaks in the encoding, or mechanical uppercase characters such as W/U/B/R/G/C/T.</p>

<h2>Next Steps</h2>

<p>After building the model, I did a little more research to see if others solved the power/toughness problem. Since the sentences are only 40 characters and Magic cards are much longer than 40 characters, it&rsquo;s likely that power/toughness are out-of-scope for the model and it cannot learn their exact values. Turns out that the intended solution is to use a <a href="https://github.com/billzorn/mtgencode">completely different encoding</a>, such as this one for Dragon Whelp:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">|5creature|4|6dragon|7|8&amp;^^/&amp;^^^|9flying\{RR}: @ gets +&amp;^/+&amp; until end of turn. if this ability has been activated four or more times this turn, sacrifice @ at the beginning of the next end step.|3{^^RRRR}|0N|1dragon whelp|
</code></pre></div>
<p>Power/toughness are generated near the <em>beginning</em> of the card. Sections are delimited by pipes, with a numeral designating the corresponding section. Instead of numerals being used card values, carets are used, which provides a more accurate <em>quantification</em> of values. With this encoding, each character has a <em>singular purpose</em> in the global card context, and their embeddings would likely generate more informative visualizations. (But as a consequence, the generated cards are harder to parse at a glance).</p>

<p>The secondary encoding highlights a potential flaw in my methodology using pretrained character embeddings. Trained machine learning models must be used apples-to-apples on similar datasets; for example, you can&rsquo;t accurately perform Twitter <a href="https://en.wikipedia.org/wiki/Sentiment_analysis">sentiment analysis</a> on a dataset using a model trained on professional movie reviews since Tweets do not follow <a href="https://owl.english.purdue.edu/owl/resource/735/02/">AP Style</a> guidelines. In my case, the <a href="http://commoncrawl.org">Common Crawl</a>, the source of the pretrained embeddings, follows more natural text usage and would not work analogously with the atypical character usages in <em>either</em> of the Magic card encodings.</p>

<p>There&rsquo;s still a <em>lot</em> of work to be done in terms of working with both pretrained character embeddings and improving Magic card generation, but I believe there is promise. The better way to make character embeddings than my script is to do it the hard way and train then manually, maybe even at a higher dimensionality like 500D or 1000D. Likewise, for Magic model building, the <a href="https://github.com/billzorn/mtgencode#training-a-neural-net">mtg-rnn instructions</a> repo uses a large LSTM stacked on a LSTM along with 120/200-character sentences, both of which combined make training <strong>VERY</strong> slow (notably, this was the architecture of the <a href="https://github.com/fchollet/keras/commit/d2b229df2ea0bab712379c418115bc44508bc6f9#diff-904d72bcf9fa38b32f9c1f868ff59367">very first commit</a> for the Keras text generation example, and <a href="https://github.com/fchollet/keras/commit/01d5e7bc4782daafcfa99e035c1bdbe13a985145">was changed</a> to the easily-trainable architecture). There is also promise in a <a href="http://kvfrans.com/variational-autoencoders-explained/">variational autoencoder</a> approach, such as with <a href="https://arxiv.org/abs/1702.02390">textvae</a>.</p>

<p>This work is potentially very expensive and I am strongly considering setting up a <a href="https://www.patreon.com">Patreon</a> in lieu of excess venture capital to subsidize my machine learning/deep learning tasks in the future.</p>

<p>At minimum, working with this example gave me a sufficient application of practical work with Keras, and another tool in my toolbox for data analysis and visualization. Keras makes the model-construction aspect of deep learning trivial and not scary. Hopefully, this article justifies the use of the &ldquo;deep learning&rdquo; buzzword in the headline.</p>

<p>It&rsquo;s also worth mentioning that I actually started working on automatic text generation 6 months ago using a different, non-deep-learning approach, but hit a snag and abandoned that project. With my work on Keras, I found a way around that snag, and on the same Magic dataset with the same input construction, I obtained a model loss of <strong>0.03</strong> at <strong>20% of the cloud computing cost</strong> in about the same amount of time. More on that later.</p>

<hr>

<p><em>The code for generating the R/ggplot2 data visualizations is available in this <a href="http://minimaxir.com/notebooks/char-tsne/">R Notebook</a>, and open-sourced in <a href="https://github.com/minimaxir/char-tsne-visualization">this GitHub Repository.</a></em></p>

<p><em>You are free to use the automatic text generation scripts and data visualizations from this article however you wish, but it would be greatly appreciated if proper attribution is given to this article and/or myself!</em></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Predicting And Mapping Arrest Types in San Francisco with LightGBM, R, ggplot2]]></title>
    <link href="http://minimaxir.com/2017/02/predicting-arrests/"/>
    <updated>2017-02-08T06:30:00-08:00</updated>
    <id>http://minimaxir.com/2017/02/predicting-arrests</id>
    <content type="html"><![CDATA[<p>The new hotness in the world of data science is <a href="https://en.wikipedia.org/wiki/Artificial_neural_network">neural networks</a>, which form the basis of <a href="https://en.wikipedia.org/wiki/Deep_learning">deep learning</a>. But while everyone is obsessing about neural networks and how deep learning is <em>magic</em> and can solve <em>any</em> problem if you just <a href="https://www.reddit.com/r/ProgrammerHumor/comments/5si1f0/machine_learning_approaches/">stack enough layers</a>, there have been many recent developments in the relatively nonmagical world of machine learning with <em>boring</em> CPUs.</p>

<p>Years before neural networks were the Swiss army knife of data science, there were <a href="https://en.wikipedia.org/wiki/Gradient_boosting">gradient-boosted machines</a>/<a href="https://en.wikipedia.org/wiki/Gradient_boosting#Gradient_tree_boosting">gradient-boosted trees</a>. GBMs/GBTs are machine learning methods which are effective on many types of data, and do not require the <a href="http://r-statistics.co/Assumptions-of-Linear-Regression.html">traditional model assumptions</a> of linear/logistic regression models. Wikipedia has a good article on the advantages of <a href="https://en.wikipedia.org/wiki/Decision_tree_learning">decision tree learning</a>, and visual diagrams of the architecture:</p>

<p><img src="/img/predicting-arrests/CART_tree_titanic_survivors.png" alt=""></p>

<p>GBMs, as <a href="http://scikit-learn.org/stable/modules/generated/sklearn.ensemble.GradientBoostingClassifier.html">implemented</a> in the Python package <a href="http://scikit-learn.org/stable/">scikit-learn</a>, are extremely popular in <a href="https://www.kaggle.com">Kaggle</a> machine learning competitions. But scikit-learn is relatively old, and new technologies have emerged which implement GBMs/GBTs on large datasets with massive parallelization and and in-memory computation. A popular big data machine learning library, <a href="http://www.h2o.ai">H2O</a>, has a <a href="http://docs.h2o.ai/h2o-tutorials/latest-stable/tutorials/gbm-randomforest/index.html">famous GBM implementation</a> which, <a href="https://github.com/szilard/benchm-ml">per benchmarks</a>, is over 10x faster than scikit-learn and is optimized for datasets with millions of records. But even <em>faster</em> than H2O is <a href="https://github.com/dmlc/xgboost">xgboost</a>, which can hit a 5x-10x speed-ups relative to H2O, depending on the dataset size.</p>

<p>Enter <a href="https://github.com/Microsoft/LightGBM">LightGBM</a>, a new (October 2016) open-source machine learning framework by <a href="https://www.microsoft.com/en-us/">Microsoft</a> which, per <a href="https://github.com/Microsoft/LightGBM/issues/211">benchmarks</a> on release, was up to <em>4x faster</em> than xgboost! (xgboost very recently implemented a <a href="https://github.com/dmlc/xgboost/issues/1950">technique</a> also used in LightGBM, which reduced the relative speedup to just ~2x). As a result, LightGBM allows for very efficient model building on large datasets without requiring cloud computing or nVidia CUDA GPUs.</p>

<p>A year ago, I <a href="http://minimaxir.com/2015/12/sf-arrests/">wrote an analysis</a> of the types of police arrests in San Francisco, using data from the <a href="https://data.sfgov.org">SF OpenData</a> initiative, with a <a href="http://minimaxir.com/2015/12/sf-arrest-maps/">followup article</a> analyzing the locations of these arrests. Months later, the same source dataset was used <a href="https://www.kaggle.com/c/sf-crime">for a Kaggle competition</a>. Why not give the dataset another look and test LightGBM out?</p>

<h2>Playing With The Data</h2>

<p><em>(You can view the R code used to process the data and generate the data visualizations in <a href="http://minimaxir.com/notebooks/predicting-arrests/">this R Notebook</a>)</em></p>

<p>The <a href="https://data.sfgov.org/Public-Safety/SFPD-Incidents-from-1-January-2003/tmnf-yvry">SFPD Incidents</a> dataset includes crime incidents in San Francisco from 1/1/2003 to 1/17/2017 (at time of analysis). Filtering the dataset only on incidents which resulted in arrests (since most incidents are trivial) leaves a dataset of 634,299 arrests total. The dataset also includes information on the type of crime, the location where the arrest occurred, and the date/time. There are 39 different types of arrests in the <strong>Category</strong> column such as Assault, Burglary, and Prostitution, which serves as the response variable.</p>

<p><img src="/img/predicting-arrests/data.png" alt=""></p>

<p>Meanwhile, we can engineer features from the location and date/time. 
Performing an exploratory data analysis of both is helpful to determine at a glance which features may be relevant (fortunately, I did that a year ago).</p>

<p><img src="/img/sf-arrests/sf-arrest-when-4.png" alt=""></p>

<p>The location is given as latitude/longitude coordinates, so we can select a longitude <strong>X</strong> and latitude <strong>Y</strong> as features. Date/Time can be deconstructed further. We can extract the <strong>hour</strong> in which a given arrest occurred as a feature (hour can take 24 different values from 0 — 23). Likewise, we can extract the <strong>month</strong> in a similar manner (12 values, from 1 — 12). The <strong>year</strong> the crime occurred can be extracted without special encoding. (2003 — 2017). It is always helpful to include a year feature in predictive models to help account for change over time. The <strong>DayOfWeek</strong> is important, but encoding it as a numeric value is tricker; we logically encode each day of the week from 1 — 7, but which day should be #1? Making Monday #1 and Sunday #7 is the most logical, since a decision tree rule that sets a threshold on DayOfWeek values &gt; 5 will translate logically to a weekend.</p>

<p><img src="/img/predicting-arrests/predict_matrix.png" alt=""></p>

<p>That&rsquo;s six features total. There are more features which could be helpful, but let&rsquo;s check a baseline model as a start.</p>

<h2>Modeling</h2>

<p>Specifically, the model will predict the answer the question: <em>given that a San Francisco police arrest occurs at a specified time and place, what is the reason for that arrest?</em></p>

<p>For this post, I will use the <a href="https://github.com/Microsoft/LightGBM/tree/master/R-package">R package</a> for LightGBM (which was beta-released in January 2017; it&rsquo;s <em>extremely</em> cutting edge!) We split the dataset 70%/30% into a training set of 444,011 arrests and a test set of 190,288 arrests (due to the large amount of different category labels, the split must be <a href="https://en.wikipedia.org/wiki/Stratified_sampling">stratified</a> to ensure the training and test sets have a balanced distribution of labels; in R, this can be implemented with the <code>caret</code> package and <code>createDataPartition</code>).</p>

<p>LightGBM trains the model on the training set and evaluates it on the test set to minimize the <a href="https://www.kaggle.com/c/sf-crime#evaluation">multiclass logarithmic loss</a> of the model. For now, I use the <a href="https://github.com/Microsoft/LightGBM/blob/master/docs/Parameters.md">default parameters</a> of LightGBM, except to massively increase the number of iterations of the training algorithm, and to stop training the model early if the model stops improving. After about 4 minutes on my laptop (which is very fast for a dataset of this size!), the model returns a multilogloss of <strong>1.98</strong>.</p>

<p>That number sounds arbitrary. Is it good or bad? Let&rsquo;s compare it to the multilogloss from the <a href="https://www.kaggle.com/c/sf-crime/leaderboard">top models</a> from the Kaggle version of the dataset, where a lower score is better:</p>

<p><img src="/img/predicting-arrests/kaggle.png" alt=""></p>

<p>&hellip;okay, 1.98 <em>is</em> a good score, and without spending much time adding features to the model and <a href="https://github.com/Microsoft/LightGBM/blob/master/docs/Parameters-tuning.md">tuning parameters</a>! To be fair, my methodology would not necessarily result in the same score on the Kaggle dataset, but it confirms that the LightGBM model is in the top tier of models available for this problem and dataset context. And it didn&rsquo;t <a href="https://www.kaggle.com/smerity/sf-crime/fighting-crime-with-keras/output">require any neural networks</a> either!</p>

<p>There are areas for improvement in feature engineering which <a href="https://www.kaggle.com/c/sf-crime/kernels">other entries</a> in the Kaggle competition implemented, such as a <a href="https://en.wikipedia.org/wiki/Dummy_variable_(statistics)">dummy variable</a> indicating whether the offense occurred at an intersection and which SF police station was involved in the arrest. We could also encode features such as hour and DayOfWeek as categorical features (LightGBM conveniently allows this without requiring <a href="https://en.wikipedia.org/wiki/One-hot">one-hot encoding</a> the features) instead of numeric, but in my brief testing, it made the model <em>worse</em>, interestingly.</p>

<h2>Analyzing the LightGBM Model</h2>

<p>Another perk of not using a neural network for statistical model building is the ability to learn more about the importance of features in a model, as opposed to it being a <a href="https://en.wikipedia.org/wiki/Black_box">black box</a>. In the case of gradient boosting, we can calculate the proportional contribution of each feature to the total <a href="https://en.wikipedia.org/wiki/Information_gain_in_decision_trees">information gain</a> of the model, which will help identify the most important features, and potentially unhelpful features:</p>

<p><img src="/img/predicting-arrests/imp.png" alt=""></p>

<p>Unsurprisingly, location features are the most important, with both location-based features establishing 70% of the total Gain in the model. But no feature is completely insignificant, which is a good thing.</p>

<p>Back to the multilogloss of 1.98. What does that mean in the real world? What is the <em>accuracy</em> of the model? We run each of the 190,288 arrests in the test set against the model, which returns 39 probability values for each record: one for each possible category of arrest. The category with the highest probability becomes the <strong>predicted</strong> type of arrest.</p>

<p><img src="/img/predicting-arrests/predicted_results.png" alt=""></p>

<p>The accuracy of the model on the test set, which is the proportion of predictions where the predicted category value matches the <strong>actual</strong> category value, is <strong>39.7%</strong>, with a 95% confidence interval for the true accuracy between 39.5% and 39.9%. That seems low! However, there is catch-all &ldquo;Other Offenses&rdquo; category for an arrest; if you predicted a &ldquo;Other Offenses&rdquo; label for all the test-set values, you would get an accuracy of <em>31.1%</em>, which serves as the No Information Rate (since it would be the highest accuracy approach if there was no information at all). A 8.6 percentage point improvement is still an improvement though; many industries would <em>love</em> an 8.6 percentage point increase in accuracy, but for this context obviously it&rsquo;s not enough to usher in a <a href="https://en.wikipedia.org/wiki/Minority_Report_(film)">Minority Report</a>/<a href="https://en.wikipedia.org/wiki/Person_of_Interest_(TV_series)">Person of Interest</a> future.</p>

<p>We can visualize the classifications on the test set by the model using a <a href="https://en.wikipedia.org/wiki/Confusion_matrix">confusion matrix</a>; <code>caret</code> has a simple <code>confusionMatrix()</code> function, and ggplot2 has a <code>geom_tile()</code> to map out the relationships, even with 39 classes. We can also annotate the tiles where actual label = predicted label by drawing a <code>geom_point()</code> on top. Putting it all together:</p>

<p><img src="/img/predicting-arrests/confusionMatrix.png" alt=""></p>

<p>There is, indeed, a large amount of confusion. Many of the labels are mispredicted as Other Offenses. Specifically, the model frequently confuses the combinations of Assault, Drug/Narcotics, Larceny/Theft, and Warrants, suggesting that they also may be catch-alls.</p>

<p>In theory, the predicted probabilities from the model between similar types of crime should also be similar, which may be causing these mispredictions. We can calculate the <a href="https://en.wikipedia.org/wiki/Pearson_correlation_coefficient">Pearson correlations</a> between the predicted probabilities, and use <a href="https://en.wikipedia.org/wiki/Hierarchical_clustering">hierarchical clustering</a> to <a href="http://www.sthda.com/english/wiki/ggplot2-quick-correlation-matrix-heatmap-r-software-and-data-visualization">arrange and plot the correlations</a> and their labels in a logical order. The majority of the correlations between labels are between 0 and +/- 0.5 (weak to moderate), but their arrangement tells a different story:</p>

<p><img src="/img/predicting-arrests/correlationMatrix.png" alt=""></p>

<p>From top to bottom, you can see that there is a grouping of more blue-collar, physical crimes types (Assault, Vandalism), then a grouping of less-physical, white-collar crime types (Bribery, Extortion), and then a smaller grouping of seedier crime types (Liquor Laws, Prostitution).</p>

<p>The visualization doesn&rsquo;t necessarily provide more information about the confusion matrix and the mispredictions, but <em>it looks cool</em>, which is enough.</p>

<h2>Mapping the Predicted Types of Arrests</h2>

<p>Kaggle competitions emphasize model creation, but don&rsquo;t discuss how to implement and execute models in practice. Since we can predict the type of crime based on the given location and date/time of an arrest, we can map boundaries of the mostly likely type of offense. Using <code>ggmap</code> to get a map of San Francisco, splitting San Francisco into tens of thousands of points, and predicting the most-likely type of arrest at the location with a given date/time.</p>

<p>Let&rsquo;s say we want to predict the types of crime in the future, on April 15th, 2017, during 8 PM. We construct a dataset of those points and the same date/time features used to generate the model originally. Then run those fabricated points through the model again to get new predicted labels (Additionally, we need to remove &ldquo;Other Offenses&rdquo; predicted labels since they cloud up the map). Plotting each point as a <code>geom_tile</code> will interpolate regions around the city. Putting it all together:</p>

<p><img src="/img/predicting-arrests/crime-2017-04-15-20.png" alt=""></p>

<p>Not too shabby. But that&rsquo;s not all; we can <em>animate</em> this map over a day by incrementing the hour, generating a map for each hour (while keeping the colors corresponding to the arrest type consistent), and then <a href="https://github.com/minimaxir/frames-to-gif-osx">stitching the maps together</a> into a GIF. Let&rsquo;s do March 14th, 2017 (<a href="https://en.wikipedia.org/wiki/Pi_Day">Pi Day</a> can be dangerous!) starting at 6 AM:</p>

<p><img src="/img/predicting-arrests/map_ani.gif" alt=""></p>

<p>Wow!</p>

<h2>Conclusion</h2>

<p>I deliberately avoided using the term &ldquo;machine learning&rdquo; in the headline of this post because it has been overused to the point of clickbait. Indeed, neural networks/deep learning excel at processing higher-dimensional data such as text, image, and voice data, but in cases where dataset features are <a href="https://news.ycombinator.com/item?id=13563892">simple and known</a>, neural networks are not necessarily the most <em>pragmatic</em> option. CPU/RAM machine learning libraries like LightGBM are still worthwhile, despite the religious fervor for deep learning.</p>

<p>And there&rsquo;s still a lot of work that can be done with the SF Crime Incidents dataset. The model only predicts the type of crime given an arrest occurred; it does not predict <em>if</em> an arrest will occur at a given time and place, which would make a fun project for the future!</p>

<hr>

<p><em>You can view all the R and ggplot2 code used to visualize the San Francisco crime data in <a href="http://minimaxir.com/notebooks/predicting-arrests/">this R Notebook</a>. You can also view the images/data used for this post in <a href="https://github.com/minimaxir/sf-arrests-predict">this GitHub repository</a></em>.</p>

<p><em>You are free to use the data visualizations from this article however you wish, but it would be greatly appreciated if proper attribution is given to this article and/or myself!</em></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Playing with 80 Million Amazon Product Review Ratings Using Apache Spark]]></title>
    <link href="http://minimaxir.com/2017/01/amazon-spark/"/>
    <updated>2017-01-02T09:00:00-08:00</updated>
    <id>http://minimaxir.com/2017/01/amazon-spark</id>
    <content type="html"><![CDATA[<p><a href="https://www.amazon.com">Amazon</a> product reviews and ratings are a very important business. Customers on Amazon often make purchasing decisions based on those reviews, and a single bad review can cause a potential purchaser to reconsider. A couple years ago, I wrote a blog post titled <a href="http://minimaxir.com/2014/06/reviewing-reviews/">A Statistical Analysis of 1.2 Million Amazon Reviews</a>, which was well-received.</p>

<p><img src="/img/amazon/amzn-basic-score.png" alt=""></p>

<p>Back then, I was only limited to 1.2M reviews because attempting to process more data caused out-of-memory issues and my R code took <em>hours</em> to run.</p>

<p><a href="http://spark.apache.org">Apache Spark</a>, which makes processing gigantic amounts of data efficient and sensible, has become very popular in the past couple years (for good tutorials on using Spark with Python, I recommend the <a href="https://courses.edx.org/courses/course-v1:BerkeleyX+CS105x+1T2016/info">free</a> <a href="https://courses.edx.org/courses/course-v1:BerkeleyX+CS110x+2T2016/info">eDX</a> <a href="https://courses.edx.org/courses/course-v1:BerkeleyX+CS120x+2T2016/info">courses</a>). Although data scientists often use Spark to process data with distributed cloud computing via <a href="https://aws.amazon.com/ec2/">Amazon EC2</a> or <a href="https://azure.microsoft.com/en-us/services/hdinsight/apache-spark/">Microsoft Azure</a>, Spark works just fine even on a typical laptop, given enough memory (for this post, I use a 2016 MacBook Pro/16GB RAM, with 8GB allocated to the Spark driver).</p>

<p>I wrote a <a href="https://github.com/minimaxir/amazon-spark/blob/master/amazon_preprocess.py">simple Python script</a> to combine the per-category ratings-only data from the <a href="http://jmcauley.ucsd.edu/data/amazon/">Amazon product reviews dataset</a> curated by Julian McAuley, Rahul Pandey, and Jure Leskovec for their 2015 paper <a href="http://cseweb.ucsd.edu/%7Ejmcauley/pdfs/kdd15.pdf">Inferring Networks of Substitutable and Complementary Products</a>. The result is a 4.53 GB CSV that would definitely not open in Microsoft Excel. The truncated and combined dataset includes the <strong>user_id</strong> of the user leaving the review, the <strong>item_id</strong> indicating the Amazon product receiving the review, the <strong>rating</strong> the user gave the product from 1 to 5, and the <strong>timestamp</strong> indicating the time when the review was written (truncated to the Day). We can also infer the <strong>category</strong> of the reviewed product from the name of the data subset.</p>

<p>Afterwards, using the new <a href="http://spark.rstudio.com">sparklyr</a> package for R, I can easily start a local Spark cluster with a single <code>spark_connect()</code> command and load the entire CSV into the cluster in seconds with a single <code>spark_read_csv()</code> command.  </p>

<p><img src="/img/amazon-spark/output.png" alt=""></p>

<p>There are 80.74 million records total in the dataset, or as the output helpfully reports, <code>8.074e+07</code> records. Performing advanced queries with traditional tools like <a href="https://cran.rstudio.com/web/packages/dplyr/vignettes/introduction.html">dplyr</a> or even Python&rsquo;s <a href="http://pandas.pydata.org">pandas</a> on such a dataset would take a considerable amount of time to execute.</p>

<p>With sparklyr, manipulating actually-big-data is <em>just as easy</em> as performing an analysis on a dataset with only a few records (and an order of magnitude easier than the Python approaches taught in the eDX class mentioned above!).</p>

<h2>Exploratory Analysis</h2>

<p><em>(You can view the R code used to process the data with Spark and generate the data visualizations in <a href="http://minimaxir.com/notebooks/amazon-spark/">this R Notebook</a>)</em></p>

<p>There are <strong>20,368,412</strong> unique users who provided reviews in this dataset. <strong>51.9%</strong> of those users have only written one review.</p>

<p><img src="/img/amazon-spark/user_count_cum.png" alt=""></p>

<p>Relatedly, there are <strong>8,210,439</strong> unique products in this dataset, where <strong>43.3%</strong> have only one review.</p>

<p><img src="/img/amazon-spark/item_count_cum.png" alt=""></p>

<p>After removing duplicate ratings, I added a few more features to each rating which may help illustrate how review behavior changed over time: a ranking value indicating the # review that the author of a given review has written (1st review by author, 2nd review by author, etc.), a ranking value indicating the # review that the product of a given review has received (1st review for product, 2nd review for product, etc.), and the month and year the review was made.</p>

<p>The first two added features require a <em>very</em> large amount of processing power, and highlight the convenience of Spark&rsquo;s speed (and the fact that Spark uses all CPU cores by default, while typical R/Python approaches are single-threaded!)</p>

<p>These changes are cached into a Spark DataFrame <code>df_t</code>. If I wanted to determine which Amazon product category receives the best review ratings on average, I can aggregate the data by category, calculate the average rating score for each category, and sort. Thanks to the power of Spark, the data processing for this many-millions-of-records takes seconds.</p>
<div class="highlight"><pre><code class="language-r" data-lang="r">df_agg <span class="o">&lt;-</span> df_t <span class="o">%&gt;%</span>
            group_by<span class="p">(</span><span class="kp">category</span><span class="p">)</span> <span class="o">%&gt;%</span>
            summarize<span class="p">(</span>count <span class="o">=</span> n<span class="p">(),</span> avg_rating <span class="o">=</span> <span class="kp">mean</span><span class="p">(</span>rating<span class="p">))</span> <span class="o">%&gt;%</span>
            arrange<span class="p">(</span>desc<span class="p">(</span>avg_rating<span class="p">))</span> <span class="o">%&gt;%</span>
            collect<span class="p">()</span>
</code></pre></div>
<p><img src="/img/amazon-spark/avg.png" alt=""></p>

<p>Or, visualized in chart form using <a href="http://ggplot2.org">ggplot2</a>:</p>

<p><img src="/img/amazon-spark/avg_rating_desc.png" alt=""></p>

<p>Digital Music/CD products receive the highest reviews on average, while Video Games and Cell Phones receive the lowest reviews on average, with a <strong>0.77</strong> rating range between them. This does make some intuitive sense; Digital Music and CDs are types of products where you know <em>exactly</em> what you are getting with no chance of a random product defect, while Cell Phones and Accessories can have variable quality from shady third-party sellers (Video Games in particular are also prone to irrational <a href="http://steamed.kotaku.com/steam-games-are-now-even-more-susceptible-to-review-bom-1774940065">review bombing</a> over minor grievances).</p>

<p>We can refine this visualization by splitting each bar into a percentage breakdown of each rating from 1-5. This could be plotted with a pie chart for each category, however a stacked bar chart, scaled to 100%, looks much cleaner.</p>

<p><img src="/img/amazon-spark/category_breakdown.png" alt=""></p>

<p>The new visualization does help support the theory above; the top categories have a significantly higher percentage of 4/5-star ratings than the bottom categories, and a much a lower proportion of 1/2/3-star ratings. The inverse holds true for the bottom categories.</p>

<p>How have these breakdowns changed over time? Are there other factors in play?</p>

<h2>Rating Breakdowns Over Time</h2>

<p>Perhaps the advent of the binary Like/Dislike behaviors in social media in the 2000&rsquo;s have translated into a change in behavior for a 5-star review system. Here are the rating breakdowns for reviews written in each month from January 2000 to July 2014:</p>

<p><img src="/img/amazon-spark/time_breakdown.png" alt=""></p>

<p>The voting behavior oscillates very slightly over time with no clear spikes or inflection points, which dashes that theory.</p>

<h2>Distribution of Average Scores</h2>

<p>We should look at the global averages of Amazon product scores (i.e. what customers see when they buy products), and the users who give the ratings. We would expect the distributions to match, so any deviations would be interesting.</p>

<p>Products on average, when looking at products with atleast 5 ratings, have a <strong>4.16</strong> overall rating.</p>

<p><img src="/img/amazon-spark/item_histogram.png" alt=""></p>

<p>When looking at a similar graph for the overall ratings given by users, (5 ratings minimum), the average rating is slightly higher at <strong>4.20</strong>.</p>

<p><img src="/img/amazon-spark/user_histogram.png" alt=""></p>

<p>The primary difference between the two distributions is that there is significantly higher proportion of Amazon customers giving <em>only</em> 5-star reviews. Normalizing and overlaying the two charts clearly highlights that discrepancy.</p>

<p><img src="/img/amazon-spark/user_item_histogram.png" alt=""></p>

<h2>The Marginal Review</h2>

<p>A few posts ago, I discussed how the <a href="http://minimaxir.com/2016/11/first-comment/">first comment on a Reddit post</a> has dramatically more influence than subsequent comments. Does user rating behavior change after making more and more reviews? Is the typical rating behavior different for the first review of a given product? </p>

<p>Here is the ratings breakdown for the <em>n</em>-th Amazon review a user gives:</p>

<p><img src="/img/amazon-spark/user_nth_breakdown.png" alt=""></p>

<p>The first user review has a slightly higher proportion of being a 1-star review than subsequent reviews. Otherwise, the voting behavior is mostly the same overtime, although users have an increased proportion of giving a 4-star review instead of a 5-star review as they get more comfortable.</p>

<p>In contrast, here is the ratings breakdown for the <em>n</em>-th review an Amazon product received:</p>

<p><img src="/img/amazon-spark/item_nth_breakdown.png" alt=""></p>

<p>The first product review has a slightly higher proportion of being a 5-star review than subsequent reviews. However, after the 10th review, there is <em>zero</em> change in the distribution of ratings, which implies that the marginal rating behavior is independent from the current score after that threshold.</p>

<h2>Summary</h2>

<p>Granted, this blog post is more playing with data and less analyzing data. What might be interesting to look into for future technical posts is conditional behavior, such as predicting the rating of a review given the previous ratings on that product/by that user. However, this post shows that while &ldquo;big data&rdquo; may be an inscrutable buzzword nowadays, you don&rsquo;t have to work for a Fortune 500 company to be able to understand it. Even with a data set consisting of 5 simple features, you can extract a large number of insights. </p>

<p>And this post doesn&rsquo;t even look at the text of the Amazon product reviews or the metadata associated with the products! I do have a few ideas lined up there which I won&rsquo;t spoil.</p>

<hr>

<p><em>You can view all the R and ggplot2 code used to visualize the Amazon data in <a href="http://minimaxir.com/notebooks/amazon-spark/">this R Notebook</a>. You can also view the images/data used for this post in <a href="https://github.com/minimaxir/amazon-spark">this GitHub repository</a></em>.</p>

<p><em>You are free to use the data visualizations from this article however you wish, but it would be greatly appreciated if proper attribution is given to this article and/or myself!</em></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Network Visualization of Breached Internet Services Using HaveIBeenPwned? Data]]></title>
    <link href="http://minimaxir.com/2016/12/pwned-network/"/>
    <updated>2016-12-19T08:30:00-08:00</updated>
    <id>http://minimaxir.com/2016/12/pwned-network</id>
    <content type="html"><![CDATA[<p>Last week, Yahoo <a href="https://yahoo.tumblr.com/post/154479236569/important-security-information-for-yahoo-users">announced</a> that 1 billion accounts on their service were compromised by attackers in 2013. That is bad, and unfortunately common nowadays.</p>

<p>Security expert <a href="https://twitter.com/troyhunt">Troy Hunt</a> maintains <a href="https://haveibeenpwned.com">Have I been pwned?</a>, a database of breached internet services where users can check to see if their account information has been compromised in such an attack as the Yahoo attack. Recently, Hunt <a href="https://www.troyhunt.com/heres-1-4-billion-records-from-have-i-been-pwned-for-you-to-analyse/">released a dataset</a> consisting of <strong>1.4 billion</strong> unique breached accounts, and the services where those specific accounts were compromised.</p>

<p>The dataset has been scrubbed of identifying information and sensitive data (justifiability so), which strongly limits the scope of any potential analysis. However, what may be interesting is taking a look at the interrelated networks between the services and creating a neat data visualization.</p>

<h2>Methodology</h2>

<p>Here&rsquo;s a line from the 141.8 MB text file:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">Adobe;GFAN;HeroesOfNewerth;NetEase;Tumblr 2
</code></pre></div>
<p>In this example, 2 users had their accounts breached at these specific 5 services.</p>

<p>I wrote a <a href="https://github.com/minimaxir/breach-network/blob/master/hibp_service_edges.py">simple Python script</a> that takes in the HIBP data dump and outputs two files:</p>

<p>One, <a href="https://github.com/minimaxir/breach-network/blob/master/hibp_services.csv">a CSV file</a> containing the total number of breached accounts from each service in this dataset. From the example data point, we would add 2 to the counts of Adobe breaches, GFAN breaches, etc. There are <strong>1,768,628,867</strong> total records in the dataset (which is greater than the earlier 1.4B metric since it multicounts accounts which have been breached multiple times). The 1.77B number approximately matches the given number of total number of records on HIBP (1,989,141,353) minus the number of records from sensitive breaches (~221M).</p>

<p><img src="/img/breach-network/nodes.png" alt=""></p>

<p>Two, <a href="https://github.com/minimaxir/breach-network/blob/master/hibp_edges.csv">a CSV file</a> containing the unique combination pairs of each service in a data point, From the example data point, we would add 2 to the counts of [Adobe, GFAN], [Adobe, HeroesOfNewerth], etc. (statistically-minded readers will notice that there are 10 unique two-value combinations for a set of 5 services). </p>

<p><img src="/img/breach-network/edges.png" alt=""></p>

<p>Although the HIBP dataset represents 1.77 Billion records, it is far from &ldquo;big data&rdquo;: my Python script takes less than a minute to process it.</p>

<p>The latter CSV serves as the edge list for a network graph. There are 10,816 unique edges. Using <a href="https://www.r-project.org">R</a>, <a href="http://ggplot2.org">ggplot2</a>, and <a href="https://briatte.github.io/ggnetwork/">ggnetwork</a>, I connected all the edges into a graph network (removing edges with too few breached accounts), set the layout according to 50,000 iterations of the <a href="https://github.com/gephi/gephi/wiki/Fruchterman-Reingold">Fruchterman-Reingold algorithm</a>, and attempted to make it pretty.</p>

<p>The results of my first made-in-an-hour-after-getting-home-from-work draft were <a href="http://i.imgur.com/FpLiFGk.png">not pretty</a>. On Hacker News, user flashman <a href="https://news.ycombinator.com/item?id=13112461">provides a sensible fix</a>; only include edges in the network with a proportional number of accounts shared between the two internet services it connects (e.g. the edge contains atleast 1% of the accounts in both services).</p>

<p>Removing edges which do not fit that criteria dramatically reduces the clutter and makes communities much more distinct. After rerunning the code and making further style tweaks, here&rsquo;s the final result:</p>

<p><a href="/img/breach-network/hibp.png"><img src="/img/breach-network/hibp.png" alt=""></a></p>

<p><em>(click on the image to view at full resolution)</em></p>

<p>The interactive version at the top of the page was created with <a href="https://plot.ly">Plotly</a>, via my workflow mentioned in a <a href="http://minimaxir.com/2016/12/interactive-network/">previous post</a>.</p>

<h2>Analysis</h2>

<p>The colors of the nodes represent the communities as determined by the <a href="http://arxiv.org/abs/physics/0512106">Walktrap community finding algorithm</a> run on the network. There are a few noteworthy groups: the turquoise group of mainstream social networking services including LinkedIn and MySpace, the brown group of mainstream gaming services like Nexus Mods and XSplit, and mustard-colored services of questionable legality on the right of the cluster. There are clusters of services extended far from the general clusters which represent non-English services: the yellow-green cluster on the left consists of Russian internet services, while the lime-green cluster at the top represents Chinese internet services.</p>

<p>The size of the nodes represent the degree of the node, or the number of nodes connected to a given node. With that, we can easily see services like LinkedIn and XSplit have strong connections to other breached services. Relatedly, the transparency of the edges in the image is determined by the corresponding weight of the edge, and demonstrates the relative magnitude of the LinkedIn/MySpace breaches. (And it&rsquo;s also why we can&rsquo;t use other metrics like <a href="https://en.wikipedia.org/wiki/Centrality">centrality</a> for sizing the nodes, as the relative weights of those breaches skew the result.)</p>

<p>What&rsquo;s important is that the network is generated <em>entirely from user behavior</em>, and not by manually establishing the actual relationships between the internet services.</p>

<p>Given the wildly-varying timing and magnitude of these breaches, along with the numerous potential <em>causes</em> of breaches which are not always publicly disclosed, it is difficult to make accurate predictive models about future breaches from the HaveIBeenPwned? dataset. The records in HIBP are a <em>very</em> small sample of all the leaked data worldwide, unfortunately. However, it shows what  relationships can be visualized from simple user fingerprints all around the web, even when the fingerprint <em>itself</em> is unknown.</p>

<hr>

<p><em>You can view all the R and ggplot2 code used to visualize the network data in <a href="http://minimaxir.com/notebooks/breach-network/">this R Notebook</a>. You can also view the images/data used for this post in <a href="https://github.com/minimaxir/breach-network">this GitHub repository</a></em>.</p>

<p><em>You are free to use the data visualizations from this article however you wish, but it would be greatly appreciated if proper attribution is given to this article and/or myself!</em></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Infinite-Quality Abstract Art and Animations with Primitive]]></title>
    <link href="http://minimaxir.com/2016/12/primitive/"/>
    <updated>2016-12-12T06:30:00-08:00</updated>
    <id>http://minimaxir.com/2016/12/primitive</id>
    <content type="html"><![CDATA[<p>4k media (&ldquo;<a href="https://en.wikipedia.org/wiki/Ultra-high-definition_television">Ultra HD</a>&rdquo;) is the new big thing. <a href="https://www.youtube.com">YouTube</a> and <a href="https://www.netflix.com/">Netflix</a> now offer 4k video streaming, cell phones such as the <a href="http://www.apple.com/iphone-7/">iPhone 7</a> can now record 4k video, gaming consoles such as the <a href="https://www.playstation.com/en-us/explore/ps4-pro/">PlayStation 4 Pro</a> can play video games in native 4k, and 4k-compatible computer monitors and television sets are now priced reasonably.</p>

<p>However, the improvements offered by 4k do not come for free. From 1080p, 4k media requires much more resources to store the media on disk, much more resources to read from disk or stream over the Internet, and much more resources to store in memory. And Moore&rsquo;s Law has been slowing down.</p>

<p>Another option worth considering in light of these potential constraints is vector graphics, which can be scaled to <em>any</em> resolution at a significant fraction of the storage space. Although graphic formats such as <a href="https://en.wikipedia.org/wiki/Scalable_Vector_Graphics">Scalable Vector Graphics</a> (SVG) have existed <em>long</em> before 4k media (and even 1080p media), support for it had died out over the years since JPGs and PNGs were more practical for the 1024x768px screens of the day, and older versions of Internet Explorer did not support SVGs. However, creating complex SVGs is not trivial, and there aren&rsquo;t any magic applications that can convert a normal image into vector graphics automatically (the closest is <a href="http://potrace.sourceforge.net">potrace</a>, which only works for one color).</p>

<p><a href="https://github.com/fogleman/primitive">Primitive</a>, an open-source project by <a href="https://twitter.com/FogleBird">Michael Fogleman</a>, is a cross-platform command-line application that creates abstract art by taking simple polygons such as triangles and rectangles and placing them such that the group of polygons is as close as possible to the original image. The Twitter account <a href="https://twitter.com/PrimitivePic">@PrimitivePic</a> posts examples of such images every half hour.</p>

<p><img src="/img/primitive/git.png" alt=""></p>

<p>The <a href="https://primitive.lol">Primitive application</a> on the <a href="https://itunes.apple.com/us/app/primitive/id1175103038?mt=12">Mac App Store</a>, also by Fogleman, provides a simple user interface for the application for $9.99 (worth it for the productivity increase over fiddling with the command-line). With this GUI, you can see exactly <em>how</em> the art is being made, in real time. The app has also been <a href="https://medium.com/art-marketing/product-launch-post-mortem-primitive-for-macos-2eee316134ad">financially successful</a> for a side project.</p>

<p><img src="/img/primitive/primitive.png" alt=""></p>

<p>Both interfaces allow for SVG export, which means that we can use Primitive to take small images and scale them <em>indefinitely</em>.</p>

<p>But what cool things can you do with these fancy SVGs? Let&rsquo;s take a look.</p>

<h2>Playing with Primitive</h2>

<p>Here&rsquo;s a photo I took of the <a href="https://en.wikipedia.org/wiki/San_Francisco_Ferry_Building">San Francisco Ferry Building</a> last year, cropped to 16:9 with an attempt to follow the <a href="https://en.wikipedia.org/wiki/Rule_of_thirds">rule of thirds</a>.</p>

<p><img src="/img/primitive/San_Francisco.png" alt=""></p>

<p>This PNG image is 672 KB. Let&rsquo;s try running it through Primitive to see if we can make it smaller, and make it <em>cooler</em> by drawing 50 quadrilaterals (with zero transparency), at the 1024px &ldquo;nicest&rdquo; working size for maximum quality.</p>

<p><img src="/img/primitive/SF_Final_50.svg" alt=""></p>

<p>Now that is definitely minimalistic. Maybe <em>too</em> abstract. What happens if we want to add detail? We can do that by adding many quadratic <a href="https://en.wikipedia.org/wiki/B%C3%A9zier_curve">Bèzier curves</a>. Let&rsquo;s add 500 solid curves to this image.</p>

<p><img src="/img/primitive/SF_Final_550.svg" alt=""></p>

<p>Now that looks fancy, is only 94 KB (about 1/8th the file size of the static image!), and can scale to any screen size.</p>

<p>You may have noticed that this SVG is the final result from the <a href="/img/primitive/SF_Final_550_animated.svg">animation</a> at the beginning of this article. This particular shenanigan is <a href="http://minimaxir.com/2016/12/interactive-network/">another</a> of my trademark weird-tricks-that-should-not-even-work-but-do. By passing the final SVG through <a href="https://maxwellito.github.io/vivus/">Vivus</a> (specifically, <a href="https://maxwellito.github.io/vivus-instant/">Vivus Instant</a>), we can animate the Bèzier curves such that it looks like they are being drawn <em>in real time</em> on the quadrilateral background.</p>

<p>The animations generated from Vivus Instant are pure CSS and require no additional dependencies (although you&rsquo;ll need to <a href="https://css-tricks.com/scale-svg/">manually add</a> the <code>viewBox</code> attribute to make the SVG mobile-friendly). Even then, the result is 276 KB; still much smaller than the original raster image!</p>

<p>Of the polygons available in Primitive, Vivus Instant will only animate the Bèzier curves. If you wanted to animate other polygons, you could use <a href="http://snapsvg.io">Snap.svg</a>, which might make a fun project for a future post.</p>

<p>These SVG animations only work on the web, but it&rsquo;s not difficult to make animations of SVG creation into a share-friendly format.</p>

<h2>Abstract GIFs</h2>

<p>GIFs nowadays can be shared anywhere, and Primitive has a few ways of making GIFs. The command-line interface has a GIF-maker built in; essentially, it outputs each frame as an image and stitches them together.</p>

<p>The Primitive Mac App has another option. Since the polygons are rendered on-screen, you can <em>record the screen</em> using tools like <a href="https://support.apple.com/en-us/HT201066">QuickTime&rsquo;s screen recording</a> to simultaneously visualize and record the vector image. Once recorded (and after editing the video to speed things up), you can use one of any number of video-to-GIF converters to make a sharable animation.</p>

<p>For this test, let&rsquo;s try using an <em>extremely</em> small image and see how well Primitive can extrapolate to an infinite size. Here&rsquo;s a 64x64px sprite of the <a href="http://www.pokemon.com/us/">Pokèmon</a> Pikachu from the 3rd generation of Pokèmon games (via <a href="http://bulbapedia.bulbagarden.net/wiki/Pikachu_(Pok%C3%A9mon)">Bulbapedia</a>).</p>

<p><img src="/img/primitive/Spr_3r_025.png" alt=""></p>

<p>I made a video of Primitive rendering Pikachu using a combination of 1,000 ellipses, rectangles, triangles and curves, and converted it to a GIF using my noncreatively-named <a href="https://github.com/minimaxir/video-to-gif-osx">Convert Video to GIF</a> tool. The result?</p>

<p><img src="/img/primitive/Pikachu_Record.gif" alt=""></p>

<p>Not too bad, given the input. Again, the GIF can be sized to any resolution, bandwidth considerations aside.</p>

<h2>Abstract 4k Videos</h2>

<p>So how do you get these infinite-quality images into 4k videos? You can export the Primitive renderings as a super-high-resolution PNG and embed them into the video, but there may still be pixellation if you cinematically zoom into the image. SVGs aren&rsquo;t natively supported by video editing programs such as Final Cut Pro and Adobe Premiere. But <em>PDFs</em> are, and there are many SVG-to-PDF converters which preserve the vector information (On macOS, <a href="https://itunes.apple.com/us/app/gapplin/id768053424?mt=12">Gapplin</a> works fine for this purpose).</p>

<p>For vector scaling in Final Cut Pro, you must first <a href="http://www.fcp.co/forum/4-final-cut-pro-x-fcpx/25544-best-way-to-use-illustrador-files-in-fcpx#77676">import through Motion</a> first. Here&rsquo;s a quick 4k/60fps video as proof using the Ferry Building vector image above, with a bit of style.</p>

<div class="responsive-video"><iframe src="http://www.youtube.com/embed/Cv4P6VMvBCw " style="width: 100%; height: 100%; border: none; padding-bottom: 20px" allowfullscreen></iframe></div>

<p>Again, vector images are not a new concept, but given the changes in the media and technology landscape, it is very worthwhile to give them a second chance. Once technology evolves and the media industries start pushing <em>8k media</em> (and they will), having a sensible method of producing high-quality assets pays for itself.</p>

<p>At the least, Primitive will give me some nice background visuals for when I start producing 4k data visualizations videos (yes, that&rsquo;s a thing!).</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[How to Create an Interactive WebGL Network Graph Using R ]]></title>
    <link href="http://minimaxir.com/2016/12/interactive-network/"/>
    <updated>2016-12-05T06:30:00-08:00</updated>
    <id>http://minimaxir.com/2016/12/interactive-network</id>
    <content type="html"><![CDATA[<p>I&rsquo;ve done <a href="http://minimaxir.com/2016/05/reddit-graph/">a lot of experimentation</a> into determining the most efficient way to generate <a href="https://en.wikipedia.org/wiki/Graph_theory">network graphs</a> for visualizing relationships between groups.</p>

<p><img src="/img/reddit-graph/group-006.png" alt=""></p>

<p>Among popular network graph visualization tools for the web, <a href="https://gephi.org">Gephi</a> is a pain to work with and the workflows are not reproducible, <a href="http://sigmajs.org">Sigma.js</a> is better but trickier to configure, and my stop-gap method of exporting network graphs as a PDF has issues on mobile devices.</p>

<p>I&rsquo;ve had success with <a href="https://plot.ly">Plotly</a> for data visualizations, particularly its use for automatically converting R and <a href="http://ggplot2.org">ggplot2</a> charts into <a href="https://plot.ly/ggplot2/">interactive charts</a>. There are a <a href="https://plot.ly/r/network-graphs/">few official tutorials</a> for Plotly network graphs using network-related R packages, but they are not straightforward, and even if I adapted the tutorial for other datasets, the resulting chart would be difficult to customize for maximum usability.</p>

<p>Recently, I had an incredibly stupid idea to try and <em>combine</em> Plotly and the customization of ggplot2 using several layers of R packages to make effective interactive network graphs with very little code. Normally, I would not call this <strong>ONE WEIRD TRICK</strong> because that is clickbait, but this <em>is</em> indeed a weird trick that shouldn&rsquo;t even work. But it does!</p>

<h2>R and Plotly</h2>

<p>For this example of a network graph, we will use the flights paths of domestic airline flights from New York City airports in 2013, provided by the <code>nycflights13</code> <a href="https://cran.r-project.org/web/packages/nycflights13/index.html">R package</a> by Hadley Wickham (usually, tutorials on <a href="https://gephi.org/tutorials/gephi-tutorial-quick_start.pdf">working with networks</a> use the character network map from <em>Les Misèrables</em>, so let&rsquo;s mix it up a bit).</p>

<p>First, we install and load a few R packages:</p>
<div class="highlight"><pre><code class="language-r" data-lang="r"><span class="kn">library</span><span class="p">(</span>dplyr<span class="p">)</span>
<span class="kn">library</span><span class="p">(</span>nycflights13<span class="p">)</span>
<span class="kn">library</span><span class="p">(</span>igraph<span class="p">)</span>
<span class="kn">library</span><span class="p">(</span>intergraph<span class="p">)</span>
<span class="kn">library</span><span class="p">(</span>sna<span class="p">)</span>
<span class="kn">library</span><span class="p">(</span>ggplot2<span class="p">)</span>
<span class="kn">library</span><span class="p">(</span>ggnetwork<span class="p">)</span>
<span class="kn">library</span><span class="p">(</span>plotly<span class="p">)</span>
</code></pre></div>
<ul>
<li><code>dplyr</code> helps aggregate and manipulate tabular data.</li>
<li><code>nycflights13</code> contains the data.</li>
<li><code>igraph</code> allows the creation of network graphs, with <code>sna</code> and <code>intergraph</code> helping allow compatibity with other packages.</li>
<li><code>ggplot2</code> for constructing the chart, with <code>ggnetwork</code> by François Briatte having <a href="https://briatte.github.io/ggnetwork/">special interactions with ggplot2</a> for graphing network graphs specifically. (note: at time-of-writing, ggnetwork must be installed after ggplot2 <a href="https://github.com/briatte/ggnetwork/issues/13">from source</a>).</li>
<li><code>plotly</code> for converting the ggplot2 chart into the final interactive graph.</li>
</ul>

<p>First, let&rsquo;s look at the included <code>flights</code> dataset with nycflights13. The dataset contains 336,776 total flights, with information such as date/time departed, the carrier, and most importantly, the airport where the plane leaves, and the airport where the plane arrives. There are only three airports where the plane leaves from in this dataset: Newark Liberty International Airport (EWR), John F. Kennedy International Airport (JFK), and LaGuardia Airport (LGA). All three airports have approximately the same number of outbound flights.</p>

<p><img src="/img/interactive-network/flight-data.png" alt=""></p>

<p>We want to aggregate the counts of pairs of (origin, destination): the pairs will serve as the <em>edges</em> of our network graph, and the airports will serve as the vertices. The counts of pairs (i.e. number of flights from X to Y) will serve as the <em>weight</em> of the edge during the graph layout phase; nodes with a higher edge weight between them have a greater &ldquo;pull.&rdquo; This aggregation takes just one line of <code>dplyr</code> code.</p>
<div class="highlight"><pre><code class="language-r" data-lang="r">df_edges <span class="o">&lt;-</span> flights <span class="o">%&gt;%</span> group_by<span class="p">(</span>origin<span class="p">,</span> dest<span class="p">)</span> <span class="o">%&gt;%</span> summarize<span class="p">(</span>weight <span class="o">=</span> n<span class="p">())</span>
</code></pre></div>
<p><img src="/img/interactive-network/airport-edges.png" alt=""></p>

<p>Using <code>igraph</code>, we create a network graph object from the aggregated dataset. In this context, the graph is <em>directed</em>, since logically each flight is in one direction.</p>
<div class="highlight"><pre><code class="language-r" data-lang="r">net <span class="o">&lt;-</span> graph.data.frame<span class="p">(</span>df_edges<span class="p">,</span> directed <span class="o">=</span> <span class="bp">T</span><span class="p">)</span>
</code></pre></div>
<p><img src="/img/interactive-network/airport-graph.png" alt=""></p>

<p>As noted by the numbers at the top of the output, there are 107 vertices/unique airports, and 224 unique edges.</p>

<p>We may want to size the vertices of each of the airports in the final chart. We can set that in igraph as well by calculating the degree of each vertex, so nodes with more connected airports will be larger.</p>
<div class="highlight"><pre><code class="language-r" data-lang="r">V<span class="p">(</span>net<span class="p">)</span><span class="o">$</span>degree <span class="o">&lt;-</span> centralization.degree<span class="p">(</span>net<span class="p">)</span><span class="o">$</span>res
</code></pre></div>
<p>Now we can convert the network to a <code>ggplot2</code> friendly format. <code>ggnetwork</code> both calculates x/y coordinates for the nodes of the network graph according to the <a href="https://github.com/gephi/gephi/wiki/Fruchterman-Reingold">Fruchterman-Reingold</a> force-directed layout algorithm (so that nodes connected by higher weights will be closer), and also formats the data into a ggplot2-friendly tabular format. 5,000 iterations of the algorithm on a smaller graph is enough for a quick demo, but you should use as many iterations as possible.</p>
<div class="highlight"><pre><code class="language-r" data-lang="r">df_net <span class="o">&lt;-</span> ggnetwork<span class="p">(</span>net<span class="p">,</span> layout <span class="o">=</span> <span class="s">&quot;fruchtermanreingold&quot;</span><span class="p">,</span> weights <span class="o">=</span> <span class="s">&quot;weight&quot;</span><span class="p">,</span> niter <span class="o">=</span> <span class="m">5000</span><span class="p">)</span>
</code></pre></div>
<p>Now we can plot the graph in R. The base aesthetics for the ggplot are the x/y coordinates of the points, and the xend/yend-points of the edge line segments. ggnetwork exposes a <code>geom_edges()</code> which plots the edges of a network graph, and <code>geom_nodes()</code> which plots the nodes. Both of these functions work by extending normal ggplot2 functions: the edges are actually ggplot2 lines (via <code>geom_segment()</code>), while the nodes are ggplot2 points (via <code>geom_points()</code>).</p>

<p>Style-wise, for the <em>edges</em>, we should apply a low opacity so we can see where they overlap. For the <em>nodes</em>, we can size the nodes depending on their degree, and also set the text to the airport name for use later. We should include a plot title as always, and use the <code>theme_blank()</code> ggplot2 theme included with ggnetwork such that the visualization does not use ggplot2&rsquo;s default theme.</p>
<div class="highlight"><pre><code class="language-r" data-lang="r">plot <span class="o">&lt;-</span> ggplot<span class="p">(</span>df_net<span class="p">,</span> aes<span class="p">(</span>x <span class="o">=</span> x<span class="p">,</span> y <span class="o">=</span> y<span class="p">,</span> xend <span class="o">=</span> xend<span class="p">,</span> yend <span class="o">=</span> yend<span class="p">))</span> <span class="o">+</span>
    geom_edges<span class="p">(</span>size <span class="o">=</span> <span class="m">0.4</span><span class="p">,</span> alpha <span class="o">=</span> <span class="m">0.25</span><span class="p">)</span> <span class="o">+</span>
    geom_nodes<span class="p">(</span>aes<span class="p">(</span>size <span class="o">=</span> degree<span class="p">,</span> text <span class="o">=</span> vertex.names<span class="p">))</span> <span class="o">+</span>
    ggtitle<span class="p">(</span><span class="s">&quot;Network Graph of U.S. Flights Outbound from NYC in 2013&quot;</span><span class="p">)</span> <span class="o">+</span>
    theme_blank<span class="p">()</span>
</code></pre></div>
<p>Putting it all together:</p>

<p><img src="/img/interactive-network/ggplot3.png" alt=""></p>

<p>Nifty! So how does this become interactive? Easily.</p>

<h2>One Weird Trick</h2>

<p>The <code>plotly</code> R package has a <code>ggplotly()</code> function which converts a ggplot2 chart to an interactive Plotly chart, and the resulting parity to the static chart is surprisingly good.</p>

<p>Plotly also has as a <code>toWebGL()</code> function, which turns a Plotly chart to the <a href="https://en.wikipedia.org/wiki/WebGL">WebGL</a> equivalent, allowing the system GPU to power crazy data visualizations with tons of points (my <a href="http://minimaxir.com/2016/08/clickbait-cluster/">Interactive Clickbait chart</a> using this WebGL interface has about 10,000 points and can be manipulated without slowdown). The Plotly documentation is <a href="https://plot.ly/r/webgl-vs-svg/">sparse on the limitations</a> of its WebGL support, but examining the examples indicates that WebGL support is limited to only points and straight lines; no polygons or curves.</p>

<p>Hey, isn&rsquo;t a network graph just points and straight lines?</p>

<p>So let&rsquo;s chain the plot into ggplotly() while setting the hover text to the airport names, and chain that to the WebGL functionality:</p>
<div class="highlight"><pre><code class="language-r" data-lang="r">plot <span class="o">%&gt;%</span> ggplotly<span class="p">(</span>tooltip <span class="o">=</span> <span class="s">&quot;text&quot;</span><span class="p">)</span> <span class="o">%&gt;%</span> toWebGL<span class="p">()</span>
</code></pre></div>
<div id="htmlwidget_container">
  <div id="htmlwidget-51f6648a07e11b1abf04" style="width:100%;height:400px;" class="plotly html-widget"></div>
</div>

<script type="application/json" data-for="htmlwidget-51f6648a07e11b1abf04">{"x":{"data":[{"x":[0.375141921794262,0.398336772616253,null,0.375141921794262,0.231416853311704,null,0.375141921794262,0.0928746359693099,null,0.375141921794262,0.442147435673452,null,0.375141921794262,0.490194633546464,null,0.375141921794262,0.603225203504635,null,0.375141921794262,0.59081153788807,null,0.375141921794262,0.562500489561425,null,0.375141921794262,0.595744847078923,null,0.375141921794262,0.1686611791086,null,0.375141921794262,0.142654710390808,null,0.375141921794262,0.177330930601635,null,0.375141921794262,0.402266165312681,null,0.375141921794262,0.476654226843358,null,0.375141921794262,0.664463361490263,null,0.375141921794262,0.656801959684286,null,0.375141921794262,0.0691764330632262,null,0.375141921794262,0.335464933617332,null,0.375141921794262,0.196727130575685,null,0.375141921794262,0.398446144104167,null,0.375141921794262,0.606082836307656,null,0.375141921794262,0.520107909395174,null,0.375141921794262,0.158776650341963,null,0.375141921794262,0.563994474758855,null,0.375141921794262,0.0238200589019235,null,0.375141921794262,0.434964515152466,null,0.375141921794262,0.332109159196612,null,0.375141921794262,0.207553381065049,null,0.375141921794262,0.190245124570343,null,0.375141921794262,0.44193410115448,null,0.375141921794262,0.464012942332853,null,0.375141921794262,0.348223592984635,null,0.375141921794262,0.1217205768029,null,0.375141921794262,0.436840691975811,null,0.375141921794262,0.674997763793532,null,0.375141921794262,0.0423976548695413,null,0.375141921794262,0.653189750038107,null,0.375141921794262,0.556679418800422,null,0.375141921794262,0.174000555485329,null,0.375141921794262,0.367056482353336,null,0.375141921794262,0.18315313322535,null,0.375141921794262,0.668277727225314,null,0.375141921794262,0.634074632241642,null,0.375141921794262,0.248454202401703,null,0.375141921794262,0.500788657268025,null,0.375141921794262,0.380158437151396,null,0.375141921794262,0.154241945142639,null,0.375141921794262,0.279904368800208,null,0.375141921794262,0.346849932058201,null,0.375141921794262,0.362011359179019,null,0.375141921794262,0.433451836740657,null,0.375141921794262,0.568430460694556,null,0.375141921794262,0.681209464401851,null,0.375141921794262,0.362520337066271,null,0.375141921794262,0.520989301885846,null,0.375141921794262,0.627050834716232,null,0.375141921794262,0.404070049517213,null,0.375141921794262,0.645842634157814,null,0.375141921794262,0.200852084173203,null,0.375141921794262,0.14735862416214,null,0.375141921794262,0.408780079201348,null,0.375141921794262,0.499629189203938,null,0.375141921794262,0.531773138536121,null,0.375141921794262,0.488714420679938,null,0.375141921794262,0.556533455426346,null,0.375141921794262,0.292463432908503,null,0.375141921794262,0.216088281672444,null,0.375141921794262,0.156296749226243,null,0.521403286626722,0.750818281003784,null,0.521403286626722,0.43545836434104,null,0.521403286626722,0.427912880330646,null,0.521403286626722,0.816466804778435,null,0.521403286626722,0.241285731394685,null,0.521403286626722,0.531810769022582,null,0.521403286626722,0.505897317405868,null,0.521403286626722,0.605126259728004,null,0.521403286626722,0.87060842793947,null,0.521403286626722,0.5873270521506,null,0.521403286626722,0.574885544124051,null,0.521403286626722,0.600219422263835,null,0.521403286626722,0.330479335262988,null,0.521403286626722,0.167301895659982,null,0.521403286626722,0.427389022095212,null,0.521403286626722,0.493945663096591,null,0.521403286626722,0.668615904804107,null,0.521403286626722,0.667204341091844,null,0.521403286626722,0.340432890558217,null,0.521403286626722,0.197641812575988,null,0.521403286626722,0.424263504260501,null,0.521403286626722,0.618020109274438,null,0.521403286626722,0.532847510026951,null,0.521403286626722,0.163880496510408,null,0.521403286626722,0.567379227972389,null,0.521403286626722,0.866131098966022,null,0.521403286626722,0.454535649459538,null,0.521403286626722,0.345045006660964,null,0.521403286626722,0.21312475718605,null,0.521403286626722,0.198750811921407,null,0.521403286626722,0.659142578049148,null,0.521403286626722,0.843504166296951,null,0.521403286626722,0.477664733700597,null,0.521403286626722,0.476234788750302,null,0.521403286626722,0.350099512882592,null,0.521403286626722,0.463326215609288,null,0.521403286626722,0.835144570998741,null,0.521403286626722,0.684183642178402,null,0.521403286626722,0.846142494357672,null,0.521403286626722,0.885871897653275,null,0.521403286626722,0.39332314244744,null,0.521403286626722,0.650637973739079,null,0.521403286626722,0.570886886619552,null,0.521403286626722,0.180895010452889,null,0.521403286626722,0.388235599662527,null,0.521403286626722,0.181071014328054,null,0.521403286626722,0.668300300206767,null,0.521403286626722,0.645442796507026,null,0.521403286626722,0.259460402233345,null,0.521403286626722,0.521018205051867,null,0.521403286626722,0.390105270228954,null,0.521403286626722,0.483692356075904,null,0.521403286626722,0.157624248823495,null,0.521403286626722,0.385585326200774,null,0.521403286626722,0.29272576755674,null,0.521403286626722,0.354590116934059,null,0.521403286626722,0.37124788790749,null,0.521403286626722,0.445457243430657,null,0.521403286626722,0.882170875002285,null,0.521403286626722,0.57373155931436,null,0.521403286626722,0.846321838922237,null,0.521403286626722,0.68874120606007,null,0.521403286626722,0.703909136774732,null,0.521403286626722,0.364702766017597,null,0.521403286626722,0.541538920728358,null,0.521403286626722,0.626167487094621,null,0.521403286626722,0.414870529009423,null,0.521403286626722,0.643407035246014,null,0.521403286626722,0.751440995258101,null,0.521403286626722,0.866871530927171,null,0.521403286626722,0.198673390185873,null,0.521403286626722,0.148882035026252,null,0.521403286626722,0.424819988421373,null,0.521403286626722,0.890354401571159,null,0.521403286626722,0.875108152947903,null,0.521403286626722,0.834324919709448,null,0.521403286626722,0.807728656063105,null,0.521403286626722,0.570484572625621,null,0.521403286626722,0.540575009029753,null,0.521403286626722,0.788739572051865,null,0.521403286626722,0.501781512069948,null,0.521403286626722,0.573282573695601,null,0.521403286626722,0.617707664388415,null,0.521403286626722,0.30468783901352,null,0.521403286626722,0.225983396674046,null,0.521403286626722,0.15615498564717,null,0.671140685588431,0.912815072204364,null,0.671140685588431,0.954582330919281,null,0.671140685588431,0.423579027344162,null,0.671140685588431,0.826733312617325,null,0.671140685588431,0.46111216958178,null,0.671140685588431,0.523376677952971,null,0.671140685588431,0.624039874399396,null,0.671140685588431,0.87470211024138,null,0.671140685588431,0.618461211574893,null,0.671140685588431,0.58894246702335,null,0.671140685588431,0.966844932439542,null,0.671140685588431,0.631446987517471,null,0.671140685588431,0.440646916775815,null,0.671140685588431,0.50013146938416,null,0.671140685588431,0.682418870529126,null,0.671140685588431,0.677440629488422,null,0.671140685588431,0.349279771512629,null,0.671140685588431,0.420678600389709,null,0.671140685588431,0.631421228412645,null,0.671140685588431,0.547399438282292,null,0.671140685588431,0.588400612211921,null,0.671140685588431,0.864598406346657,null,0.671140685588431,0.456225312904585,null,0.671140685588431,0.853251619940646,null,0.671140685588431,0.484768637491492,null,0.671140685588431,0.490201233313888,null,0.671140685588431,0.357485317157183,null,0.671140685588431,0.461766951300564,null,0.671140685588431,0.84187595203203,null,0.671140685588431,0.690063967426859,null,0.671140685588431,0.84351930888583,null,0.671140685588431,0.88755105473655,null,0.671140685588431,0.97836713491032,null,0.671140685588431,0.673919270057091,null,0.671140685588431,0.588517349902531,null,0.671140685588431,0.387136625885949,null,0.671140685588431,0.688218313991044,null,0.671140685588431,0.658106253756941,null,0.671140685588431,0.543685777322744,null,0.671140685588431,0.402199379964802,null,0.671140685588431,0.910931255352872,null,0.671140685588431,0.953164981737936,null,0.671140685588431,0.364963250124481,null,0.671140685588431,0.382656067064239,null,0.671140685588431,0.459149576310406,null,0.671140685588431,0.882046335378367,null,0.671140685588431,0.589192224857842,null,0.671140685588431,0.84691577856393,null,0.671140685588431,0.684611589953847,null,0.671140685588431,0.947319339337379,null,0.671140685588431,0.808790133859673,null,0.671140685588431,0.368025790799691,null,0.671140685588431,0.569825431470493,null,0.671140685588431,0.648271884465125,null,0.671140685588431,0.427627978099028,null,0.671140685588431,0.66879035203972,null,0.671140685588431,0.764901105705134,null,0.671140685588431,0.874652504924122,null,0.671140685588431,0.439155327003178,null,0.671140685588431,0.894382978650812,null,0.671140685588431,0.881479125122771,null,0.671140685588431,0.95855460672269,null,0.671140685588431,0.830925437832968,null,0.671140685588431,0.819215511370555,null,0.671140685588431,0.867349257682671,null,0.671140685588431,0.518857907477492,null,0.671140685588431,0.552830416638066,null,0.671140685588431,0.800986045002673,null,0.671140685588431,0.509644020442292,null,0.671140685588431,0.601514639570558],"y":[0.569160995688867,0.446610941607707,null,0.569160995688867,0.355888963266907,null,0.569160995688867,0.834852253134975,null,0.569160995688867,0.909220427999938,null,0.569160995688867,0.732468182156298,null,0.569160995688867,0.31596162521941,null,0.569160995688867,0.419431910874468,null,0.569160995688867,0.791438300229966,null,0.569160995688867,0.513560740080228,null,0.569160995688867,0.562515151270471,null,0.569160995688867,0.870464779365022,null,0.569160995688867,0.907219809102619,null,0.569160995688867,0.611404626497019,null,0.569160995688867,0.338866019563371,null,0.569160995688867,0.54574073725109,null,0.569160995688867,0.706905669147101,null,0.569160995688867,0.790750513602846,null,0.569160995688867,0.652893102514717,null,0.569160995688867,0.507330838524802,null,0.569160995688867,0.397382531719702,null,0.569160995688867,0.766391283806825,null,0.569160995688867,0.794267718308876,null,0.569160995688867,0.400502456724901,null,0.569160995688867,0.353917095092187,null,0.569160995688867,0.681102634202229,null,0.569160995688867,0.330126896249326,null,0.569160995688867,0.226078960900972,null,0.569160995688867,0.433071950534731,null,0.569160995688867,0.318177218131819,null,0.569160995688867,0.52108692904819,null,0.569160995688867,0.795580474185788,null,0.569160995688867,0.602473048893196,null,0.569160995688867,0.890637266562741,null,0.569160995688867,0.38541974057496,null,0.569160995688867,0.673983644043835,null,0.569160995688867,0.743738953933047,null,0.569160995688867,0.391621046140257,null,0.569160995688867,0.738554817935996,null,0.569160995688867,0.362277075606099,null,0.569160995688867,0.499892480849464,null,0.569160995688867,0.596306756988927,null,0.569160995688867,0.48663250019003,null,0.569160995688867,0.731603132724176,null,0.569160995688867,0.248224947253395,null,0.569160995688867,0.660967609845298,null,0.569160995688867,0.757704690180885,null,0.569160995688867,0.440833042358277,null,0.569160995688867,0.29230613907727,null,0.569160995688867,0.692108547150632,null,0.569160995688867,0.722552593201093,null,0.569160995688867,0.779566772792364,null,0.569160995688867,0.293658571587712,null,0.569160995688867,0.623872010701402,null,0.569160995688867,0.558400508620058,null,0.569160995688867,0.567379900773263,null,0.569160995688867,0.35140592652204,null,0.569160995688867,0.776667140978426,null,0.569160995688867,0.439970611795418,null,0.569160995688867,0.630420659925768,null,0.569160995688867,0.481745560133813,null,0.569160995688867,0.682727918749366,null,0.569160995688867,0.92057629612655,null,0.569160995688867,0.290597906211216,null,0.569160995688867,0.293020895485337,null,0.569160995688867,0.646450184799606,null,0.569160995688867,0.234796574249824,null,0.569160995688867,0.282678203793642,null,0.569160995688867,0.525240441471489,null,0.431120229838299,0.112745725388303,null,0.431120229838299,0.0444056056746168,null,0.431120229838299,0.423956953801238,null,0.431120229838299,0.363966682255993,null,0.431120229838299,0.342683823825281,null,0.431120229838299,0.0249917953368865,null,0.431120229838299,0.72793955906703,null,0.431120229838299,0.317512112957195,null,0.431120229838299,0.456188967076627,null,0.431120229838299,0.412103712493418,null,0.431120229838299,0.785832962930004,null,0.431120229838299,0.492145540267895,null,0.431120229838299,0.0790955843221721,null,0.431120229838299,0.553542181247174,null,0.431120229838299,0.610303574424963,null,0.431120229838299,0.339928250070011,null,0.431120229838299,0.529803288783676,null,0.431120229838299,0.69598769885774,null,0.431120229838299,0.656008187370694,null,0.431120229838299,0.494352565072096,null,0.431120229838299,0.383595999466942,null,0.431120229838299,0.758648437487308,null,0.431120229838299,0.790299043594228,null,0.431120229838299,0.38811812093232,null,0.431120229838299,0.356415884525852,null,0.431120229838299,0.567791599633868,null,0.431120229838299,0.326915446133837,null,0.431120229838299,0.220443275046877,null,0.431120229838299,0.418347411815101,null,0.431120229838299,0.30702377903189,null,0.431120229838299,0.0658807267901205,null,0.431120229838299,0.323211485611884,null,0.431120229838299,0.486820205426182,null,0.431120229838299,0.794043440951209,null,0.431120229838299,0.604151876231488,null,0.431120229838299,0.378505154407203,null,0.431120229838299,0.430136789994817,null,0.431120229838299,0.661806919823414,null,0.431120229838299,0.59297633568824,null,0.431120229838299,0.497708160513814,null,0.431120229838299,0.552001647928522,null,0.431120229838299,0.386350248794115,null,0.431120229838299,0.730944243145205,null,0.431120229838299,0.350136815874867,null,0.431120229838299,0.468332796516163,null,0.431120229838299,0.589271318459943,null,0.431120229838299,0.473002761793368,null,0.431120229838299,0.721893780615461,null,0.431120229838299,0.239720531920411,null,0.431120229838299,0.65071679012198,null,0.431120229838299,0.759482783021375,null,0.431120229838299,0.0328254834407966,null,0.431120229838299,0.428457965102359,null,0.431120229838299,0.0552949392361833,null,0.431120229838299,0.282301943960739,null,0.431120229838299,0.695332510166948,null,0.431120229838299,0.725196030215553,null,0.431120229838299,0.779233255836001,null,0.431120229838299,0.535995349933078,null,0.431120229838299,0.296494673471202,null,0.431120229838299,0.525245247427962,null,0.431120229838299,0.610013650135566,null,0.431120229838299,0.0808642105121057,null,0.431120229838299,0.528942468255864,null,0.431120229838299,0.542473592025233,null,0.431120229838299,0.350324392742041,null,0.431120229838299,0.777532139878526,null,0.431120229838299,0.429528939963174,null,0.431120229838299,0.264228305333004,null,0.431120229838299,0.368840712442177,null,0.431120229838299,0.625797494890473,null,0.431120229838299,0.470181257271697,null,0.431120229838299,0.683351609245627,null,0.431120229838299,0.44656137124754,null,0.431120229838299,0.401730764927989,null,0.431120229838299,0.626347514647346,null,0.431120229838299,0.306693554067584,null,0.431120229838299,0.0591609727033197,null,0.431120229838299,0.293567152525727,null,0.431120229838299,0.278705189823673,null,0.431120229838299,0.294645590613804,null,0.431120229838299,0.632043822399884,null,0.431120229838299,0.0355237610241484,null,0.431120229838299,0.227639887177766,null,0.431120229838299,0.272639222721547,null,0.431120229838299,0.514741952975215,null,0.606625452346477,0.859535865093592,null,0.606625452346477,0.739756232183998,null,0.606625452346477,0.436221837301925,null,0.606625452346477,0.379056237744055,null,0.606625452346477,0.91312608624495,null,0.606625452346477,0.736407738618357,null,0.606625452346477,0.322051155219775,null,0.606625452346477,0.471785034415842,null,0.606625452346477,0.429141262769335,null,0.606625452346477,0.787787381108505,null,0.606625452346477,0.833036829113688,null,0.606625452346477,0.529669391638273,null,0.606625452346477,0.62992689580365,null,0.606625452346477,0.337099350037149,null,0.606625452346477,0.567734378152831,null,0.606625452346477,0.692955070500771,null,0.606625452346477,0.670610502274201,null,0.606625452346477,0.389006460104837,null,0.606625452346477,0.758440984144511,null,0.606625452346477,0.794411052861901,null,0.606625452346477,0.3588378789462,null,0.606625452346477,0.580367806858259,null,0.606625452346477,0.325729957208961,null,0.606625452346477,0.33601079954507,null,0.606625452346477,0.517288855379863,null,0.606625452346477,0.800572023199591,null,0.606625452346477,0.620790174377316,null,0.606625452346477,0.38007998333845,null,0.606625452346477,0.4471248276189,null,0.606625452346477,0.658734961431972,null,0.606625452346477,0.604444621877097,null,0.606625452346477,0.512199211193021,null,0.606625452346477,0.784584825804592,null,0.606625452346477,0.403164457722146,null,0.606625452346477,0.73460721437942,null,0.606625452346477,0.48490907838717,null,0.606625452346477,0.504514992091818,null,0.606625452346477,0.720052366793743,null,0.606625452346477,0.66526726504584,null,0.606625452346477,0.769731814483659,null,0.606625452346477,0.908715323244131,null,0.606625452346477,0.800506299098387,null,0.606625452346477,0.708573846552134,null,0.606625452346477,0.73715564666885,null,0.606625452346477,0.787435383216903,null,0.606625452346477,0.54950894420136,null,0.606625452346477,0.297359040053189,null,0.606625452346477,0.540951316685004,null,0.606625452346477,0.615033702946875,null,0.606625452346477,0.768513227719205,null,0.606625452346477,0.976569368809676,null,0.606625452346477,0.547005982613965,null,0.606625452346477,0.57460788618157,null,0.606625452346477,0.359950196244683,null,0.606625452346477,0.786570205626223,null,0.606625452346477,0.454199922220728,null,0.606625452346477,0.273611892389914,null,0.606625452346477,0.382898722233648,null,0.606625452346477,0.697573634631695,null,0.606625452346477,0.461249178084479,null,0.606625452346477,0.41642819083354,null,0.606625452346477,0.862476091840542,null,0.606625452346477,0.635182177283979,null,0.606625452346477,0.318957682534318,null,0.606625452346477,0.939468290680027,null,0.606625452346477,0.921633477814331,null,0.606625452346477,0.292204861042371,null,0.606625452346477,0.289459298431681,null,0.606625452346477,0.292139116145475,null,0.606625452346477,0.644342212099804],"text":"","key":null,"type":"scattergl","mode":"lines","name":"","line":{"width":1.51181102362205,"color":"rgba(0,0,0,0.25)","dash":"solid"},"hoveron":"points","showlegend":false,"xaxis":"x","yaxis":"y","hoverinfo":"text"},{"x":[0.521403286626722,0.671140685588431,0.375141921794262,0.765433674821922,0.43003460140041,0.402985942440944,0.84084345291753,0.21744563280704,0.532451210931874,0.504593085123351,0.619957582285487,0.8955442569087,0.611347637416103,0.578612821595516,0.619986741987121,0.31856048451924,0.143674118503684,0.41577369478791,0.486737879369046,0.689381852752525,0.67926017758219,0.324759599339248,0.173105393811894,0.401806967433101,0.625093468651365,0.533643660739264,0.139059392615991,0.580482498031979,0.889371263506008,0.441034023506735,0.328997789998789,0.188146187976479,0.175417155899145,0.667964135344807,0.867209259774224,0.462224807828379,0.473147173626519,0.332510771213912,0.444798800647148,0.860144448181576,0.698597335052531,0.868517308402764,0.910464825406683,0.674260653107368,0.574957868338127,0.15657340761276,0.364158010341015,0.158399345383069,0.69234220151995,0.655252166509386,0.239274886254818,0.520974365455486,0.380823367989187,0.481335870748195,0.132624918275902,0.377088499410607,0.271772128789835,0.341243594957798,0.359879117638533,0.440128461028902,0.906177103569992,0.582788790098704,0.870334570284953,0.705819372835664,0.715461522230034,0.343495780883717,0.545987437918483,0.645964077621439,0.407521881572988,0.668404909032591,0.77167646526947,0.8914749306502,0.177266541298859,0.124018346349651,0.415880094563685,0.915332535986102,0.900022297154391,0.855535494382103,0.830657240556608,0.573755057967315,0.544026072872229,0.810457837840253,0.498223697293128,0.579532690993623,0.623620987764108,0.286462405990908,0.20395324106583,0.131785501344588,0.93008668223084,0.977210590176681,0.44698052174715,0.986694656148139,1,0.926474161477072,0.97376640007797,0.968887131203832,0.817508248450742,0.977227846723922,0.880044881121601,0.507977017129905,0.0746705351486458,0.127382447038518,0.164705115708696,0.0489287697707225,0,0.106243608944116,0.0202596198892614],"y":[0.431120229838299,0.606625452346477,0.569160995688867,0.09246296759897,0.0200010406187948,0.422047040860041,0.358418797478641,0.335157224371917,0,0.752905515450738,0.297386709329046,0.457979060263399,0.405174680562283,0.810553549546238,0.507450868456385,0.0571196657532421,0.561710911053716,0.632441419205886,0.315989832124438,0.543723612264242,0.717888767473633,0.675485043953967,0.499144657958617,0.372609464357107,0.78262691923918,0.815286363259276,0.38513268939525,0.33512494011877,0.577005434457349,0.305874863997627,0.201273328844625,0.417312481748539,0.29804934330396,0.0424888451454258,0.315269915034613,0.506482572757214,0.818852040928785,0.621918028502378,0.361720194031298,0.430058426462415,0.682233506854299,0.6041283622506,0.502201255718198,0.378166788678553,0.755610558391853,0.344352385454589,0.47506107210985,0.599806755197404,0.479857466837873,0.744888916191422,0.224971127027988,0.675716751683746,0.782695845956098,0.00793679169333242,0.428275011085709,0.0317831563497688,0.268665777988368,0.716471818366063,0.747461498155205,0.803658735935986,0.542973959390201,0.273193030384949,0.532201448438718,0.628271147762158,0.0586934552184285,0.542181191061762,0.567074622385955,0.335056943593166,0.801427691365256,0.429202893723559,0.249547509938375,0.364405318201653,0.638710543358149,0.472788360145209,0.706698521200172,0.44760674254476,0.399660639700303,0.639580485668839,0.296729618443331,0.0343758173552134,0.268806495055556,0.266323068392153,0.26990004648938,0.656249938027159,0.0112331742330788,0.210527505954269,0.260820921495153,0.520321221280843,0.877610473999273,0.750384584971701,0.933748805015228,0.848235133910355,0.797115553956288,0.928296387291171,0.814668981131777,0.781155630734667,1,0.879098670095927,0.961004797952491,0.944141392538796,0.851987325743841,0.890257656167,0.928797315869835,0.805414487525129,0.688692416406541,0.910270490085591,0.755353918729029],"text":["EWR","JFK","LGA","ALB","ANC","ATL","AUS","AVL","BDL","BNA","BOS","BQN","BTV","BUF","BWI","BZN","CAE","CHS","CLE","CLT","CMH","CVG","DAY","DCA","DEN","DFW","DSM","DTW","EGE","FLL","GRR","GSO","GSP","HDN","HNL","HOU","IAD","IAH","IND","JAC","JAX","LAS","LAX","MCI","MCO","MDW","MEM","MHT","MIA","MKE","MSN","MSP","MSY","MTJ","MYR","OKC","OMA","ORD","ORF","PBI","PDX","PHL","PHX","PIT","PVD","PWM","RDU","RIC","ROC","RSW","SAN","SAT","SAV","SBN","SDF","SEA","SFO","SJU","SLC","SNA","STL","STT","SYR","TPA","TUL","TVC","TYS","XNA","ABQ","ACK","BHM","BUR","LGB","MVY","OAK","PSE","PSP","SJC","SMF","SRQ","BGR","CAK","CHO","CRW","EYW","ILM","LEX"],"key":null,"type":"scattergl","mode":"markers","marker":{"autocolorscale":false,"color":"rgba(0,0,0,1)","opacity":1,"size":[22.6771653543307,20.8059185906475,20.6820886488173,3.77952755905512,3.77952755905512,6.67829287123416,5.82926416836526,5.82926416836526,3.77952755905512,6.67829287123416,6.67829287123416,5.82926416836526,6.67829287123416,6.67829287123416,6.67829287123416,3.77952755905512,5.82926416836526,6.67829287123416,6.67829287123416,6.67829287123416,6.67829287123416,6.67829287123416,5.82926416836526,6.67829287123416,6.67829287123416,6.67829287123416,5.82926416836526,6.67829287123416,5.82926416836526,6.67829287123416,5.82926416836526,5.82926416836526,5.82926416836526,3.77952755905512,5.82926416836526,6.67829287123416,6.67829287123416,6.67829287123416,6.67829287123416,5.82926416836526,6.67829287123416,5.82926416836526,5.82926416836526,6.67829287123416,6.67829287123416,5.82926416836526,6.67829287123416,5.82926416836526,6.67829287123416,6.67829287123416,5.82926416836526,6.67829287123416,6.67829287123416,3.77952755905512,5.82926416836526,3.77952755905512,5.82926416836526,6.67829287123416,6.67829287123416,6.67829287123416,5.82926416836526,6.67829287123416,5.82926416836526,6.67829287123416,3.77952755905512,6.67829287123416,6.67829287123416,6.67829287123416,6.67829287123416,6.67829287123416,5.82926416836526,5.82926416836526,5.82926416836526,5.82926416836526,6.67829287123416,5.82926416836526,5.82926416836526,5.82926416836526,5.82926416836526,3.77952755905512,6.67829287123416,5.82926416836526,6.67829287123416,6.67829287123416,3.77952755905512,5.82926416836526,5.82926416836526,5.82926416836526,3.77952755905512,3.77952755905512,5.82926416836526,3.77952755905512,3.77952755905512,3.77952755905512,3.77952755905512,3.77952755905512,3.77952755905512,3.77952755905512,3.77952755905512,5.82926416836526,3.77952755905512,3.77952755905512,3.77952755905512,3.77952755905512,3.77952755905512,3.77952755905512,3.77952755905512],"symbol":"circle","line":{"width":1.88976377952756,"color":"rgba(0,0,0,1)"}},"hoveron":"points","showlegend":false,"xaxis":"x","yaxis":"y","hoverinfo":"text","name":""}],"layout":{"margin":{"t":48.079701120797,"r":7.97011207970112,"b":16.9364881693649,"l":11.9551681195517},"plot_bgcolor":"rgba(255,255,255,1)","paper_bgcolor":"rgba(255,255,255,1)","font":{"color":"rgba(0,0,0,1)","family":"","size":15.9402241594022},"title":"Network Graph of U.S. Flights Outbound from NYC in 2013","titlefont":{"color":"rgba(0,0,0,1)","family":"","size":19.1282689912827},"xaxis":{"domain":[0,1],"type":"linear","autorange":false,"tickmode":"array","range":[-0.05,1.05],"ticktext":["0.00","0.25","0.50","0.75","1.00"],"tickvals":[0,0.25,0.5,0.75,1],"ticks":"","tickcolor":null,"ticklen":3.98505603985056,"tickwidth":0,"showticklabels":false,"tickfont":{"color":null,"family":null,"size":0},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"showgrid":false,"gridcolor":null,"gridwidth":0,"zeroline":false,"anchor":"y","title":"","titlefont":{"color":null,"family":null,"size":0},"hoverformat":".2f"},"yaxis":{"domain":[0,1],"type":"linear","autorange":false,"tickmode":"array","range":[-0.05,1.05],"ticktext":["0.00","0.25","0.50","0.75","1.00"],"tickvals":[0,0.25,0.5,0.75,1],"ticks":"","tickcolor":null,"ticklen":3.98505603985056,"tickwidth":0,"showticklabels":false,"tickfont":{"color":null,"family":null,"size":0},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"showgrid":false,"gridcolor":null,"gridwidth":0,"zeroline":false,"anchor":"x","title":"","titlefont":{"color":null,"family":null,"size":0},"hoverformat":".2f"},"shapes":[{"type":"rect","fillcolor":null,"line":{"color":null,"width":0,"linetype":[]},"yref":"paper","xref":"paper","x0":0,"x1":1,"y0":0,"y1":1}],"showlegend":false,"legend":{"bgcolor":"rgba(255,255,255,1)","bordercolor":"transparent","borderwidth":1.88976377952756,"font":{"color":"rgba(0,0,0,1)","family":"","size":12.7521793275218}},"hovermode":"closest","height":400},"source":"A","config":{"modeBarButtonsToAdd":[{"name":"Collaborate","icon":{"width":1000,"ascent":500,"descent":-50,"path":"M487 375c7-10 9-23 5-36l-79-259c-3-12-11-23-22-31-11-8-22-12-35-12l-263 0c-15 0-29 5-43 15-13 10-23 23-28 37-5 13-5 25-1 37 0 0 0 3 1 7 1 5 1 8 1 11 0 2 0 4-1 6 0 3-1 5-1 6 1 2 2 4 3 6 1 2 2 4 4 6 2 3 4 5 5 7 5 7 9 16 13 26 4 10 7 19 9 26 0 2 0 5 0 9-1 4-1 6 0 8 0 2 2 5 4 8 3 3 5 5 5 7 4 6 8 15 12 26 4 11 7 19 7 26 1 1 0 4 0 9-1 4-1 7 0 8 1 2 3 5 6 8 4 4 6 6 6 7 4 5 8 13 13 24 4 11 7 20 7 28 1 1 0 4 0 7-1 3-1 6-1 7 0 2 1 4 3 6 1 1 3 4 5 6 2 3 3 5 5 6 1 2 3 5 4 9 2 3 3 7 5 10 1 3 2 6 4 10 2 4 4 7 6 9 2 3 4 5 7 7 3 2 7 3 11 3 3 0 8 0 13-1l0-1c7 2 12 2 14 2l218 0c14 0 25-5 32-16 8-10 10-23 6-37l-79-259c-7-22-13-37-20-43-7-7-19-10-37-10l-248 0c-5 0-9-2-11-5-2-3-2-7 0-12 4-13 18-20 41-20l264 0c5 0 10 2 16 5 5 3 8 6 10 11l85 282c2 5 2 10 2 17 7-3 13-7 17-13z m-304 0c-1-3-1-5 0-7 1-1 3-2 6-2l174 0c2 0 4 1 7 2 2 2 4 4 5 7l6 18c0 3 0 5-1 7-1 1-3 2-6 2l-173 0c-3 0-5-1-8-2-2-2-4-4-4-7z m-24-73c-1-3-1-5 0-7 2-2 3-2 6-2l174 0c2 0 5 0 7 2 3 2 4 4 5 7l6 18c1 2 0 5-1 6-1 2-3 3-5 3l-174 0c-3 0-5-1-7-3-3-1-4-4-5-6z"},"click":"function(gd) { \n        // is this being viewed in RStudio?\n        if (location.search == '?viewer_pane=1') {\n          alert('To learn about plotly for collaboration, visit:\\n https://cpsievert.github.io/plotly_book/plot-ly-for-collaboration.html');\n        } else {\n          window.open('https://cpsievert.github.io/plotly_book/plot-ly-for-collaboration.html', '_blank');\n        }\n      }"}],"modeBarButtonsToRemove":["sendDataToCloud"]},".plotlyWebGl":true,"base_url":"https://plot.ly"},"evals":["config.modeBarButtonsToAdd.0.click"],"jsHooks":[]}</script>

<script type="application/htmlwidget-sizing" data-for="htmlwidget-51f6648a07e11b1abf04">{"viewer":{"width":"100%","height":400,"padding":0,"fill":false},"browser":{"width":"100%","height":400,"padding":0,"fill":false}}</script>

<p>You can now mouse over the points to see the corresponding airport. Not too shabby!</p>

<p>When generating the interactive charts in R, a browser window will pop up with the chart, and the chart contains an option to save the chart to a Plotly account. This is the most practical way to embed the chart for a blog service such as Wordpress or Medium. (in my case, I embed the charts directly into the blog post as static data so it will always be accessible).</p>

<p>With a little more data manipulation, we can integrate more metadata into the network (not shown; however all code is available in <a href="http://minimaxir.com/notebooks/interactive-network/">this R Notebook</a>). The nycflights13 package also contains an <code>airports</code> dataset with the full name of the airports and their location in latitude/longitude coordinates. We can map that data into the corresponding vertices, and use some of it for more informative tooltip popovers, such as including the total number of flights to/from each airport. Additionally, we can set the colors of edges to correspond to the NYC origin airport. The algorithm is also set to 50,000 iterations for even further convergence.</p>

<p>The result is the network graph you saw at the beginning of the post.</p>

<p><img src="/img/interactive-network/ggplot1.png" alt=""></p>

<p>Looking at this network graph, you can clearly see that some airports receive flights from all 3 airports, some from only 2 airports, and some from only 1 airport. I admit I am not an expert in the inner-workings of the airline industry, but what would cause this?</p>

<h2>Sea to Shining Sea</h2>

<p>Another approach is to map the airports by their physical location. This is easy to do on the ggplot2-side since the latitude/longitudes were added to the data set for the previous chart, so all we have to do is tell ggplot2 to use those instead, where the base aesthetics of the ggplot statement now become:</p>
<div class="highlight"><pre><code class="language-r" data-lang="r">ggplot<span class="p">(</span>df_net<span class="p">,</span> aes<span class="p">(</span>x <span class="o">=</span> lon<span class="p">,</span> y <span class="o">=</span> lat<span class="p">,</span> xend <span class="o">=</span> endlon<span class="p">,</span> yend <span class="o">=</span> endlat<span class="p">))</span>
</code></pre></div>
<p>The result is a highly-abstract depiction of the United States. (+ Alaska and Hawaii)</p>

<p><img src="/img/interactive-network/ggplot2.png" alt=""></p>

<p>Again, one line of code makes it interactive.</p>

<div id="htmlwidget_container">
  <div id="htmlwidget-ae87c24ac18b3ac8a6fa" style="width:100%;height:400px;" class="plotly html-widget"></div>
</div>

<script type="application/json" data-for="htmlwidget-ae87c24ac18b3ac8a6fa">{"x":{"data":[{"x":[-74.168667,-73.801692,null,-74.168667,-149.996361,null,-74.168667,-84.428067,null,-74.168667,-97.669889,null,-74.168667,-82.541806,null,-74.168667,-72.683222,null,-74.168667,-86.678194,null,-74.168667,-71.005181,null,-74.168667,-73.153278,null,-74.168667,-78.732167,null,-74.168667,-76.668333,null,-74.168667,-111.160151,null,-74.168667,-81.119528,null,-74.168667,-80.040528,null,-74.168667,-81.849794,null,-74.168667,-80.943139,null,-74.168667,-82.891889,null,-74.168667,-84.667822,null,-74.168667,-84.219375,null,-74.168667,-77.037722,null,-74.168667,-104.673178,null,-74.168667,-97.037997,null,-74.168667,-93.663083,null,-74.168667,-83.353389,null,-74.168667,-106.917694,null,-74.168667,-80.15275,null,-74.168667,-85.522806,null,-74.168667,-79.937306,null,-74.168667,-82.218889,null,-74.168667,-107.21766,null,-74.168667,-157.922428,null,-74.168667,-95.278889,null,-74.168667,-77.455811,null,-74.168667,-95.341442,null,-74.168667,-86.294383,null,-74.168667,-110.73775,null,-74.168667,-81.687861,null,-74.168667,-115.15225,null,-74.168667,-118.408075,null,-74.168667,-73.872608,null,-74.168667,-94.713905,null,-74.168667,-81.308994,null,-74.168667,-87.752417,null,-74.168667,-89.976667,null,-74.168667,-71.435667,null,-74.168667,-80.290556,null,-74.168667,-87.896583,null,-74.168667,-89.337514,null,-74.168667,-93.221767,null,-74.168667,-90.258028,null,-74.168667,-107.894242,null,-74.168667,-78.928333,null,-74.168667,-97.600733,null,-74.168667,-95.894069,null,-74.168667,-87.904842,null,-74.168667,-76.201222,null,-74.168667,-80.095589,null,-74.168667,-122.5975,null,-74.168667,-75.241139,null,-74.168667,-112.011583,null,-74.168667,-80.232872,null,-74.168667,-71.420383,null,-74.168667,-70.309281,null,-74.168667,-78.787472,null,-74.168667,-77.319667,null,-74.168667,-77.672389,null,-74.168667,-81.755167,null,-74.168667,-117.189667,null,-74.168667,-98.469778,null,-74.168667,-81.202139,null,-74.168667,-86.31725,null,-74.168667,-85.7364989,null,-74.168667,-122.309306,null,-74.168667,-122.374889,null,-74.168667,-111.977772,null,-74.168667,-117.868222,null,-74.168667,-90.370028,null,-74.168667,-76.106311,null,-74.168667,-82.53325,null,-74.168667,-95.888111,null,-74.168667,-85.582235,null,-74.168667,-83.994028,null,-74.168667,-94.3068111],"y":[40.6925,42.748267,null,40.6925,61.174361,null,40.6925,33.636719,null,40.6925,30.194528,null,40.6925,35.436194,null,40.6925,41.938889,null,40.6925,36.124472,null,40.6925,42.364347,null,40.6925,44.471861,null,40.6925,42.940525,null,40.6925,39.175361,null,40.6925,45.777643,null,40.6925,33.938833,null,40.6925,32.898647,null,40.6925,41.411689,null,40.6925,35.214,null,40.6925,39.997972,null,40.6925,39.048836,null,40.6925,39.902375,null,40.6925,38.852083,null,40.6925,39.861656,null,40.6925,32.896828,null,40.6925,41.533972,null,40.6925,42.212444,null,40.6925,39.642556,null,40.6925,26.072583,null,40.6925,42.880833,null,40.6925,36.09775,null,40.6925,34.895556,null,40.6925,40.481181,null,40.6925,21.318681,null,40.6925,29.645419,null,40.6925,38.944533,null,40.6925,29.984433,null,40.6925,39.717331,null,40.6925,43.607333333,null,40.6925,30.494056,null,40.6925,36.080056,null,40.6925,33.942536,null,40.6925,40.777245,null,40.6925,39.297606,null,40.6925,28.429394,null,40.6925,41.785972,null,40.6925,35.042417,null,40.6925,42.932556,null,40.6925,25.79325,null,40.6925,42.947222,null,40.6925,43.139858,null,40.6925,44.881956,null,40.6925,29.993389,null,40.6925,38.509794,null,40.6925,33.67975,null,40.6925,35.393089,null,40.6925,41.303167,null,40.6925,41.978603,null,40.6925,36.894611,null,40.6925,26.683161,null,40.6925,45.588722,null,40.6925,39.871944,null,40.6925,33.434278,null,40.6925,40.491467,null,40.6925,41.732581,null,40.6925,43.646161,null,40.6925,35.877639,null,40.6925,37.505167,null,40.6925,43.118866,null,40.6925,26.536167,null,40.6925,32.733556,null,40.6925,29.533694,null,40.6925,32.127583,null,40.6925,41.708661,null,40.6925,38.1740858,null,40.6925,47.449,null,40.6925,37.618972,null,40.6925,40.788389,null,40.6925,33.675667,null,40.6925,38.748697,null,40.6925,43.111187,null,40.6925,27.975472,null,40.6925,36.198389,null,40.6925,44.741445,null,40.6925,35.810972,null,40.6925,36.2818694],"text":"","key":null,"type":"scattergl","mode":"lines","name":"EWR","line":{"width":1.51181102362205,"color":"rgba(52,152,219,0.25)","dash":"solid"},"hoveron":"points","legendgroup":"EWR","showlegend":true,"xaxis":"x","yaxis":"y","hoverinfo":"text"},{"x":[-73.778925,-106.6091944,null,-73.778925,-70.060181,null,-73.778925,-84.428067,null,-73.778925,-97.669889,null,-73.778925,-86.75355,null,-73.778925,-86.678194,null,-73.778925,-71.005181,null,-73.778925,-73.153278,null,-73.778925,-78.732167,null,-73.778925,-118.358667,null,-73.778925,-76.668333,null,-73.778925,-80.040528,null,-73.778925,-81.849794,null,-73.778925,-80.943139,null,-73.778925,-82.891889,null,-73.778925,-84.667822,null,-73.778925,-77.037722,null,-73.778925,-104.673178,null,-73.778925,-97.037997,null,-73.778925,-83.353389,null,-73.778925,-106.917694,null,-73.778925,-80.15275,null,-73.778925,-157.922428,null,-73.778925,-95.278889,null,-73.778925,-77.455811,null,-73.778925,-95.341442,null,-73.778925,-86.294383,null,-73.778925,-110.73775,null,-73.778925,-81.687861,null,-73.778925,-115.15225,null,-73.778925,-118.408075,null,-73.778925,-118.151611,null,-73.778925,-94.713905,null,-73.778925,-81.308994,null,-73.778925,-89.976667,null,-73.778925,-80.290556,null,-73.778925,-87.896583,null,-73.778925,-93.221767,null,-73.778925,-90.258028,null,-73.778925,-70.615278,null,-73.778925,-122.220722,null,-73.778925,-87.904842,null,-73.778925,-76.201222,null,-73.778925,-80.095589,null,-73.778925,-122.5975,null,-73.778925,-75.241139,null,-73.778925,-112.011583,null,-73.778925,-80.232872,null,-73.778925,-116.506694,null,-73.778925,-70.309281,null,-73.778925,-78.787472,null,-73.778925,-77.319667,null,-73.778925,-77.672389,null,-73.778925,-81.755167,null,-73.778925,-117.189667,null,-73.778925,-98.469778,null,-73.778925,-85.7364989,null,-73.778925,-122.309306,null,-73.778925,-122.374889,null,-73.778925,-121.929022,null,-73.778925,-111.977772,null,-73.778925,-121.590778,null,-73.778925,-82.554389,null,-73.778925,-90.370028,null,-73.778925,-76.106311,null,-73.778925,-82.53325],"y":[40.639751,35.0402222,null,40.639751,41.253053,null,40.639751,33.636719,null,40.639751,30.194528,null,40.639751,33.562942,null,40.639751,36.124472,null,40.639751,42.364347,null,40.639751,44.471861,null,40.639751,42.940525,null,40.639751,34.200667,null,40.639751,39.175361,null,40.639751,32.898647,null,40.639751,41.411689,null,40.639751,35.214,null,40.639751,39.997972,null,40.639751,39.048836,null,40.639751,38.852083,null,40.639751,39.861656,null,40.639751,32.896828,null,40.639751,42.212444,null,40.639751,39.642556,null,40.639751,26.072583,null,40.639751,21.318681,null,40.639751,29.645419,null,40.639751,38.944533,null,40.639751,29.984433,null,40.639751,39.717331,null,40.639751,43.607333333,null,40.639751,30.494056,null,40.639751,36.080056,null,40.639751,33.942536,null,40.639751,33.817722,null,40.639751,39.297606,null,40.639751,28.429394,null,40.639751,35.042417,null,40.639751,25.79325,null,40.639751,42.947222,null,40.639751,44.881956,null,40.639751,29.993389,null,40.639751,41.391667,null,40.639751,37.721278,null,40.639751,41.978603,null,40.639751,36.894611,null,40.639751,26.683161,null,40.639751,45.588722,null,40.639751,39.871944,null,40.639751,33.434278,null,40.639751,40.491467,null,40.639751,33.829667,null,40.639751,43.646161,null,40.639751,35.877639,null,40.639751,37.505167,null,40.639751,43.118866,null,40.639751,26.536167,null,40.639751,32.733556,null,40.639751,29.533694,null,40.639751,38.1740858,null,40.639751,47.449,null,40.639751,37.618972,null,40.639751,37.3626,null,40.639751,40.788389,null,40.639751,38.695417,null,40.639751,27.395444,null,40.639751,38.748697,null,40.639751,43.111187,null,40.639751,27.975472],"text":"","key":null,"type":"scattergl","mode":"lines","name":"JFK","line":{"width":1.51181102362205,"color":"rgba(231,76,60,0.25)","dash":"solid"},"hoveron":"points","legendgroup":"JFK","showlegend":true,"xaxis":"x","yaxis":"y","hoverinfo":"text"},{"x":[-73.872608,-84.428067,null,-73.872608,-82.541806,null,-73.872608,-68.828139,null,-73.872608,-86.75355,null,-73.872608,-86.678194,null,-73.872608,-71.005181,null,-73.872608,-73.153278,null,-73.872608,-78.732167,null,-73.872608,-76.668333,null,-73.872608,-81.119528,null,-73.872608,-81.4421944,null,-73.872608,-78.452861,null,-73.872608,-80.040528,null,-73.872608,-81.849794,null,-73.872608,-80.943139,null,-73.872608,-82.891889,null,-73.872608,-81.593189,null,-73.872608,-84.667822,null,-73.872608,-84.219375,null,-73.872608,-77.037722,null,-73.872608,-104.673178,null,-73.872608,-97.037997,null,-73.872608,-93.663083,null,-73.872608,-83.353389,null,-73.872608,-81.759556,null,-73.872608,-80.15275,null,-73.872608,-85.522806,null,-73.872608,-79.937306,null,-73.872608,-82.218889,null,-73.872608,-95.278889,null,-73.872608,-77.455811,null,-73.872608,-95.341442,null,-73.872608,-77.902569,null,-73.872608,-86.294383,null,-73.872608,-81.687861,null,-73.872608,-84.605889,null,-73.872608,-94.713905,null,-73.872608,-81.308994,null,-73.872608,-87.752417,null,-73.872608,-89.976667,null,-73.872608,-71.435667,null,-73.872608,-80.290556,null,-73.872608,-87.896583,null,-73.872608,-89.337514,null,-73.872608,-93.221767,null,-73.872608,-90.258028,null,-73.872608,-78.928333,null,-73.872608,-95.894069,null,-73.872608,-87.904842,null,-73.872608,-76.201222,null,-73.872608,-80.095589,null,-73.872608,-75.241139,null,-73.872608,-80.232872,null,-73.872608,-70.309281,null,-73.872608,-78.787472,null,-73.872608,-77.319667,null,-73.872608,-77.672389,null,-73.872608,-81.755167,null,-73.872608,-81.202139,null,-73.872608,-86.31725,null,-73.872608,-85.7364989,null,-73.872608,-82.554389,null,-73.872608,-90.370028,null,-73.872608,-76.106311,null,-73.872608,-82.53325,null,-73.872608,-85.582235,null,-73.872608,-83.994028,null,-73.872608,-94.3068111],"y":[40.777245,33.636719,null,40.777245,35.436194,null,40.777245,44.807444,null,40.777245,33.562942,null,40.777245,36.124472,null,40.777245,42.364347,null,40.777245,44.471861,null,40.777245,42.940525,null,40.777245,39.175361,null,40.777245,33.938833,null,40.777245,40.9160833,null,40.777245,38.138639,null,40.777245,32.898647,null,40.777245,41.411689,null,40.777245,35.214,null,40.777245,39.997972,null,40.777245,38.373147,null,40.777245,39.048836,null,40.777245,39.902375,null,40.777245,38.852083,null,40.777245,39.861656,null,40.777245,32.896828,null,40.777245,41.533972,null,40.777245,42.212444,null,40.777245,24.556111,null,40.777245,26.072583,null,40.777245,42.880833,null,40.777245,36.09775,null,40.777245,34.895556,null,40.777245,29.645419,null,40.777245,38.944533,null,40.777245,29.984433,null,40.777245,34.270615,null,40.777245,39.717331,null,40.777245,30.494056,null,40.777245,38.0365,null,40.777245,39.297606,null,40.777245,28.429394,null,40.777245,41.785972,null,40.777245,35.042417,null,40.777245,42.932556,null,40.777245,25.79325,null,40.777245,42.947222,null,40.777245,43.139858,null,40.777245,44.881956,null,40.777245,29.993389,null,40.777245,33.67975,null,40.777245,41.303167,null,40.777245,41.978603,null,40.777245,36.894611,null,40.777245,26.683161,null,40.777245,39.871944,null,40.777245,40.491467,null,40.777245,43.646161,null,40.777245,35.877639,null,40.777245,37.505167,null,40.777245,43.118866,null,40.777245,26.536167,null,40.777245,32.127583,null,40.777245,41.708661,null,40.777245,38.1740858,null,40.777245,27.395444,null,40.777245,38.748697,null,40.777245,43.111187,null,40.777245,27.975472,null,40.777245,44.741445,null,40.777245,35.810972,null,40.777245,36.2818694],"text":"","key":null,"type":"scattergl","mode":"lines","name":"LGA","line":{"width":1.51181102362205,"color":"rgba(46,204,113,0.25)","dash":"solid"},"hoveron":"points","legendgroup":"LGA","showlegend":true,"xaxis":"x","yaxis":"y","hoverinfo":"text"},{"x":[-74.168667],"y":[40.6925],"text":"EWR<br>Newark Liberty Intl<br>120,835 Flights","key":null,"type":"scattergl","mode":"markers","marker":{"autocolorscale":false,"color":"rgba(52,152,219,1)","opacity":1,"size":22.6771653543307,"symbol":"circle","line":{"width":1.88976377952756,"color":"rgba(52,152,219,1)"}},"hoveron":"points","name":"EWR","legendgroup":"EWR","showlegend":false,"xaxis":"x","yaxis":"y","hoverinfo":"text"},{"x":[-73.778925],"y":[40.639751],"text":"JFK<br>John F Kennedy Intl<br>111,279 Flights","key":null,"type":"scattergl","mode":"markers","marker":{"autocolorscale":false,"color":"rgba(231,76,60,1)","opacity":1,"size":20.8059185906475,"symbol":"circle","line":{"width":1.88976377952756,"color":"rgba(231,76,60,1)"}},"hoveron":"points","name":"JFK","legendgroup":"JFK","showlegend":false,"xaxis":"x","yaxis":"y","hoverinfo":"text"},{"x":[-73.872608],"y":[40.777245],"text":"LGA<br>La Guardia<br>104,663 Flights","key":null,"type":"scattergl","mode":"markers","marker":{"autocolorscale":false,"color":"rgba(46,204,113,1)","opacity":1,"size":20.6820886488173,"symbol":"circle","line":{"width":1.88976377952756,"color":"rgba(46,204,113,1)"}},"hoveron":"points","name":"LGA","legendgroup":"LGA","showlegend":false,"xaxis":"x","yaxis":"y","hoverinfo":"text"},{"x":[-73.801692,-149.996361,-84.428067,-97.669889,-82.541806,-72.683222,-86.678194,-71.005181,null,-73.153278,-78.732167,-76.668333,-111.160151,-81.119528,-80.040528,-81.849794,-80.943139,-82.891889,-84.667822,-84.219375,-77.037722,-104.673178,-97.037997,-93.663083,-83.353389,-106.917694,-80.15275,-85.522806,-79.937306,-82.218889,-107.21766,-157.922428,-95.278889,-77.455811,-95.341442,-86.294383,-110.73775,-81.687861,-115.15225,-118.408075,-94.713905,-81.308994,-87.752417,-89.976667,-71.435667,-80.290556,-87.896583,-89.337514,-93.221767,-90.258028,-107.894242,-78.928333,-97.600733,-95.894069,-87.904842,-76.201222,-80.095589,-122.5975,-75.241139,-112.011583,-80.232872,-71.420383,-70.309281,-78.787472,-77.319667,-77.672389,-81.755167,-117.189667,-98.469778,-81.202139,-86.31725,-85.7364989,-122.309306,-122.374889,null,-111.977772,-117.868222,-90.370028,null,-76.106311,-82.53325,-95.888111,-85.582235,-83.994028,-94.3068111,-106.6091944,-70.060181,-86.75355,-118.358667,-118.151611,-70.615278,-122.220722,null,-116.506694,-121.929022,-121.590778,-82.554389,-68.828139,-81.4421944,-78.452861,-81.593189,-81.759556,-77.902569,-84.605889],"y":[42.748267,61.174361,33.636719,30.194528,35.436194,41.938889,36.124472,42.364347,null,44.471861,42.940525,39.175361,45.777643,33.938833,32.898647,41.411689,35.214,39.997972,39.048836,39.902375,38.852083,39.861656,32.896828,41.533972,42.212444,39.642556,26.072583,42.880833,36.09775,34.895556,40.481181,21.318681,29.645419,38.944533,29.984433,39.717331,43.607333333,30.494056,36.080056,33.942536,39.297606,28.429394,41.785972,35.042417,42.932556,25.79325,42.947222,43.139858,44.881956,29.993389,38.509794,33.67975,35.393089,41.303167,41.978603,36.894611,26.683161,45.588722,39.871944,33.434278,40.491467,41.732581,43.646161,35.877639,37.505167,43.118866,26.536167,32.733556,29.533694,32.127583,41.708661,38.1740858,47.449,37.618972,null,40.788389,33.675667,38.748697,null,43.111187,27.975472,36.198389,44.741445,35.810972,36.2818694,35.0402222,41.253053,33.562942,34.200667,33.817722,41.391667,37.721278,null,33.829667,37.3626,38.695417,27.395444,44.807444,40.9160833,38.138639,38.373147,24.556111,34.270615,38.0365],"text":["ALB<br>Albany Intl<br>439 Flights","ANC<br>Ted Stevens Anchorage Intl<br>8 Flights","ATL<br>Hartsfield Jackson Atlanta Intl<br>17,215 Flights","AUS<br>Austin Bergstrom Intl<br>2,439 Flights","AVL<br>Asheville Regional Airport<br>275 Flights","BDL<br>Bradley Intl<br>443 Flights","BNA<br>Nashville Intl<br>6,333 Flights","BOS<br>General Edward Lawrence Logan Intl<br>15,508 Flights","BQN<br>NA<br>896 Flights","BTV<br>Burlington Intl<br>2,589 Flights","BUF<br>Buffalo Niagara Intl<br>4,681 Flights","BWI<br>Baltimore Washington Intl<br>1,781 Flights","BZN<br>Gallatin Field<br>36 Flights","CAE<br>Columbia Metropolitan<br>116 Flights","CHS<br>Charleston Afb Intl<br>2,884 Flights","CLE<br>Cleveland Hopkins Intl<br>4,573 Flights","CLT<br>Charlotte Douglas Intl<br>14,064 Flights","CMH<br>Port Columbus Intl<br>3,524 Flights","CVG<br>Cincinnati Northern Kentucky Intl<br>3,941 Flights","DAY<br>James M Cox Dayton Intl<br>1,525 Flights","DCA<br>Ronald Reagan Washington Natl<br>9,705 Flights","DEN<br>Denver Intl<br>7,266 Flights","DFW<br>Dallas Fort Worth Intl<br>8,738 Flights","DSM<br>Des Moines Intl<br>569 Flights","DTW<br>Detroit Metro Wayne Co<br>9,384 Flights","EGE<br>Eagle Co Rgnl<br>213 Flights","FLL<br>Fort Lauderdale Hollywood Intl<br>12,055 Flights","GRR<br>Gerald R Ford Intl<br>765 Flights","GSO<br>Piedmont Triad<br>1,606 Flights","GSP<br>Greenville-Spartanburg International<br>849 Flights","HDN<br>Yampa Valley<br>15 Flights","HNL<br>Honolulu Intl<br>707 Flights","HOU<br>William P Hobby<br>2,115 Flights","IAD<br>Washington Dulles Intl<br>5,700 Flights","IAH<br>George Bush Intercontinental<br>7,198 Flights","IND<br>Indianapolis Intl<br>2,077 Flights","JAC<br>Jackson Hole Airport<br>25 Flights","JAX<br>Jacksonville Intl<br>2,720 Flights","LAS<br>Mc Carran Intl<br>5,997 Flights","LAX<br>Los Angeles Intl<br>16,174 Flights","MCI<br>Kansas City Intl<br>2,008 Flights","MCO<br>Orlando Intl<br>14,082 Flights","MDW<br>Chicago Midway Intl<br>4,113 Flights","MEM<br>Memphis Intl<br>1,789 Flights","MHT<br>Manchester Regional Airport<br>1,009 Flights","MIA<br>Miami Intl<br>11,728 Flights","MKE<br>General Mitchell Intl<br>2,802 Flights","MSN<br>Dane Co Rgnl Truax Fld<br>572 Flights","MSP<br>Minneapolis St Paul Intl<br>7,185 Flights","MSY<br>Louis Armstrong New Orleans Intl<br>3,799 Flights","MTJ<br>Montrose Regional Airport<br>15 Flights","MYR<br>Myrtle Beach Intl<br>59 Flights","OKC<br>Will Rogers World<br>346 Flights","OMA<br>Eppley Afld<br>849 Flights","ORD<br>Chicago Ohare Intl<br>17,283 Flights","ORF<br>Norfolk Intl<br>1,536 Flights","PBI<br>Palm Beach Intl<br>6,554 Flights","PDX<br>Portland Intl<br>1,354 Flights","PHL<br>Philadelphia Intl<br>1,632 Flights","PHX<br>Phoenix Sky Harbor Intl<br>4,656 Flights","PIT<br>Pittsburgh Intl<br>2,875 Flights","PVD<br>Theodore Francis Green State<br>376 Flights","PWM<br>Portland Intl Jetport<br>2,352 Flights","RDU<br>Raleigh Durham Intl<br>8,163 Flights","RIC<br>Richmond Intl<br>2,454 Flights","ROC<br>Greater Rochester Intl<br>2,416 Flights","RSW<br>Southwest Florida Intl<br>3,537 Flights","SAN<br>San Diego Intl<br>2,737 Flights","SAT<br>San Antonio Intl<br>686 Flights","SAV<br>Savannah Hilton Head Intl<br>804 Flights","SBN<br>South Bend Rgnl<br>10 Flights","SDF<br>Louisville International Airport<br>1,157 Flights","SEA<br>Seattle Tacoma Intl<br>3,923 Flights","SFO<br>San Francisco Intl<br>13,331 Flights","SJU<br>NA<br>5,819 Flights","SLC<br>Salt Lake City Intl<br>2,467 Flights","SNA<br>John Wayne Arpt Orange Co<br>825 Flights","STL<br>Lambert St Louis Intl<br>4,339 Flights","STT<br>NA<br>522 Flights","SYR<br>Syracuse Hancock Intl<br>1,761 Flights","TPA<br>Tampa Intl<br>7,466 Flights","TUL<br>Tulsa Intl<br>315 Flights","TVC<br>Cherry Capital Airport<br>101 Flights","TYS<br>Mc Ghee Tyson<br>631 Flights","XNA<br>NW Arkansas Regional<br>1,036 Flights","ABQ<br>Albuquerque International Sunport<br>254 Flights","ACK<br>Nantucket Mem<br>265 Flights","BHM<br>Birmingham Intl<br>297 Flights","BUR<br>Bob Hope<br>371 Flights","LGB<br>Long Beach<br>668 Flights","MVY<br>Martha\\\\'s Vineyard<br>221 Flights","OAK<br>Metropolitan Oakland Intl<br>312 Flights","PSE<br>NA<br>365 Flights","PSP<br>Palm Springs Intl<br>19 Flights","SJC<br>Norman Y Mineta San Jose Intl<br>329 Flights","SMF<br>Sacramento Intl<br>284 Flights","SRQ<br>Sarasota Bradenton Intl<br>1,211 Flights","BGR<br>Bangor Intl<br>375 Flights","CAK<br>Akron Canton Regional Airport<br>864 Flights","CHO<br>Charlottesville-Albemarle<br>52 Flights","CRW<br>Yeager<br>138 Flights","EYW<br>Key West Intl<br>17 Flights","ILM<br>Wilmington Intl<br>110 Flights","LEX<br>Blue Grass<br>1 Flights"],"key":null,"type":"scattergl","mode":"markers","marker":{"autocolorscale":false,"color":"rgba(26,26,26,1)","opacity":1,"size":[3.77952755905512,3.77952755905512,6.67829287123416,5.82926416836526,5.82926416836526,3.77952755905512,6.67829287123416,6.67829287123416,5.82926416836526,6.67829287123416,6.67829287123416,6.67829287123416,3.77952755905512,5.82926416836526,6.67829287123416,6.67829287123416,6.67829287123416,6.67829287123416,6.67829287123416,5.82926416836526,6.67829287123416,6.67829287123416,6.67829287123416,5.82926416836526,6.67829287123416,5.82926416836526,6.67829287123416,5.82926416836526,5.82926416836526,5.82926416836526,3.77952755905512,5.82926416836526,6.67829287123416,6.67829287123416,6.67829287123416,6.67829287123416,5.82926416836526,6.67829287123416,5.82926416836526,5.82926416836526,6.67829287123416,6.67829287123416,5.82926416836526,6.67829287123416,5.82926416836526,6.67829287123416,6.67829287123416,5.82926416836526,6.67829287123416,6.67829287123416,3.77952755905512,5.82926416836526,3.77952755905512,5.82926416836526,6.67829287123416,6.67829287123416,6.67829287123416,5.82926416836526,6.67829287123416,5.82926416836526,6.67829287123416,3.77952755905512,6.67829287123416,6.67829287123416,6.67829287123416,6.67829287123416,6.67829287123416,5.82926416836526,5.82926416836526,5.82926416836526,5.82926416836526,6.67829287123416,5.82926416836526,5.82926416836526,5.82926416836526,5.82926416836526,3.77952755905512,6.67829287123416,5.82926416836526,6.67829287123416,6.67829287123416,3.77952755905512,5.82926416836526,5.82926416836526,5.82926416836526,3.77952755905512,3.77952755905512,5.82926416836526,3.77952755905512,3.77952755905512,3.77952755905512,3.77952755905512,3.77952755905512,3.77952755905512,3.77952755905512,3.77952755905512,5.82926416836526,3.77952755905512,3.77952755905512,3.77952755905512,3.77952755905512,3.77952755905512,3.77952755905512,3.77952755905512],"symbol":"circle","line":{"width":1.88976377952756,"color":"rgba(26,26,26,1)"}},"hoveron":"points","name":"Others","legendgroup":"Others","showlegend":true,"xaxis":"x","yaxis":"y","hoverinfo":"text"}],"layout":{"margin":{"t":48.079701120797,"r":7.97011207970112,"b":16.9364881693649,"l":11.9551681195517},"plot_bgcolor":"rgba(255,255,255,1)","paper_bgcolor":"rgba(255,255,255,1)","font":{"color":"rgba(0,0,0,1)","family":"","size":15.9402241594022},"title":"Locations of U.S. Flights Outbound from NYC in 2013","titlefont":{"color":"rgba(0,0,0,1)","family":"Source Sans Pro","size":19.1282689912827},"xaxis":{"domain":[0,1],"type":"linear","autorange":false,"tickmode":"array","range":[-162.37714245,-64.37342455],"ticktext":["-160","-140","-120","-100","-80"],"tickvals":[-160,-140,-120,-100,-80],"ticks":"","tickcolor":null,"ticklen":3.98505603985056,"tickwidth":0,"showticklabels":false,"tickfont":{"color":null,"family":null,"size":0},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"showgrid":false,"gridcolor":null,"gridwidth":0,"zeroline":false,"anchor":"y","title":"","titlefont":{"color":null,"family":null,"size":0},"hoverformat":".2f"},"yaxis":{"domain":[0,1],"type":"linear","autorange":false,"tickmode":"array","range":[19.325897,63.167145],"ticktext":["20","30","40","50","60"],"tickvals":[20,30,40,50,60],"ticks":"","tickcolor":null,"ticklen":3.98505603985056,"tickwidth":0,"showticklabels":false,"tickfont":{"color":null,"family":null,"size":0},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"showgrid":false,"gridcolor":null,"gridwidth":0,"zeroline":false,"anchor":"x","title":"","titlefont":{"color":null,"family":null,"size":0},"hoverformat":".2f"},"shapes":[{"type":"rect","fillcolor":null,"line":{"color":null,"width":0,"linetype":[]},"yref":"paper","xref":"paper","x0":0,"x1":1,"y0":0,"y1":1}],"showlegend":true,"legend":{"bgcolor":"rgba(255,255,255,1)","bordercolor":"transparent","borderwidth":1.88976377952756,"font":{"color":"rgba(0,0,0,1)","family":"Source Sans Pro","size":12.7521793275218},"y":0.91496062992126},"annotations":[{"text":"Airports","x":1.02,"y":1,"showarrow":false,"ax":0,"ay":0,"font":{"color":"rgba(0,0,0,1)","family":"Source Sans Pro","size":15.9402241594022},"xref":"paper","yref":"paper","textangle":-0,"xanchor":"left","yanchor":"bottom","legendTitle":true}],"hovermode":"closest","height":400},"source":"A","config":{"modeBarButtonsToAdd":[{"name":"Collaborate","icon":{"width":1000,"ascent":500,"descent":-50,"path":"M487 375c7-10 9-23 5-36l-79-259c-3-12-11-23-22-31-11-8-22-12-35-12l-263 0c-15 0-29 5-43 15-13 10-23 23-28 37-5 13-5 25-1 37 0 0 0 3 1 7 1 5 1 8 1 11 0 2 0 4-1 6 0 3-1 5-1 6 1 2 2 4 3 6 1 2 2 4 4 6 2 3 4 5 5 7 5 7 9 16 13 26 4 10 7 19 9 26 0 2 0 5 0 9-1 4-1 6 0 8 0 2 2 5 4 8 3 3 5 5 5 7 4 6 8 15 12 26 4 11 7 19 7 26 1 1 0 4 0 9-1 4-1 7 0 8 1 2 3 5 6 8 4 4 6 6 6 7 4 5 8 13 13 24 4 11 7 20 7 28 1 1 0 4 0 7-1 3-1 6-1 7 0 2 1 4 3 6 1 1 3 4 5 6 2 3 3 5 5 6 1 2 3 5 4 9 2 3 3 7 5 10 1 3 2 6 4 10 2 4 4 7 6 9 2 3 4 5 7 7 3 2 7 3 11 3 3 0 8 0 13-1l0-1c7 2 12 2 14 2l218 0c14 0 25-5 32-16 8-10 10-23 6-37l-79-259c-7-22-13-37-20-43-7-7-19-10-37-10l-248 0c-5 0-9-2-11-5-2-3-2-7 0-12 4-13 18-20 41-20l264 0c5 0 10 2 16 5 5 3 8 6 10 11l85 282c2 5 2 10 2 17 7-3 13-7 17-13z m-304 0c-1-3-1-5 0-7 1-1 3-2 6-2l174 0c2 0 4 1 7 2 2 2 4 4 5 7l6 18c0 3 0 5-1 7-1 1-3 2-6 2l-173 0c-3 0-5-1-8-2-2-2-4-4-4-7z m-24-73c-1-3-1-5 0-7 2-2 3-2 6-2l174 0c2 0 5 0 7 2 3 2 4 4 5 7l6 18c1 2 0 5-1 6-1 2-3 3-5 3l-174 0c-3 0-5-1-7-3-3-1-4-4-5-6z"},"click":"function(gd) { \n        // is this being viewed in RStudio?\n        if (location.search == '?viewer_pane=1') {\n          alert('To learn about plotly for collaboration, visit:\\n https://cpsievert.github.io/plotly_book/plot-ly-for-collaboration.html');\n        } else {\n          window.open('https://cpsievert.github.io/plotly_book/plot-ly-for-collaboration.html', '_blank');\n        }\n      }"}],"modeBarButtonsToRemove":["sendDataToCloud"]},".plotlyWebGl":true,"base_url":"https://plot.ly"},"evals":["config.modeBarButtonsToAdd.0.click"],"jsHooks":[]}</script>

<script type="application/htmlwidget-sizing" data-for="htmlwidget-ae87c24ac18b3ac8a6fa">{"viewer":{"width":"100%","height":400,"padding":0,"fill":false},"browser":{"width":"100%","height":400,"padding":0,"fill":false}}</script>

<p>This is an instance where Plotly&rsquo;s native zooming and filtering are very helpful! For example, if you filter solely on flights from LGA/LaGuardia, you will see that the airport never shuttles flights to the western United States.</p>

<p>However, there are no obvious trends outside of that observation. The 1-degree airports and the 2-degree airports are scattered around the country with no apparent pattern. Oh well.</p>

<p>I should mention that since there is a relatively low amount of data, these examples do not benefit as much from rendering with WebGL than with Plotly&rsquo;s native d3/SVG. And even then, there are still further optimizations that can be done; after finishing the code write up, I discovered <a href="https://github.com/thomasp85/ggraph">ggraph</a>, which is more actively developed than ggnetwork, although ggraph does not interact as well with Plotly.</p>

<p>This creation workflow is pragmatic enough that I can included these interactive network graphs in more blog posts. At the least, this approach is a good proof-of-concept for some <em>very crazy</em> data visualizations I have planned.</p>

<hr>

<p><em>You can view all the R and ggplot2 code used to visualize the data in <a href="http://minimaxir.com/notebooks/interactive-network/">this R Notebook</a>. You can also view the images/data used for this post in <a href="https://github.com/minimaxir/interactive-network">this GitHub repository</a></em>.</p>

<p><em>You are free to use the data visualizations from this article however you wish, but it would be greatly appreciated if proper attribution is given to this article and/or myself!</em></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[What Percent of the Top-Voted Comments in Reddit Threads Were Also 1st Comment?]]></title>
    <link href="http://minimaxir.com/2016/11/first-comment/"/>
    <updated>2016-11-07T06:30:00-08:00</updated>
    <id>http://minimaxir.com/2016/11/first-comment</id>
    <content type="html"><![CDATA[<p><a href="https://www.reddit.com">Reddit</a> threads can be a crowded place. In popular subreddits such as <a href="https://www.reddit.com/r/AskReddit/">/r/AskReddit</a> and <a href="https://www.reddit.com/r/pics/">/r/pics</a>, Reddit submissions can receive hundreds, even <em>thousands</em> of unique comments. Some comments inevitably become lost in the noise. Reddit&rsquo;s <a href="https://redditblog.com/2009/10/15/reddits-new-comment-sorting-system/">ranking algorithm</a> attempts to rectify this by determining comment ranking using both time and community voting; comments in a thread, by default, are ordered based on the <strong>points score</strong> (upvotes - downvotes) the comment receives, subject to a rank decay based on the age of the comment.</p>

<p><img src="/img/first-comment/reddit_askreddit.png" alt=""></p>

<p>In theory, this system should allow comments that posted later in the thread&rsquo;s lifetime to rank much higher temporarily, then Redditors can vote on the new comment; if the new comment is good, it can now rise to the top and therefore the content which would otherwise be buried is now surfaced. Anecdotally, that doesn&rsquo;t be the case with Reddit&rsquo;s modern algorithm; comments made late in the thread appear at the bottom, where they likely will not receive any upvotes (this led to a minor &ldquo;<a href="https://www.google.com/#q=site:reddit.com+%22late+to+this+thread%22">I know I&rsquo;m late to this thread but&hellip;</a>&rdquo; meme).</p>

<p>I, of course, am not satisfied with anecdotes. A month ago, a Redditor asked &ldquo;<a href="https://www.reddit.com/r/TheoryOfReddit/comments/53d5ep/what_percentage_of_the_top_comment_in_threads/">What percentage of the top comment in threads were also the first comment?</a>&rdquo; Why not calculate it <em>exactly</em> using big data?</p>

<h2>Getting the Reddit Data</h2>

<p><em>You can view all the <a href="https://www.r-project.org">R</a> and <a href="http://ggplot2.org">ggplot2</a> code used to query, analyze, and visualize the Reddit data in <a href="http://minimaxir.com/notebooks/first-comment/">this R Notebook</a>.</em></p>

<p>In order to process a great amount of Reddit data, I turned to <a href="https://cloud.google.com/bigquery/">BigQuery</a>, which now has data for <a href="https://www.reddit.com/r/datasets/comments/590re2/updated_reddit_comments_and_posts_updated_on/">all Reddit comments</a> until September 2016.</p>

<p>For this analysis, I will only look at the <strong>top-level comments</strong> (i.e. comments which are not replies to other comments), since those are the ones most affected by the ordering and submission of new comments. Additionally I will only look at comments within Reddit threads with <strong>atleast 30 top-level comments</strong> to ensure I only look at threads with sufficient discussion and where late posts are more likely to become hidden. It also mirrors the &ldquo;late to this thread&rdquo; meme: can posts be <em>too</em> late?</p>

<p>The queried data will be all comments posted from January 2015 to September 2016: this give a good balance of sample size and foundation around the modern comment ranking algorithms. The total number of Reddit comments analyzed, after filtering on threads with sufficient conversation and limiting the scope to the first 100 comments of a thread scoring within the Top 100, is <strong>n = 86,561,476</strong>.</p>

<p>With clever use of BigQuery window functions, I obtained the aggregate data, counting the number of comments from the filtered Reddit threads at each voting rank and created rank.</p>

<p><img src="/img/first-comment/data.png" alt=""></p>

<h2>Visualizing the Discussion</h2>

<p>Filtering on the top-voted comments (<code>score_rank = 1</code>) only, <em>what percent of the top-voted comments in Reddit threads were also 1st Comment?</em></p>

<p><img src="/img/first-comment/reddit-first-4.png" alt=""></p>

<p>The answer is <strong>17.24%</strong> of all top-voted comments! That&rsquo;s certainly more than what I expected! Additionally, 56% of the top-voted comments were posted within the first 5 comments, and 77% within the first 10 comments. The chart follows a <a href="https://en.wikipedia.org/wiki/Power_law">power-law distribution</a>.</p>

<p>Let&rsquo;s invert it: filtering on only the first comments (<code>created_rank = 1</code>) made in comment threads, <em>what percentage of the 1st Comments in Reddit threads were also the top-voted comment?</em></p>

<p><img src="/img/first-comment/reddit-first-3.png" alt=""></p>

<p>By construction, the answer is the same as before (17.24%), however the followup proportions are slightly different, with the first comment ranking within the Top 5 comments 46% of the time, and within the Top 10 comments 62% of the time.</p>

<p>It may be worth it to visualize both dimensions at the same time using a heatmap, with the created rank on one axis, score rank on the other, and a z-axis representing the number of comments at each rank pairing. We can also add a faint contour line to help visualize clusters of the data. Putting it together:</p>

<p><img src="/img/first-comment/reddit-first-2.png" alt=""></p>

<p>Woah, most of the values are constrained between the semisquare constrained by the first 5 comments and the top 5 comments! But it&rsquo;s harder to see trends, so let&rsquo;s try applying a logarithmic base-10 scaling on the comment count:</p>

<p><img src="/img/first-comment/reddit-first-2a.png" alt=""></p>

<p>Much better! We can see a grouping of the 5x5 semisquare, but also smaller groupings of a 30x30 shape (this may possibly be due to the 30 comment filter threshold), a faint 60x60 shape, and <em>voids</em> in the upper-left and lower-right corners.</p>

<p>From the 2D heatmap, there appears to be a <strong>positive correlation</strong> between the rank of the comment and the time it was submitted. Ideally, if Reddit&rsquo;s algorithm correctly cycled posts so that each comment gets a fair chance at going viral, then there should be <strong>no correlation</strong> between score rank and time posted.</p>

<h2>Analysis by Subreddit</h2>

<p>When working with Reddit data, it is always important to facet the analysis by subreddit, as subreddits can have idiosyncratic behaviors which deviate from general Reddit behavior. As noted in the original Reddit thread with the initial question, it is possible that the percentage of first comments becoming top comment is &ldquo;higher in lighter subs (funny, pics, videos) than more serious subs (askscience, history, etc).&rdquo;</p>

<p>I tweaked the BigQuery above to retrieve the same data for each of the Top 100 subreddits (determined by unique commenter count over the same time period). Afterward, via scripting, I created a 1D proportion-of-first-comments-by-score-rank and 2D heatmaps for each subreddit. You can view and download the 1D charts <a href="https://github.com/minimaxir/first-comment/tree/master/img-1d">here</a>, and the 2D heatmaps <a href="https://github.com/minimaxir/first-comment/tree/master/img-2d">here</a>.</p>

<p>For example, here&rsquo;s the chart of first-comment-rankings for <a href="https://www.reddit.com/r/IAmA/">/r/IAmA</a>, one of Reddit&rsquo;s biggest subreddits where normal Redditors can ask celebrities any question they want.</p>

<p><img src="/img/first-comment/IAmA-1d.png" alt=""></p>

<p>Unlike the all-Reddit chart, the distribution of first-comment proportions is more uniform instead of following a power law. It makes sense in theory; people would likely upvote top-level questions which the original poster replied to, so there should be less of a bias toward the first top-level comment.</p>

<p>What does the 2D heatmap show?</p>

<p><img src="/img/first-comment/IAmA-2d.png" alt=""></p>

<p>Damn it.</p>

<p>While the 1D behavior is different, the overall 2D behavior is the same albeit with larger voids (indeed, in the heatmap, you can see at <code>created_rank = 1</code>, the vertical strip doesn&rsquo;t fit the pattern).</p>

<p>It turns out that most /r/IAmA threads have this comment:</p>

<p><img src="/img/first-comment/automoderator.png" alt=""></p>

<p>As it&rsquo;s made by a robot, it&rsquo;s always the first comment, and it gets ignored/downvoted in normal circumstances. Other subreddits with the same pattern of 1D irregularities, 2D regularities, and AutoModerator usage are <a href="https://www.reddit.com/r/gameofthrones/">/r/gameofthrones</a>, <a href="https://www.reddit.com/r/photoshopbattles/">/r/photoshopbattles</a>, and <a href="https://www.reddit.com/r/WritingPrompts/">/r/WritingPrompts</a>.</p>

<p>Some subreddits have more uniformity than typical Reddit rank behavior. In <a href="https://www.reddit.com/r/funny/">/r/funny</a>, <a href="https://www.reddit.com/r/leagueoflegends/">/r/leagueoflegends</a>, <a href="https://www.reddit.com/r/pics/">/r/pics</a>, <a href="https://www.reddit.com/r/todayilearned/">/r/todayilearned</a>, and <a href="https://www.reddit.com/r/video/">/r/videos</a> (i.e. many default subreddits), there is no upper-left void (early comments can be poorly ranked) and the bottom-right void is minimized but still present.</p>

<p><img src="/img/first-comment/funny-2d.png" alt=""></p>

<p><img src="/img/first-comment/leagueoflegends-2d.png" alt=""></p>

<p>Inversely, there are subreddits where the correlation is obvious. <a href="https://www.reddit.com/r/pcmasterrace/">/r/pcmasterrace</a> and /r/gonewild both exhibit very straight lines, and are subreddits where the comments themselves are not very constructive, so whatever gets posted gets upvoted anyways.</p>

<p><img src="/img/first-comment/pcmasterrace-2d.png" alt=""></p>

<p><img src="/img/first-comment/gonewild-2d.png" alt=""></p>

<p>Rushing to say <strong>FIRST!!1!11!</strong> in a comments section of a blog post or forum thread is a meme that long predates Reddit. However, rushing to make the first comment in a Reddit thread may have strategic merit if you want to get your voice heard.</p>

<p>Even in the most optimistic circumstances, comments that are late to a thread have a very, very low probability of becoming one of the top comments. In fairness, it&rsquo;s hard to determine with public Reddit data if tweaking the ranking algorithm such that new comments will always rank at the top initially will actually improve the Reddit user experience as a whole. On the other hand, this behavior presents an opportunity: if there is a <a href="https://en.wikipedia.org/wiki/Long_tail">long tail</a> of Reddit content that is unjustifiably being buried due to lack of attention, then perhaps there is a <em>business opportunity</em> in creating a service to discover and resurface quality comments&hellip;</p>

<hr>

<p><em>You can view all the <a href="https://www.r-project.org">R</a> and <a href="http://ggplot2.org">ggplot2</a> code used to query, analyze, and visualize the Reddit data in <a href="http://minimaxir.com/notebooks/first-comment/">this R Notebook</a>. You can also view the images/data used for this post in <a href="https://github.com/minimaxir/first-comment">this GitHub repository</a></em>.</p>

<p><em>You are free to use the data visualizations from this article however you wish, but it would be greatly appreciated if proper attribution is given to this article and/or myself!</em></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Visualizing Clusters of Clickbait Headlines Using Spark, Word2vec, and Plotly]]></title>
    <link href="http://minimaxir.com/2016/08/clickbait-cluster/"/>
    <updated>2016-08-16T06:30:00-07:00</updated>
    <id>http://minimaxir.com/2016/08/clickbait-cluster</id>
    <content type="html"><![CDATA[<p>Facebook <a href="http://newsroom.fb.com/news/2016/08/news-feed-fyi-further-reducing-clickbait-in-feed/">recently announced</a> that they will punish Facebook Posts which link to articles using clickbait headlines by limiting their exposure on the News Feed. They also announced that they have a large team manually classifying what is and isn’t linkbait. From <a href="http://minimaxir.com/2015/01/linkbait/">my analysis of BuzzFeed headlines</a> last year, I found that clickbait typically follows very specific tropes with phrases such as &ldquo;The [X] Most&rdquo; or &ldquo;You Should Do.&rdquo; It shouldn&rsquo;t be <em>that</em> difficult to identify clickbait using heuristics/machine learning.</p>

<p>Relatedly, I recently read <a href="http://blog.yhat.com/posts/words2map.html">a blog post</a> by Lance Legel describing <a href="https://github.com/overlap-ai/words2map">words2map</a>, a project which takes in keywords and converts Google News articles representing those keywords into numerical vector representations, clusters them together in 2D, and plots those on a chart.</p>

<p><img src="/img/clickbait-cluster/words2map-1.png" alt=""></p>

<p>Why not combine the two ideas? Let&rsquo;s deconstruct thousands of news headlines into numeric representations and cluster them together to see if we can isolate submissions which intrinsincly  hit those clickbait tropes.</p>

<h2>5 Big Data Processing Techniques You Should Know</h2>

<p>Using a modified version of my <a href="https://github.com/minimaxir/facebook-page-post-scraper">Facebook Page Post Scraper</a>, I downloaded <em>all</em> Facebook Posts by the Facebook Pages representing news publications <a href="https://www.facebook.com/cnn">CNN</a>, <a href="https://www.facebook.com/nytimes">NYTimes</a>, <a href="https://www.facebook.com/BuzzFeed/">BuzzFeed</a>, and <a href="https://www.facebook.com/Upworthy/">Upworthy</a>, and stored the headlines of each linked article if present. <a href="http://www.cnn.com/">CNN</a> and <a href="http://www.nytimes.com/">NYTimes</a> represent traditional media whose headlines tend to follow <a href="https://owl.english.purdue.edu/owl/resource/735/02/">AP Style guidelines</a>, while <a href="https://www.buzzfeed.com/">BuzzFeed</a> and <a href="https://www.upworthy.com/">Upworthy</a> are more known for their clickbait headlines. </p>

<p>However, those are not absolute rules; BuzzFeed occasionally has more-serious headlines, and CNN occasionally has more-gimmicky headlines. <strong>That&rsquo;s okay.</strong> If my hypothesis is correct, the nonappropriate headlines will be clustered with other headlines of the same style.</p>

<p>First, I load the four datasets into the hip new big data tool <a href="https://spark.apache.org">Apache Spark</a> 2.0, (via the Python interface, <a href="http://spark.apache.org/docs/latest/api/python/">PySpark</a>), and combine them all into a single DataFrame, with a little extra post-processing to remove invalid entries.</p>
<div class="highlight"><pre><code class="language-Python" data-lang="Python"><span class="n">df_cnn</span> <span class="o">=</span> <span class="n">read_tsv</span><span class="p">(</span><span class="s">&quot;fb_headlines/CNN_fb.tsv&quot;</span><span class="p">)</span>
<span class="n">df_nytimes</span> <span class="o">=</span> <span class="n">read_tsv</span><span class="p">(</span><span class="s">&quot;fb_headlines/NYTimes_fb.tsv&quot;</span><span class="p">)</span>
<span class="n">df_buzzfeed</span> <span class="o">=</span> <span class="n">read_tsv</span><span class="p">(</span><span class="s">&quot;fb_headlines/BuzzFeed_fb.tsv&quot;</span><span class="p">)</span>
<span class="n">df_upworthy</span> <span class="o">=</span> <span class="n">read_tsv</span><span class="p">(</span><span class="s">&quot;fb_headlines/Upworthy_fb.tsv&quot;</span><span class="p">)</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">df_cnn</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="n">df_nytimes</span><span class="p">)</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="n">df_buzzfeed</span><span class="p">)</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="n">df_upworthy</span><span class="p">)</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">process_df</span><span class="p">(</span><span class="n">df</span><span class="p">)</span><span class="o">.</span><span class="n">cache</span><span class="p">()</span>
</code></pre></div>
<p><img src="/img/clickbait-cluster/cc-1.png" alt=""></p>

<p>In all, I had 102,267 valid news headlines to analyze; not &ldquo;big data,&rdquo; but enough data that it&rsquo;s worth optimizing the analysis code as much as possible, especially in this case where the computation can be intensive.</p>

<p>Once the data is loaded, we convert the headlines to an array of tokens representing each word from the headline, all lowercase and with punctuation stripped. This task can normally be difficult and have poor performance on large datasets, however Spark has a RegexTokenizer that quickly executes all the necessary tasks in one fell swoop.</p>
<div class="highlight"><pre><code class="language-Python" data-lang="Python"><span class="n">tokenizer</span> <span class="o">=</span> <span class="n">RegexTokenizer</span><span class="p">(</span><span class="n">pattern</span><span class="o">=</span><span class="s">&quot;[^\w]&quot;</span><span class="p">,</span> <span class="n">inputCol</span><span class="o">=</span><span class="s">&quot;text&quot;</span><span class="p">,</span> <span class="n">outputCol</span><span class="o">=</span><span class="s">&quot;words&quot;</span><span class="p">)</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">tokenizer</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
</code></pre></div>
<p><img src="/img/clickbait-cluster/cc-2.png" alt=""></p>

<p>Most analyses would remove <a href="https://en.wikipedia.org/wiki/Stop_words">stop words</a> as their high frequency can cause noise in the subsequent analysis. In this case, we should <em>not</em> remove them as many stop words  are critical components of the clickbait tropes (e.g. &ldquo;I Am&rdquo; and &ldquo;The [X] Most&rdquo;).</p>

<p>Now that the tokens are created, we can apply <a href="https://en.wikipedia.org/wiki/Word2vec">Word2vec</a>, an algorithm which converts a collection of words into a dictionary of multidimensional numerical representations. Once the dictionary is created, we can average all the word vectors for a given headline to get the numeric representation of the headline itself. Again, Spark has convenient functions for those actions, setting a randomness seed for reproducibility:</p>
<div class="highlight"><pre><code class="language-Python" data-lang="Python"><span class="n">word2Vec</span> <span class="o">=</span> <span class="n">Word2Vec</span><span class="p">(</span><span class="n">vectorSize</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="mi">42</span><span class="p">,</span> <span class="n">inputCol</span><span class="o">=</span><span class="s">&quot;words&quot;</span><span class="p">,</span> <span class="n">outputCol</span><span class="o">=</span><span class="s">&quot;vectors&quot;</span><span class="p">)</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">word2Vec</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
</code></pre></div>
<p><img src="/img/clickbait-cluster/cc-3.png" alt=""></p>

<p>In this case, each word and phrase are converted into a 50-dimension vector for speed later; usually, the word vectors from Word2vec are between 100 and 1,000 dimensions.</p>

<p>Another step to add context to the data is to add features representing the page that posted the status. This takes two steps in Spark; first, use a StringIndexer to covert the names of the four Facebook Pages into numerical 0-indexed representations, then use a <a href="https://en.wikipedia.org/wiki/One-hot">OneHotEncoder</a> to convert the data into <a href="https://en.wikipedia.org/wiki/Dummy_variable_(statistics)">dummy variables</a>.</p>
<div class="highlight"><pre><code class="language-Python" data-lang="Python"><span class="n">stringIndexer</span> <span class="o">=</span> <span class="n">StringIndexer</span><span class="p">(</span><span class="n">inputCol</span><span class="o">=</span><span class="s">&quot;page_id&quot;</span><span class="p">,</span> <span class="n">outputCol</span><span class="o">=</span><span class="s">&quot;indexed&quot;</span><span class="p">)</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">stringIndexer</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
<span class="n">encoder</span> <span class="o">=</span> <span class="n">OneHotEncoder</span><span class="p">(</span><span class="n">inputCol</span><span class="o">=</span><span class="s">&quot;indexed&quot;</span><span class="p">,</span> <span class="n">outputCol</span><span class="o">=</span><span class="s">&quot;page_ohe&quot;</span><span class="p">)</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">encoder</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
</code></pre></div>
<p><img src="/img/clickbait-cluster/cc-5.png" alt=""></p>

<p>This adds 3 columns, where the column containing the 1.0 represents the corresponding page. (the 4th page is represented by none of the 3 columns containing 1.0)</p>

<p>Lastly, combine the 3D page numeric vectors and the 50D word numeric vectors with a VectorAssembler:</p>
<div class="highlight"><pre><code class="language-Python" data-lang="Python"><span class="n">model</span> <span class="o">=</span> <span class="n">VectorAssembler</span><span class="p">(</span><span class="n">inputCols</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;page_ohe&#39;</span><span class="p">,</span> <span class="s">&#39;vectors&#39;</span><span class="p">],</span> <span class="n">outputCol</span><span class="o">=</span><span class="s">&quot;merged_vectors&quot;</span><span class="p">)</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
</code></pre></div>
<p><img src="/img/clickbait-cluster/cc-7.png" alt=""></p>

<p>That&rsquo;s it! And these code blocks could be combined into a <a href="http://spark.apache.org/docs/latest/ml-pipeline.html">Spark Pipeline</a> and be used on datasets hundreds or thousands times as large with just <em>two lines of code</em>, something which will help me make interesting blog posts in the future.</p>

<h2>This Chart Literally Just Totes Made Me Can&rsquo;t Even</h2>

<p>To keep comparisons between news sources apples-to-apples with respect to current events (and there have been a <em>lot</em> of events in the past couple months!), we will only look at headlines from <strong>June 1st, 2016 to August 12</strong> among the four pages; 9,500 headlines total. That&rsquo;s a fair maximum sample size, both because all the points need to be loaded onto this webpage, and because the clustering algorithm is slow.</p>

<p>Speaking of clustering, I load the 53D vectors created above for this subset into <a href="https://www.r-project.org/about.html">R</a> and apply the <a href="https://lvdmaaten.github.io/tsne/">t-SNE</a> algorithm to project and cluster each point into 2 dimensions. (since the algorithm performance scales quadratically with sample size and is single-threaded, calculating the projected points took <em>over 8 hours</em>!)</p>
<div class="highlight"><pre><code class="language-R" data-lang="R">cluster_coords <span class="o">&lt;-</span> tsne<span class="p">(</span><span class="kt">matrix</span><span class="p">,</span> initial_dims<span class="o">=</span><span class="m">53</span><span class="p">,</span> perplexity<span class="o">=</span><span class="m">50</span><span class="p">,</span> epoch<span class="o">=</span><span class="m">50</span><span class="p">)</span>
</code></pre></div>
<p><img src="/img/clickbait-cluster/cc-6.png" alt=""></p>

<p>Prototyping the plot extremely quickly in <a href="http://docs.ggplot2.org/current/">ggplot2</a>:</p>
<div class="highlight"><pre><code class="language-R" data-lang="R">ggplot<span class="p">(</span>df_plot<span class="p">,</span> aes<span class="p">(</span>x<span class="o">=</span>x<span class="p">,</span> y<span class="o">=</span>y<span class="p">,</span> color<span class="o">=</span>page_id<span class="p">))</span> <span class="o">+</span>
    geom_point<span class="p">(</span>alpha<span class="o">=</span><span class="m">0.75</span><span class="p">,</span> stroke<span class="o">=</span><span class="m">0</span><span class="p">)</span> <span class="o">+</span> 
    theme_bw<span class="p">()</span>
</code></pre></div>
<p><img src="/img/clickbait-cluster/fb-headlines-cluster-test-53D.png" alt=""></p>

<p>Gives us a map close to what we want. Hooray, my crazy clustering idea was not completely crazy!</p>

<p>However, for this visualization, it is extremely important to be able to determine which point corresponds to which headline. A static image opens up further questions on what causes points to be spatially located where. Therefore, I plot the chart interactively using <a href="https://plot.ly/">Plotly</a>, specifically with its <a href="https://plot.ly/r/webgl-vs-svg/">WebGL</a> interface, as rendering 9,500 points in the browser with the typical <a href="https://d3js.org/">d3</a>/SVG without hitting massive slowdown is difficult. The speed of WebGL also allows users to scan the headlines rapidly.</p>

<p><img src="/img/clickbait-cluster/cnn-clickbait.png" alt=""></p>

<p>As you&rsquo;ve seen from the visualizations above, all four Facebook pages have their own clusters, thanks to the added identifier feature. The left side of the 2D representation represents the more serious headlines, while the right side represents the more silly headlines. There is a little overlap between the NYTimes/CNN/BuzzFeed articles; notably, the NYTimes/CNN articles close to the BuzzFeed cluster tend to be more linkbaity, as shown in the image above. Upworthy is in its own little bubble with little similarity to the other news publications (the Upworthy headlines are much more verbose, which is likely causing more entropy and dissimilarity with the other, more concise headlines).</p>

<p>Something particularly interesting is the formation of natural subclusters outside of the main clusters. These clusters are based around keywords in the headlines, which is significant since the input data is a linear combination of that keyword and many other words, without using explicit word-importance statistical tools such as <a href="https://en.wikipedia.org/wiki/Tf%E2%80%93idf">tf-idf</a>:</p>

<ul>
<li>The <strong>top clusters</strong> are based around pop-culture keywords: Taylor Swift, Harry Potter/J.K. Rowling, Pokémon Go, and Game of Thrones.</li>
<li>The <strong>bottom clusters</strong> are based around political keywords, including Bernie Sanders, Hillary Clinton, Donald Trump, and the U.S. itself.</li>
<li>The <strong>cluster between BuzzFeed and Upworthy</strong> contains headlines with the &ldquo;[X]-year-old&rdquo; trope from all pages.</li>
</ul>

<p>As you may have noticed playing around with the interactive chart, this methodology is not perfect. Some linkbait headlines are present in the center of CNN/NYTimes clusters, and some serious headlines are present in the center of the BuzzFeed cluster. The more academic method of identifying clickbait in an unsupervised manner using machine learning would be to incorporate other inherent attributes of words and phrases, such as using <a href="https://en.wikipedia.org/wiki/Bigram">bigrams</a>, <a href="https://en.wikipedia.org/wiki/Part-of-speech_tagging">part-of-speech tagging</a>, bag-of-words/tf-idf, and <a href="http://karpathy.github.io/2015/05/21/rnn-effectiveness/">character-level language models</a>.</p>

<p>Coincidentally around the same time Facebook announced their anticlickbait initiative, Facebook open-sourced their <a href="https://github.com/facebookresearch/fastText">fasttext</a> project, which can quickly build models to classify text using some of the above example techniques. <strong>Hmmmmmm&hellip;</strong></p>

<hr>

<p><em>The full code used to process the Facebook Page data using Spark is available in <a href="https://github.com/minimaxir/clickbait-cluster/blob/master/fb_news_53D_spark.ipynb">this Jupyter notebook</a>, and the code used to generate the Plotly visualizations in R is available in <a href="https://github.com/minimaxir/clickbait-cluster/blob/master/fb_news_53D_plotly.ipynb">this Jupyter notebook</a>, both open-sourced <a href="https://github.com/minimaxir/clickbait-cluster">on GitHub</a>.  In the GitHub repository, you can download a standalone, offline version of the interactive WebGL chart.</em></p>

<p><em>You are free to use the data visualizations from this article however you wish, but it would be greatly appreciated if proper attribution is given to this article and/or myself!</em></p>
]]></content>
  </entry>
  
</feed>
